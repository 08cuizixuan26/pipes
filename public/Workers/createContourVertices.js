define(function(){"use strict";function I(t){return null!=t}function a(t){var e;this.name="DeveloperError",this.message=t;try{throw new Error}catch(t){e=t.stack}this.stack=e}I(Object.create)&&((a.prototype=Object.create(Error.prototype)).constructor=a),a.prototype.toString=function(){var t=this.name+": "+this.message;return I(this.stack)&&(t+="\n"+this.stack.toString()),t},a.throwInstantiationError=function(){throw new a("This function defines an interface and should not be called directly.")};var i={};function n(t,e,n){return"Expected "+n+" to be typeof "+e+", actual typeof was "+t}function T(t,e){return null!=t?t:e}function e(t){null==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(t)}i.typeOf={},i.defined=function(t,e){if(!I(e))throw new a(t+" is required, actual value was undefined")},i.typeOf.func=function(t,e){if("function"!=typeof e)throw new a(n(typeof e,"function",t))},i.typeOf.string=function(t,e){if("string"!=typeof e)throw new a(n(typeof e,"string",t))},i.typeOf.number=function(t,e){if("number"!=typeof e)throw new a(n(typeof e,"number",t))},i.typeOf.number.lessThan=function(t,e,n){if(i.typeOf.number(t,e),n<=e)throw new a("Expected "+t+" to be less than "+n+", actual value was "+e)},i.typeOf.number.lessThanOrEquals=function(t,e,n){if(i.typeOf.number(t,e),n<e)throw new a("Expected "+t+" to be less than or equal to "+n+", actual value was "+e)},i.typeOf.number.greaterThan=function(t,e,n){if(i.typeOf.number(t,e),e<=n)throw new a("Expected "+t+" to be greater than "+n+", actual value was "+e)},i.typeOf.number.greaterThanOrEquals=function(t,e,n){if(i.typeOf.number(t,e),e<n)throw new a("Expected "+t+" to be greater than or equal to"+n+", actual value was "+e)},i.typeOf.object=function(t,e){if("object"!=typeof e)throw new a(n(typeof e,"object",t))},i.typeOf.bool=function(t,e){if("boolean"!=typeof e)throw new a(n(typeof e,"boolean",t))},i.typeOf.number.equals=function(t,e,n,r){if(i.typeOf.number(t,n),i.typeOf.number(e,r),n!==r)throw new a(t+" must be equal to "+e+", the actual values are "+n+" and "+r)},T.EMPTY_OBJECT=Object.freeze({}),e.prototype.init_genrand=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},e.prototype.genrand_int32=function(){var t,e,n=new Array(0,this.MATRIX_A);if(this.mti>=this.N){for(this.mti==this.N+1&&this.init_genrand(5489),e=0;e<this.N-this.M;e++)t=this.mt[e]&this.UPPER_MASK|this.mt[e+1]&this.LOWER_MASK,this.mt[e]=this.mt[e+this.M]^t>>>1^n[1&t];for(;e<this.N-1;e++)t=this.mt[e]&this.UPPER_MASK|this.mt[e+1]&this.LOWER_MASK,this.mt[e]=this.mt[e+(this.M-this.N)]^t>>>1^n[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^n[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},e.prototype.random=function(){return this.genrand_int32()*(1/4294967296)};var U={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296};U.sign=T(Math.sign,function(t){return 0===(t=+t)||t!=t?t:0<t?1:-1}),U.signNotZero=function(t){return t<0?-1:1},U.toSNorm=function(t,e){return e=T(e,255),Math.round((.5*U.clamp(t,-1,1)+.5)*e)},U.fromSNorm=function(t,e){return e=T(e,255),U.clamp(t,0,e)/e*2-1},U.normalize=function(t,e,n){return 0===(n=Math.max(n-e,0))?0:U.clamp((t-e)/n,0,1)},U.sinh=T(Math.sinh,function(t){return(Math.exp(t)-Math.exp(-t))/2}),U.cosh=T(Math.cosh,function(t){return(Math.exp(t)+Math.exp(-t))/2}),U.lerp=function(t,e,n){return(1-n)*t+n*e},U.PI=Math.PI,U.ONE_OVER_PI=1/Math.PI,U.PI_OVER_TWO=Math.PI/2,U.PI_OVER_THREE=Math.PI/3,U.PI_OVER_FOUR=Math.PI/4,U.PI_OVER_SIX=Math.PI/6,U.THREE_PI_OVER_TWO=3*Math.PI/2,U.TWO_PI=2*Math.PI,U.ONE_OVER_TWO_PI=1/(2*Math.PI),U.RADIANS_PER_DEGREE=Math.PI/180,U.DEGREES_PER_RADIAN=180/Math.PI,U.RADIANS_PER_ARCSECOND=U.RADIANS_PER_DEGREE/3600,U.toRadians=function(t){return t*U.RADIANS_PER_DEGREE},U.toDegrees=function(t){return t*U.DEGREES_PER_RADIAN},U.convertLongitudeRange=function(t){var e=U.TWO_PI,t=t-Math.floor(t/e)*e;return t<-Math.PI?t+e:t>=Math.PI?t-e:t},U.clampToLatitudeRange=function(t){return U.clamp(t,-1*U.PI_OVER_TWO,U.PI_OVER_TWO)},U.negativePiToPi=function(t){return U.zeroToTwoPi(t+U.PI)-U.PI},U.zeroToTwoPi=function(t){var e=U.mod(t,U.TWO_PI);return Math.abs(e)<U.EPSILON14&&Math.abs(t)>U.EPSILON14?U.TWO_PI:e},U.mod=function(t,e){return(t%e+e)%e},U.equalsEpsilon=function(t,e,n,r){n=T(n,0),r=T(r,n);var i=Math.abs(t-e);return i<=r||i<=n*Math.max(Math.abs(t),Math.abs(e))},U.lessThan=function(t,e,n){return t-e<-n},U.lessThanOrEquals=function(t,e,n){return t-e<n},U.greaterThan=function(t,e,n){return n<t-e},U.greaterThanOrEquals=function(t,e,n){return-n<t-e};var o=[1];U.factorial=function(t){var e=o.length;if(e<=t)for(var n=o[e-1],r=e;r<=t;r++){var i=n*r;o.push(i),n=i}return o[t]},U.incrementWrap=function(t,e,n){return n=T(n,0),t=e<++t?n:t},U.isPowerOfTwo=function(t){return 0!==t&&0==(t&t-1)},U.nextPowerOfTwo=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},U.clamp=function(t,e,n){return t<e?e:n<t?n:t};var r=new e;function N(t,e,n){this.x=T(t,0),this.y=T(e,0),this.z=T(n,0)}U.setRandomNumberSeed=function(t){r=new e(t)},U.nextRandomNumber=function(){return r.random()},U.randomBetween=function(t,e){return U.nextRandomNumber()*(e-t)+t},U.acosClamped=function(t){return Math.acos(U.clamp(t,-1,1))},U.asinClamped=function(t){return Math.asin(U.clamp(t,-1,1))},U.chordLength=function(t,e){return 2*e*Math.sin(.5*t)},U.logBase=function(t,e){return Math.log(t)/Math.log(e)},U.cbrt=T(Math.cbrt,function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}),U.log2=T(Math.log2,function(t){return Math.log(t)*Math.LOG2E}),U.fog=function(t,e){e*=t;return 1-Math.exp(-e*e)},U.fastApproximateAtan=function(t){return t*(-.1784*Math.abs(t)-.0663*t*t+1.0301)},U.fastApproximateAtan2=function(t,e){var n=Math.abs(t),r=Math.abs(e),i=Math.max(n,r);r=Math.min(n,r);n=U.fastApproximateAtan(r/i);return n=Math.abs(e)>Math.abs(t)?U.PI_OVER_TWO-n:n,n=t<0?U.PI-n:n,n=e<0?-n:n},N.fromSpherical=function(t,e){I(e)||(e=new N);var n=t.clock,r=t.cone,i=T(t.magnitude,1),t=i*Math.sin(r);return e.x=t*Math.cos(n),e.y=t*Math.sin(n),e.z=i*Math.cos(r),e},N.fromElements=function(t,e,n,r){return I(r)?(r.x=t,r.y=e,r.z=n,r):new N(t,e,n)},N.fromCartesian4=N.clone=function(t,e){if(I(t))return I(e)?(e.x=t.x,e.y=t.y,e.z=t.z,e):new N(t.x,t.y,t.z)},N.packedLength=3,N.pack=function(t,e,n){return n=T(n,0),e[n++]=t.x,e[n++]=t.y,e[n]=t.z,e},N.unpack=function(t,e,n){return e=T(e,0),(n=!I(n)?new N:n).x=t[e++],n.y=t[e++],n.z=t[e],n},N.packArray=function(t,e){var n=t.length,r=3*n;if(I(e)){if(!Array.isArray(e)&&e.length!==r)throw new a("If result is a typed array, it must have exactly array.length * 3 elements");e.length!==r&&(e.length=r)}else e=new Array(r);for(var i=0;i<n;++i)N.pack(t[i],e,3*i);return e},N.unpackArray=function(t,e){var n=t.length;I(e)?e.length=n/3:e=new Array(n/3);for(var r=0;r<n;r+=3){var i=r/3;e[i]=N.unpack(t,r,e[i])}return e},N.fromArray=N.unpack,N.maximumComponent=function(t){return Math.max(t.x,t.y,t.z)},N.minimumComponent=function(t){return Math.min(t.x,t.y,t.z)},N.minimumByComponent=function(t,e,n){return n.x=Math.min(t.x,e.x),n.y=Math.min(t.y,e.y),n.z=Math.min(t.z,e.z),n},N.maximumByComponent=function(t,e,n){return n.x=Math.max(t.x,e.x),n.y=Math.max(t.y,e.y),n.z=Math.max(t.z,e.z),n},N.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y+t.z*t.z},N.magnitude=function(t){return Math.sqrt(N.magnitudeSquared(t))};var u=new N;N.distance=function(t,e){return N.subtract(t,e,u),N.magnitude(u)},N.distanceSquared=function(t,e){return N.subtract(t,e,u),N.magnitudeSquared(u)},N.normalize=function(t,e){var n=N.magnitude(t);return 0!=n?(e.x=t.x/n,e.y=t.y/n,e.z=t.z/n):N.clone(t,e),Math.abs(e.x)<U.EPSILON8&&(e.x=0),Math.abs(e.y)<U.EPSILON8&&(e.y=0),Math.abs(e.z)<U.EPSILON8&&(e.z=0),e},N.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},N.multiplyComponents=function(t,e,n){return n.x=t.x*e.x,n.y=t.y*e.y,n.z=t.z*e.z,n},N.divideComponents=function(t,e,n){return n.x=t.x/e.x,n.y=t.y/e.y,n.z=t.z/e.z,n},N.add=function(t,e,n){return n.x=t.x+e.x,n.y=t.y+e.y,n.z=t.z+e.z,n},N.subtract=function(t,e,n){return n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n},N.multiplyByScalar=function(t,e,n){return n.x=t.x*e,n.y=t.y*e,n.z=t.z*e,n},N.divideByScalar=function(t,e,n){return n.x=t.x/e,n.y=t.y/e,n.z=t.z/e,n},N.negate=function(t,e){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},N.abs=function(t,e){return e.x=Math.abs(t.x),e.y=Math.abs(t.y),e.z=Math.abs(t.z),e};var s=new N;N.lerp=function(t,e,n,r){return N.multiplyByScalar(e,n,s),r=N.multiplyByScalar(t,1-n,r),N.add(s,r,r)};var l=new N,h=new N;N.angleBetween=function(t,e){N.normalize(t,l),N.normalize(e,h);t=N.dot(l,h),e=N.magnitude(N.cross(l,h,l));return Math.atan2(e,t)};var c=new N;N.mostOrthogonalAxis=function(t,e){t=N.normalize(t,c);return N.abs(t,t),e=t.x<=t.y?t.x<=t.z?N.clone(N.UNIT_X,e):N.clone(N.UNIT_Z,e):t.y<=t.z?N.clone(N.UNIT_Y,e):N.clone(N.UNIT_Z,e)},N.projectVector=function(t,e,n){t=N.dot(t,e)/N.dot(e,e);return N.multiplyByScalar(e,t,n)},N.equals=function(t,e){return t===e||I(t)&&I(e)&&Math.abs(t.x-e.x)<1e-10&&Math.abs(t.y-e.y)<1e-10&&Math.abs(t.z-e.z)<1e-10},N.equalsArray=function(t,e,n){return t.x===e[n]&&t.y===e[n+1]&&t.z===e[n+2]},N.equalsEpsilon=function(t,e,n,r){return t===e||I(t)&&I(e)&&U.equalsEpsilon(t.x,e.x,n,r)&&U.equalsEpsilon(t.y,e.y,n,r)&&U.equalsEpsilon(t.z,e.z,n,r)},N.cross=function(t,e,n){var r=t.x,i=t.y,a=t.z,o=e.x,u=e.y,t=e.z,e=a*o-r*t,o=r*u-i*o;return n.x=i*t-a*u,n.y=e,n.z=o,n},N.midpoint=function(t,e,n){return n.x=.5*(t.x+e.x),n.y=.5*(t.y+e.y),n.z=.5*(t.z+e.z),n},N.fromDegrees=function(t,e,n,r,i){return t=U.toRadians(t),e=U.toRadians(e),N.fromRadians(t,e,n,r,i)};var f=new N,y=new N,p=new N(40680631590769,40680631590769,40408299984661.445);N.fromRadians=function(t,e,n,r,i){n=T(n,0);var a=I(r)?r.radiiSquared:p,r=Math.cos(e);f.x=r*Math.cos(t),f.y=r*Math.sin(t),f.z=Math.sin(e),f=N.normalize(f,f),N.multiplyComponents(a,f,y);a=Math.sqrt(N.dot(f,y));return y=N.divideByScalar(y,a,y),f=N.multiplyByScalar(f,n,f),I(i)||(i=new N),N.add(y,f,i)},N.fromDegreesArray=function(t,e,n){var r=t.length;I(n)?n.length=r/2:n=new Array(r/2);for(var i=0;i<r;i+=2){var a=t[i],o=t[i+1],u=i/2;n[u]=N.fromDegrees(a,o,0,e,n[u])}return n},N.fromRadiansArray=function(t,e,n){var r=t.length;I(n)?n.length=r/2:n=new Array(r/2);for(var i=0;i<r;i+=2){var a=t[i],o=t[i+1],u=i/2;n[u]=N.fromRadians(a,o,0,e,n[u])}return n},N.fromDegreesArrayHeights=function(t,e,n){var r=t.length;I(n)?n.length=r/3:n=new Array(r/3);for(var i=0;i<r;i+=3){var a=t[i],o=t[i+1],u=t[i+2],s=i/3;n[s]=N.fromDegrees(a,o,u,e,n[s])}return n},N.fromRadiansArrayHeights=function(t,e,n){var r=t.length;I(n)?n.length=r/3:n=new Array(r/3);for(var i=0;i<r;i+=3){var a=t[i],o=t[i+1],u=t[i+2],s=i/3;n[s]=N.fromRadians(a,o,u,e,n[s])}return n},N.ZERO=Object.freeze(new N(0,0,0)),N.UNIT_X=Object.freeze(new N(1,0,0)),N.UNIT_Y=Object.freeze(new N(0,1,0)),N.UNIT_Z=Object.freeze(new N(0,0,1)),N.prototype.clone=function(t){return N.clone(this,t)},N.prototype.equals=function(t){return N.equals(this,t)},N.prototype.equalsEpsilon=function(t,e,n){return N.equalsEpsilon(this,t,e,n)},N.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},N.prototype.applyMatrix4=function(t,e,n){I(n)||(n=new N);var r=t.x,i=t.y,a=t.z,t=1/(e[3]*r+e[7]*i+e[11]*a+e[15]);return n.x=(e[0]*r+e[4]*i+e[8]*a+e[12])*t,n.y=(e[1]*r+e[5]*i+e[9]*a+e[13])*t,n.z=(e[2]*r+e[6]*i+e[10]*a+e[14])*t,n},N.prototype.set=function(t,e,n){this.x=t,this.y=e,this.z=n},N.prototype.fromArray=function(t,e){return this.x=t[e=void 0===e?0:e],this.y=t[e+1],this.z=t[e+2],this},N.prototype.toArray=function(t,e){return(t=void 0===t?[]:t)[e=void 0===e?0:e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t};var O=new N,E=new N;function d(t,e,n,r,i){var a=t.x,o=t.y,u=t.z,s=e.x,l=e.y,e=e.z,h=a*a*s*s,c=o*o*l*l,f=u*u*e*e,s=h+c+f,l=Math.sqrt(1/s),e=N.multiplyByScalar(t,l,O);if(s<r)return isFinite(l)?N.clone(e,i):void 0;var y=n.x,p=n.y,d=n.z,n=E;n.x=e.x*y*2,n.y=e.y*p*2,n.z=e.z*d*2;var g=(1-l)*N.magnitude(t)/(.5*N.magnitude(n)),m=0;do{var x,_,w,v,z,M,b,m=(b=h*(v=(x=1/(1+(g-=m)*y))*x)+c*(z=(_=1/(1+g*p))*_)+f*(M=(w=1/(1+g*d))*w)-1)/(-2*(h*(v*x)*y+c*(z*_)*p+f*(M*w)*d))}while(Math.abs(b)>U.EPSILON12);return I(i)?(i.x=a*x,i.y=o*_,i.z=u*w,i):new N(a*x,o*_,u*w)}function B(t,e,n){this.longitude=T(t,0),this.latitude=T(e,0),this.height=T(n,0)}B.fromRadians=function(t,e,n,r){return n=T(n,0),I(r)?(r.longitude=t,r.latitude=e,r.height=n,r):new B(t,e,n)},B.fromDegrees=function(t,e,n,r){return t=U.toRadians(t),e=U.toRadians(e),B.fromRadians(t,e,n,r)};var g=new N,m=new N,x=new N,_=new N(1/6378137,1/6378137,1/6356752.314245179),w=new N(1/40680631590769,1/40680631590769,1/40408299984661.445),v=U.EPSILON1;function z(t,e,n,r){e=T(e,0),n=T(n,0),r=T(r,0),t._radii=new N(e,n,r),t._radiiSquared=new N(e*e,n*n,r*r),t._radiiToTheFourth=new N(e*e*e*e,n*n*n*n,r*r*r*r),t._oneOverRadii=new N(0===e?0:1/e,0===n?0:1/n,0===r?0:1/r),t._oneOverRadiiSquared=new N(0===e?0:1/(e*e),0===n?0:1/(n*n),0===r?0:1/(r*r)),t._minimumRadius=Math.min(e,n,r),t._maximumRadius=Math.max(e,n,r),t._centerToleranceSquared=U.EPSILON1,0!==t._radiiSquared.z&&(t._squaredXOverSquaredZ=t._radiiSquared.x/t._radiiSquared.z)}function M(t,e,n){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,z(this,t,e,n)}B.fromCartesian=function(t,e,n){var r=I(e)?e.oneOverRadii:_,i=I(e)?e.oneOverRadiiSquared:w,r=d(t,r,i,I(e)?e._centerToleranceSquared:v,m);if(I(r)){e=N.multiplyComponents(r,i,g),e=N.normalize(e,e),i=N.subtract(t,r,x),r=Math.atan2(e.y,e.x),e=Math.asin(e.z),i=U.sign(N.dot(i,t))*N.magnitude(i);return I(n)?(n.longitude=r,n.latitude=e,n.height=i,n):new B(r,e,i)}},B.toCartesian=function(t,e,n){return N.fromRadians(t.longitude,t.latitude,t.height,e,n)},B.clone=function(t,e){if(I(t))return I(e)?(e.longitude=t.longitude,e.latitude=t.latitude,e.height=t.height,e):new B(t.longitude,t.latitude,t.height)},B.equals=function(t,e){return t===e||I(t)&&I(e)&&t.longitude===e.longitude&&t.latitude===e.latitude&&t.height===e.height},B.equalsEpsilon=function(t,e,n){return n=T(n,0),t===e||I(t)&&I(e)&&Math.abs(t.longitude-e.longitude)<=n&&Math.abs(t.latitude-e.latitude)<=n&&Math.abs(t.height-e.height)<=n},B.ZERO=Object.freeze(new B(0,0,0)),B.prototype.clone=function(t){return B.clone(this,t)},B.prototype.equals=function(t){return B.equals(this,t)},B.prototype.equalsEpsilon=function(t,e){return B.equalsEpsilon(this,t,e)},B.prototype.toString=function(){return"("+this.longitude+", "+this.latitude+", "+this.height+")"},B.geodeticParallelLength=function(t,e,n){return t*n*Math.cos(e)},B.geodeticCircleRadians=function(t,e,n,r){r=Math.cos(e)*Math.cos(r)*Math.cos(t-n)+Math.sin(e)*Math.sin(r);return Math.abs(Math.acos(r))},B.add=function(t,e,n){return n.longitude=t.longitude+e.longitude,n.latitude=t.latitude+e.latitude,n.height=t.height+e.height,n},B.subtract=function(t,e,n){return n.longitude=t.longitude-e.longitude,n.latitude=t.latitude-e.latitude,n.height=t.height-e.height,n},B.multiplyByScalar=function(t,e,n){return n.longitude=t.longitude*e,n.latitude=t.latitude*e,n.height=t.height*e,n},B.divideByScalar=function(t,e,n){return n.longitude=t.longitude/e,n.latitude=t.latitude/e,n.height=t.height/e,n},B.distance=function(t,e){t=new Cartesian2(t.longitude,t.latitude),e=new Cartesian2(e.longitude,e.latitude);return Cartesian2.distance(t,e)},Object.defineProperties(M.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),M.clone=function(t,e){if(I(t)){var n=t._radii;return I(e)?(N.clone(n,e._radii),N.clone(t._radiiSquared,e._radiiSquared),N.clone(t._radiiToTheFourth,e._radiiToTheFourth),N.clone(t._oneOverRadii,e._oneOverRadii),N.clone(t._oneOverRadiiSquared,e._oneOverRadiiSquared),e._minimumRadius=t._minimumRadius,e._maximumRadius=t._maximumRadius,e._centerToleranceSquared=t._centerToleranceSquared,e):new M(n.x,n.y,n.z)}},M.fromCartesian3=function(t,e){return I(e)||(e=new M),I(t)&&z(e,t.x,t.y,t.z),e},M.WGS84=Object.freeze(new M(6378137,6378137,6356752.314245179)),M.UNIT_SPHERE=Object.freeze(new M(1,1,1)),M.MOON=Object.freeze(new M(U.LUNAR_RADIUS,U.LUNAR_RADIUS,U.LUNAR_RADIUS)),M.DATUM_PLANE=-100,M.prototype.clone=function(t){return M.clone(this,t)},M.packedLength=N.packedLength,M.pack=function(t,e,n){return n=T(n,0),N.pack(t._radii,e,n),e},M.unpack=function(t,e,n){e=T(e,0);e=N.unpack(t,e);return M.fromCartesian3(e,n)},M.prototype.geocentricSurfaceNormal=N.normalize,M.prototype.geodeticSurfaceNormalCartographic=function(t,e){var n=t.longitude,r=t.latitude,i=Math.cos(r),t=i*Math.cos(n),n=i*Math.sin(n),r=Math.sin(r);return(e=!I(e)?new N:e).x=t,e.y=n,e.z=r,N.normalize(e,e)},M.prototype.geodeticSurfaceNormal=function(t,e){if(!N.equalsEpsilon(t,N.ZERO,U.EPSILON14))return I(e)||(e=new N),e=N.multiplyComponents(t,this._oneOverRadiiSquared,e),N.normalize(e,e)};var b=new N,S=new N;M.prototype.cartographicToCartesian=function(t,e){var n=b,r=S;this.geodeticSurfaceNormalCartographic(t,n),N.multiplyComponents(this._radiiSquared,n,r);var i=Math.sqrt(N.dot(n,r));return N.divideByScalar(r,i,r),N.multiplyByScalar(n,t.height,n),I(e)||(e=new N),N.add(r,n,e)},M.prototype.cartographicArrayToCartesianArray=function(t,e){var n=t.length;I(e)?e.length=n:e=new Array(n);for(var r=0;r<n;r++)e[r]=this.cartographicToCartesian(t[r],e[r]);return e};var P=new N,R=new N,A=new N;M.prototype.cartesianToCartographic=function(t,e){var n=this.scaleToGeodeticSurface(t,R);if(I(n)){var r=this.geodeticSurfaceNormal(n,P),i=N.subtract(t,n,A),n=Math.atan2(r.y,r.x),r=Math.asin(r.z),i=U.sign(N.dot(i,t))*N.magnitude(i);return I(e)?(e.longitude=n,e.latitude=r,e.height=i,e):new B(n,r,i)}},M.prototype.cartesianArrayToCartographicArray=function(t,e){var n=t.length;I(e)?e.length=n:e=new Array(n);for(var r=0;r<n;++r)e[r]=this.cartesianToCartographic(t[r],e[r]);return e},M.prototype.scaleToGeodeticSurface=function(t,e){return d(t,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,e)},M.prototype.scaleToGeocentricSurface=function(t,e){I(e)||(e=new N);var n=t.x,r=t.y,i=t.z,a=this._oneOverRadiiSquared,a=1/Math.sqrt(n*n*a.x+r*r*a.y+i*i*a.z);return N.multiplyByScalar(t,a,e)},M.prototype.transformPositionToScaledSpace=function(t,e){return I(e)||(e=new N),N.multiplyComponents(t,this._oneOverRadii,e)},M.prototype.transformPositionFromScaledSpace=function(t,e){return I(e)||(e=new N),N.multiplyComponents(t,this._radii,e)},M.prototype.equals=function(t){return this===t||I(t)&&N.equals(this._radii,t._radii)},M.prototype.toString=function(){return this._radii.toString()},M.prototype.getSurfaceNormalIntersectionWithZAxis=function(t,e,n){e=T(e,0);var r=this._squaredXOverSquaredZ;if((n=!I(n)?new N:n).x=0,n.y=0,n.z=t.z*(1-r),!(Math.abs(n.z)>=this._radii.z-e))return n};var q=[.14887433898163,.43339539412925,.67940956829902,.86506336668898,.97390652851717,0],C=[.29552422471475,.26926671930999,.21908636251598,.14945134915058,.066671344308684,0];function k(t,e,n){for(var r=.5*(e+t),i=.5*(e-t),a=0,o=0;o<5;o++){var u=i*q[o];a+=C[o]*(n(r+u)+n(r-u))}return a*=i}function L(t,e,n,r,i,a){this.west=T(t,Math.PI),this.south=T(e,Math.PI/2),this.east=T(n,-Math.PI),this.north=T(r,-Math.PI/2),this.minHeight=T(i,0),this.maxHeight=T(a,0)}M.prototype.surfaceArea=function(t){for(var e=t.west,i=t.east,n=t.south,r=t.north;i<e;)i+=U.TWO_PI;var t=this._radiiSquared,a=t.x,o=t.y,u=t.z,s=a*o;return k(n,r,function(t){var n=Math.cos(t),r=Math.sin(t);return Math.cos(t)*k(e,i,function(t){var e=Math.cos(t),t=Math.sin(t);return Math.sqrt(s*r*r+u*(o*e*e+a*t*t)*n*n)})})},Object.defineProperties(L.prototype,{width:{get:function(){return L.computeWidth(this)}},height:{get:function(){return L.computeHeight(this)}}}),L.packedLength=4,L.pack=function(t,e,n){return n=T(n,0),e[n++]=t.west,e[n++]=t.south,e[n++]=t.east,e[n]=t.north,e},L.unpack=function(t,e,n){return e=T(e,0),(n=!I(n)?new L:n).west=t[e++],n.south=t[e++],n.east=t[e++],n.north=t[e],n},L.computeWidth=function(t){var e=t.east,t=t.west;return e<t&&(e+=U.TWO_PI),e-t},L.computeHeight=function(t){return t.north-t.south},L.fromDegrees=function(t,e,n,r,i){return t=U.toRadians(T(t,0)),e=U.toRadians(T(e,0)),n=U.toRadians(T(n,0)),r=U.toRadians(T(r,0)),I(i)?(i.west=t,i.south=e,i.east=n,i.north=r,i):new L(t,e,n,r)},L.fromRadians=function(t,e,n,r,i){return I(i)?(i.west=T(t,0),i.south=T(e,0),i.east=T(n,0),i.north=T(r,0),i):new L(t,e,n,r)},L.fromCartographicArray=function(t,e){for(var n=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,a=-Number.MAX_VALUE,o=Number.MAX_VALUE,u=-Number.MAX_VALUE,s=0,l=t.length;s<l;s++)var h=t[s],n=Math.min(n,h.longitude),r=Math.max(r,h.longitude),o=Math.min(o,h.latitude),u=Math.max(u,h.latitude),h=0<=h.longitude?h.longitude:h.longitude+U.TWO_PI,i=Math.min(i,h),a=Math.max(a,h);return a-i<r-n&&(n=i,(r=a)>U.PI&&(r-=U.TWO_PI),n>U.PI&&(n-=U.TWO_PI)),I(e)?(e.west=n,e.south=o,e.east=r,e.north=u,e):new L(n,o,r,u)},L.fromCartesianArray=function(t,e,n){e=T(e,M.WGS84);for(var r=Number.MAX_VALUE,i=-Number.MAX_VALUE,a=Number.MAX_VALUE,o=-Number.MAX_VALUE,u=Number.MAX_VALUE,s=-Number.MAX_VALUE,l=Number.MAX_VALUE,h=-Number.MAX_VALUE,c=0,f=t.length;c<f;c++)var y=e.cartesianToCartographic(t[c]),r=Math.min(r,y.longitude),i=Math.max(i,y.longitude),u=Math.min(u,y.latitude),s=Math.max(s,y.latitude),l=Math.min(l,y.height),h=Math.max(h,y.height),y=0<=y.longitude?y.longitude:y.longitude+U.TWO_PI,a=Math.min(a,y),o=Math.max(o,y);return o-a<i-r&&(r=a,(i=o)>U.PI&&(i-=U.TWO_PI),r>U.PI&&(r-=U.TWO_PI)),I(n)?(n.west=r,n.south=u,n.east=i,n.north=s,n.minHeight=l,n.maxHeight=h,n):new L(r,u,i,s,l,h)},L.clone=function(t,e){if(I(t))return I(e)?(e.west=t.west,e.south=t.south,e.east=t.east,e.north=t.north,e.minHeight=t.minHeight,e.maxHeight=t.maxHeight,e):new L(t.west,t.south,t.east,t.north,t.minHeight,t.maxHeight)},L.equalsEpsilon=function(t,e,n){return n=T(n,0),t===e||I(t)&&I(e)&&Math.abs(t.west-e.west)<=n&&Math.abs(t.south-e.south)<=n&&Math.abs(t.east-e.east)<=n&&Math.abs(t.north-e.north)<=n&&Math.abs(t.minHeight-e.minHeight)<=n&&Math.abs(t.maxHeight-e.maxHeight)<=n},L.prototype.clone=function(t){return L.clone(this,t)},L.prototype.equals=function(t){return L.equals(this,t)},L.prototype.intersect=function(t){return L.intersect(this,t)},L.equals=function(t,e){return t===e||I(t)&&I(e)&&t.west===e.west&&t.south===e.south&&t.east===e.east&&t.north===e.north},L.prototype.equalsEpsilon=function(t,e){return L.equalsEpsilon(this,t,e)},L.validate=function(t){},L.southwest=function(t,e){return I(e)?(e.longitude=t.west,e.latitude=t.south,e.height=0,e):new B(t.west,t.south)},L.northwest=function(t,e){return I(e)?(e.longitude=t.west,e.latitude=t.north,e.height=0,e):new B(t.west,t.north)},L.northeast=function(t,e){return I(e)?(e.longitude=t.east,e.latitude=t.north,e.height=0,e):new B(t.east,t.north)},L.southeast=function(t,e){return I(e)?(e.longitude=t.east,e.latitude=t.south,e.height=0,e):new B(t.east,t.south)},L.center=function(t,e){var n=t.east,r=t.west;n<r&&(n+=U.TWO_PI);n=U.negativePiToPi(.5*(r+n)),t=.5*(t.south+t.north);return I(e)?(e.longitude=n,e.latitude=t,e.height=0,e):new B(n,t)},L.intersection=function(t,e,n){var r=t.east,i=t.west,a=e.east,o=e.west;r<i&&0<a?r+=U.TWO_PI:a<o&&0<r&&(a+=U.TWO_PI),r<i&&o<0?o+=U.TWO_PI:a<o&&i<0&&(i+=U.TWO_PI);o=U.negativePiToPi(Math.max(i,o)),r=U.negativePiToPi(Math.min(r,a));if(!((t.west<t.east||e.west<e.east)&&r<=o)){a=Math.max(t.south,e.south),e=Math.min(t.north,e.north);if(!(e<=a))return I(n)?(n.west=o,n.south=a,n.east=r,n.north=e,n):new L(o,a,r,e)}},L.simpleIntersection=function(t,e,n){var r=Math.max(t.west,e.west),i=Math.max(t.south,e.south),a=Math.min(t.east,e.east),e=Math.min(t.north,e.north);if(!(e<=i||a<=r))return I(n)?(n.west=r,n.south=i,n.east=a,n.north=e,n):new L(r,i,a,e)},L.union=function(t,e,n){I(n)||(n=new L);var r=t.east,i=t.west,a=e.east,o=e.west;r<i&&0<a?r+=U.TWO_PI:a<o&&0<r&&(a+=U.TWO_PI),r<i&&o<0?o+=U.TWO_PI:a<o&&i<0&&(i+=U.TWO_PI);o=U.convertLongitudeRange(Math.min(i,o)),a=U.convertLongitudeRange(Math.max(r,a));return n.west=o,n.south=Math.min(t.south,e.south),n.east=a,n.north=Math.max(t.north,e.north),n},L.expand=function(t,e,n){return(n=!I(n)?new L:n).west=Math.min(t.west,e.longitude),n.south=Math.min(t.south,e.latitude),n.east=Math.max(t.east,e.longitude),n.north=Math.max(t.north,e.latitude),n},L.contains=function(t,e){var n=e.longitude,r=e.latitude,i=t.west,e=t.east;return e<i&&(e+=U.TWO_PI,n<0&&(n+=U.TWO_PI)),(i<n||U.equalsEpsilon(n,i,U.EPSILON14))&&(n<e||U.equalsEpsilon(n,e,U.EPSILON14))&&r>=t.south&&r<=t.north};var D=new B;L.subsample=function(t,e,n,r){e=T(e,M.WGS84),n=T(n,0),I(r)||(r=[]);var i=0,a=t.north,o=t.south,u=t.east,s=t.west,l=D;l.height=n,l.longitude=s,l.latitude=a,r[i]=e.cartographicToCartesian(l,r[i]),i++,l.longitude=u,r[i]=e.cartographicToCartesian(l,r[i]),i++,l.latitude=o,r[i]=e.cartographicToCartesian(l,r[i]),i++,l.longitude=s,r[i]=e.cartographicToCartesian(l,r[i]),i++,l.latitude=a<0?a:0<o?o:0;for(var h=1;h<8;++h)l.longitude=-Math.PI+h*U.PI_OVER_TWO,L.contains(t,l)&&(r[i]=e.cartographicToCartesian(l,r[i]),i++);return 0===l.latitude&&(l.longitude=s,r[i]=e.cartographicToCartesian(l,r[i]),i++,l.longitude=u,r[i]=e.cartographicToCartesian(l,r[i]),i++),r.length=i,r},L.intersect=function(t,e){return t.north>=e.south&&t.south<=e.north&&t.east>=e.west&&t.west<=e.east},L.intersect_lon_lat_region=function(t,e){for(var n=e.get_count(),r=0;r<n;r++)if(L.check_rect_line(t,e.getItem(r),e.getItem((r+1)%n)))return!0;return!!e.containRect(t)},L.check_rect_line_vertical=function(t,e,n,r,i){if(n<t.longitude&&n<e.longitude)return!1;if(n>t.longitude&&n>e.longitude)return!1;if(t.longitude==e.longitude)return n==t.longitude&&(!(t.latitude<r&&e.latitude<r)&&!(t.latitude>i&&e.latitude>i));t=(e.latitude-t.latitude)*(n-t.longitude)/(e.longitude-t.longitude)+t.latitude;return r<=t&&t<=i},L.check_rect_line_horizontal=function(t,e,n,r,i){if(n<t.latitude&&n<e.latitude)return!1;if(n>t.latitude&&n>e.latitude)return!1;if(t.latitude==e.latitude)return n==t.latitude&&(!(t.longitude<r&&e.longitude<r)&&!(t.longitude>i&&e.longitude>i));t=(e.longitude-t.longitude)*(n-t.latitude)/(e.latitude-t.latitude)+t.longitude;return r<=t&&t<=i},L.check_rect_line=function(t,e,n){var r=!1;return L.containPoint(t,e)||L.containPoint(t,n)?r=!0:(r|=L.check_rect_line_horizontal(e,n,t.north,t.west,t.east),r|=L.check_rect_line_horizontal(e,n,t.south,t.west,t.east),r|=L.check_rect_line_vertical(e,n,t.west,t.south,t.north),r|=L.check_rect_line_vertical(e,n,t.east,t.south,t.north)),r},L.intersectAabb=function(t,e){for(var n=new L,r=e.get_corners(),i=new B,a=0;a<8;a++){var o=B.fromCartesian(r[a],void 0,i);L.combine(n,o)}return L.intersect(t,n)},L.fromGeoAabb=function(t){for(var e=new L,n=t.get_corners(),r=new B,i=0;i<8;i++){var a=B.fromCartesian(n[i],void 0,r);L.combine(e,a)}return e},L.containsRect=function(t,e){var n=U.EPSILON6;return e.east<=t.east+n&&e.west>=t.west-n&&e.north<=t.north+n&&e.south>=t.south-n},L.combine=function(t,e){t.west>e.longitude&&(t.west=e.longitude),t.east<e.longitude&&(t.east=e.longitude),t.north<e.latitude&&(t.north=e.latitude),t.south>e.latitude&&(t.south=e.latitude),t.maxHeight<e.height&&(t.maxHeight=e.height),t.minHeight>e.height&&(t.minHeight=e.height)},L.fromAabb=function(t,e){var n=e.minimum,r=e.maximum,i=r.z/M.WGS84.maximumRadius*1e3,e=n.z/M.WGS84.maximumRadius*1e3,r=r.x/M.WGS84.maximumRadius*1e3,n=n.x/M.WGS84.maximumRadius*1e3;return new L(t.longitude+n,t.latitude+e,t.longitude+r,t.latitude+i)},L.containPoint=function(t,e){return e.longitude<=t.east&&e.longitude>=t.west&&e.latitude<=t.north&&e.latitude>=t.south},L.MAX_VALUE=Object.freeze(new L(-Math.PI,-U.PI_OVER_TWO,Math.PI,U.PI_OVER_TWO));var W=0,V=1,X=2,Z=3,Y={};function G(t,e,n,r,i,a,o,u,s){this[0]=T(t,0),this[1]=T(r,0),this[2]=T(o,0),this[3]=T(e,0),this[4]=T(i,0),this[5]=T(u,0),this[6]=T(n,0),this[7]=T(a,0),this[8]=T(s,0)}Y.worldRect=new L(-U.PI,-U.PI_OVER_TWO,U.PI,U.PI_OVER_TWO),Y.assemble_int=function(t,e,n){return{level:t,lonIndex:e,latIndex:n}},Y.assemble=function(t,e,n){var r=1/Y.get_bound_size(t),e=Math.floor((e-Y.worldRect.west)*r),r=Math.floor((n-Y.worldRect.south)*r);return Y.assemble_int(t,e,r)},Y.get_bound_size=function(t){return(Y.worldRect.east-Y.worldRect.west)/(1<<t+1)},Y.toString=function(t){var e=t.level.toString(16),n=t.lonIndex.toString(16),r=t.latIndex.toString(16),r=0===t.level?0===t.lonIndex?r:n+"000000".substring(0,6-r.length)+r:e+"000000".substring(0,6-n.length)+n+"000000".substring(0,6-r.length)+r;return r},Y.to_string=function(t){var e=t.level,n=t.lonIndex,r=t.latIndex,i=(16711680&n)>>16,a=(65280&n)>>8,n=(16711680&r)>>16,r=(65280&r)>>8,t=Y.toString(t);return e.toString(16)+"/"+i.toString(16)+n.toString(16)+"/"+a.toString(16)+r.toString(16)+"/"+t},Y.to_int=function(t){var e=t.level,n=t.lonIndex,t=t.latIndex;return e<<48||n<<24||t},Y.to_path=function(t,e,n){var r=Y.assemble(t,e,n),t=r.level,e=r.lonIndex,n=r.latIndex,t=(65280&e)>>8,r=(16711680&n)>>16,n=(65280&n)>>8;return{x:((16711680&e)>>16).toString(16)+r.toString(16),y:t.toString(16)+n.toString(16)}},Y.get_level=function(t){return t.level},Y.get_lat_index=function(t){return t.latIndex},Y.get_lon_index=function(t){return t.lonIndex},Y.get_bound=function(t,e){var n=t.level,r=t.lonIndex,i=t.latIndex,a=r+1,t=i+1,n=Y.get_bound_size(n),r=r*n+Y.worldRect.west,i=i*n+Y.worldRect.south,a=a*n+Y.worldRect.west,n=t*n+Y.worldRect.south;return I(e)?(e.west=r,e.south=i,e.east=a,e.north=n,e):new L(r,i,a,n,0,0)},Y.get_parent_index=function(t,e){I(e)||(e=1);var n=t.level,r=t.lonIndex,t=t.latIndex;return Y.assemble_int(n-e,r>>e,t>>e)},Y.get_children=function(t,e){var n=t.level+1,r=2*t.lonIndex,i=2*t.latIndex,a=Y.assemble_int(n,r,i),o=Y.assemble_int(n,r,1+i),t=Y.assemble_int(n,1+r,i),i=Y.assemble_int(n,1+r,1+i);if(!I(e))return[a,o,t,i];e[0]=a,e[1]=o,e[2]=t,e[3]=i},Y.get_child=function(t,e){var n=t.level+1,r=t.lonIndex<<1,i=t.latIndex<<1,a=0;switch(e){case W:a=Y.assemble_int(n,r,i);break;case V:a=Y.assemble_int(n,r,1+i);break;case X:a=Y.assemble_int(n,1+r,i);break;case Z:a=Y.assemble_int(n,1+r,1+i)}return a},G.packedLength=9,G.pack=function(t,e,n){return n=T(n,0),e[n++]=t[0],e[n++]=t[1],e[n++]=t[2],e[n++]=t[3],e[n++]=t[4],e[n++]=t[5],e[n++]=t[6],e[n++]=t[7],e[n++]=t[8],e},G.unpack=function(t,e,n){return e=T(e,0),(n=!I(n)?new G:n)[0]=t[e++],n[1]=t[e++],n[2]=t[e++],n[3]=t[e++],n[4]=t[e++],n[5]=t[e++],n[6]=t[e++],n[7]=t[e++],n[8]=t[e++],n},G.clone=function(t,e){if(I(t))return I(e)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e):new G(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},G.fromArray=function(t,e,n){return e=T(e,0),(n=!I(n)?new G:n)[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],n[4]=t[e+4],n[5]=t[e+5],n[6]=t[e+6],n[7]=t[e+7],n[8]=t[e+8],n},G.fromColumnMajorArray=function(t,e){return G.clone(t,e)},G.fromRowMajorArray=function(t,e){return I(e)?(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e):new G(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},G.fromQuaternion=function(t,e){var n=t.x*t.x,r=t.x*t.y,i=t.x*t.z,a=t.x*t.w,o=t.y*t.y,u=t.y*t.z,s=t.y*t.w,l=t.z*t.z,h=t.z*t.w,c=t.w*t.w,f=n-o-l+c,y=2*(r-h),p=2*(i+s),t=2*(r+h),r=o-n-l+c,h=2*(u-a),s=2*(i-s),a=2*(u+a),c=-n-o+l+c;return I(e)?(e[0]=f,e[1]=t,e[2]=s,e[3]=y,e[4]=r,e[5]=a,e[6]=p,e[7]=h,e[8]=c,e):new G(f,y,p,t,r,h,s,a,c)},G.fromHeadingPitchRoll=function(t,e){var n=Math.cos(-t.pitch),r=Math.cos(-t.heading),i=Math.cos(t.roll),a=Math.sin(-t.pitch),o=Math.sin(-t.heading),u=Math.sin(t.roll),s=n*r,l=-i*o+u*a*r,h=u*o+i*a*r,c=n*o,t=i*r+u*a*o,o=-u*r+i*a*o,a=-a,u=u*n,n=i*n;return I(e)?(e[0]=s,e[1]=c,e[2]=a,e[3]=l,e[4]=t,e[5]=u,e[6]=h,e[7]=o,e[8]=n,e):new G(s,l,h,c,t,o,a,u,n)},G.fromScale=function(t,e){return I(e)?(e[0]=t.x,e[1]=0,e[2]=0,e[3]=0,e[4]=t.y,e[5]=0,e[6]=0,e[7]=0,e[8]=t.z,e):new G(t.x,0,0,0,t.y,0,0,0,t.z)},G.fromUniformScale=function(t,e){return I(e)?(e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=t,e):new G(t,0,0,0,t,0,0,0,t)},G.fromCrossProduct=function(t,e){return I(e)?(e[0]=0,e[1]=t.z,e[2]=-t.y,e[3]=-t.z,e[4]=0,e[5]=t.x,e[6]=t.y,e[7]=-t.x,e[8]=0,e):new G(0,-t.z,t.y,t.z,0,-t.x,-t.y,t.x,0)},G.fromRotationX=function(t,e){var n=Math.cos(t),t=Math.sin(t);return I(e)?(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=n,e[5]=t,e[6]=0,e[7]=-t,e[8]=n,e):new G(1,0,0,0,n,-t,0,t,n)},G.fromRotationY=function(t,e){var n=Math.cos(t),t=Math.sin(t);return I(e)?(e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=1,e[5]=0,e[6]=t,e[7]=0,e[8]=n,e):new G(n,0,t,0,1,0,-t,0,n)},G.fromRotationZ=function(t,e){var n=Math.cos(t),t=Math.sin(t);return I(e)?(e[0]=n,e[1]=t,e[2]=0,e[3]=-t,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e):new G(n,-t,0,t,n,0,0,0,1)},G.toArray=function(t,e){return I(e)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e):[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},G.getElementIndex=function(t,e){return 3*t+e},G.getColumn=function(t,e,n){var r=3*e,i=t[r],e=t[1+r],r=t[2+r];return n.x=i,n.y=e,n.z=r,n},G.setColumn=function(t,e,n,r){e*=3;return(r=G.clone(t,r))[e]=n.x,r[1+e]=n.y,r[2+e]=n.z,r},G.getRow=function(t,e,n){var r=t[e],i=t[e+3],e=t[e+6];return n.x=r,n.y=i,n.z=e,n},G.setRow=function(t,e,n,r){return(r=G.clone(t,r))[e]=n.x,r[e+3]=n.y,r[e+6]=n.z,r};var j=new N;G.getScale=function(t,e){return e.x=N.magnitude(N.fromElements(t[0],t[1],t[2],j)),e.y=N.magnitude(N.fromElements(t[3],t[4],t[5],j)),e.z=N.magnitude(N.fromElements(t[6],t[7],t[8],j)),e};var F=new N;G.getMaximumScale=function(t){return G.getScale(t,F),N.maximumComponent(F)},G.multiply=function(t,e,n){var r=t[0]*e[0]+t[3]*e[1]+t[6]*e[2],i=t[1]*e[0]+t[4]*e[1]+t[7]*e[2],a=t[2]*e[0]+t[5]*e[1]+t[8]*e[2],o=t[0]*e[3]+t[3]*e[4]+t[6]*e[5],u=t[1]*e[3]+t[4]*e[4]+t[7]*e[5],s=t[2]*e[3]+t[5]*e[4]+t[8]*e[5],l=t[0]*e[6]+t[3]*e[7]+t[6]*e[8],h=t[1]*e[6]+t[4]*e[7]+t[7]*e[8],e=t[2]*e[6]+t[5]*e[7]+t[8]*e[8];return n[0]=r,n[1]=i,n[2]=a,n[3]=o,n[4]=u,n[5]=s,n[6]=l,n[7]=h,n[8]=e,n},G.add=function(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n[4]=t[4]+e[4],n[5]=t[5]+e[5],n[6]=t[6]+e[6],n[7]=t[7]+e[7],n[8]=t[8]+e[8],n},G.subtract=function(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n[3]=t[3]-e[3],n[4]=t[4]-e[4],n[5]=t[5]-e[5],n[6]=t[6]-e[6],n[7]=t[7]-e[7],n[8]=t[8]-e[8],n},G.multiplyByVector=function(t,e,n){var r=e.x,i=e.y,a=e.z,o=t[0]*r+t[3]*i+t[6]*a,e=t[1]*r+t[4]*i+t[7]*a,a=t[2]*r+t[5]*i+t[8]*a;return n.x=o,n.y=e,n.z=a,n},G.multiplyByScalar=function(t,e,n){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n[4]=t[4]*e,n[5]=t[5]*e,n[6]=t[6]*e,n[7]=t[7]*e,n[8]=t[8]*e,n},G.multiplyByScale=function(t,e,n){return n[0]=t[0]*e.x,n[1]=t[1]*e.x,n[2]=t[2]*e.x,n[3]=t[3]*e.y,n[4]=t[4]*e.y,n[5]=t[5]*e.y,n[6]=t[6]*e.z,n[7]=t[7]*e.z,n[8]=t[8]*e.z,n},G.negate=function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e},G.transpose=function(t,e){var n=t[0],r=t[3],i=t[6],a=t[1],o=t[4],u=t[7],s=t[2],l=t[5],t=t[8];return e[0]=n,e[1]=r,e[2]=i,e[3]=a,e[4]=o,e[5]=u,e[6]=s,e[7]=l,e[8]=t,e};var H=new N(1,1,1);G.getRotation=function(t,e){var n=N.divideComponents(H,G.getScale(t,F),F);return e=G.multiplyByScale(t,n,e)};var J=[1,0,0],K=[2,2,1];var Q=new G,$=new G;function t(t){var e;this.name="RuntimeError",this.message=t;try{throw new Error}catch(t){e=t.stack}this.stack=e}function tt(t,e,n,r){this.x=T(t,0),this.y=T(e,0),this.z=T(n,0),this.w=T(r,0)}G.computeEigenDecomposition=function(t,e){for(var n=U.EPSILON20,r=0,i=0,a=(e=!I(e)?{}:e).unitary=G.clone(G.IDENTITY,e.unitary),o=e.diagonal=G.clone(t,e.diagonal),u=n*function(t){for(var e=0,n=0;n<9;++n){var r=t[n];e+=r*r}return Math.sqrt(e)}(o);i<10&&function(t){for(var e=0,n=0;n<3;++n){var r=t[G.getElementIndex(K[n],J[n])];e+=2*r*r}return Math.sqrt(e)}(o)>u;)!function(t,e){for(var n=U.EPSILON15,r=0,i=1,a=0;a<3;++a){var o=Math.abs(t[G.getElementIndex(K[a],J[a])]);r<o&&(i=a,r=o)}var u=1,s=0,l=J[i],h=K[i];Math.abs(t[G.getElementIndex(h,l)])>n&&(s=(n=(n=(t[G.getElementIndex(h,h)]-t[G.getElementIndex(l,l)])/2/t[G.getElementIndex(h,l)])<0?-1/(-n+Math.sqrt(1+n*n)):1/(n+Math.sqrt(1+n*n)))*(u=1/Math.sqrt(1+n*n))),(e=G.clone(G.IDENTITY,e))[G.getElementIndex(l,l)]=e[G.getElementIndex(h,h)]=u,e[G.getElementIndex(h,l)]=s,e[G.getElementIndex(l,h)]=-s}(o,Q),G.transpose(Q,$),G.multiply(o,Q,o),G.multiply($,o,o),G.multiply(a,Q,a),2<++r&&(++i,r=0);return e},G.abs=function(t,e){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e[3]=Math.abs(t[3]),e[4]=Math.abs(t[4]),e[5]=Math.abs(t[5]),e[6]=Math.abs(t[6]),e[7]=Math.abs(t[7]),e[8]=Math.abs(t[8]),e},G.determinant=function(t){var e=t[0],n=t[3],r=t[6],i=t[1],a=t[4],o=t[7],u=t[2],s=t[5],t=t[8];return e*(a*t-s*o)+i*(s*r-n*t)+u*(n*o-a*r)},G.inverse=function(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],u=t[5],s=t[6],l=t[7],h=t[8],t=G.determinant(t);return e[0]=o*h-l*u,e[1]=l*i-r*h,e[2]=r*u-o*i,e[3]=s*u-a*h,e[4]=n*h-s*i,e[5]=a*i-n*u,e[6]=a*l-s*o,e[7]=s*r-n*l,e[8]=n*o-a*r,G.multiplyByScalar(e,1/t,e)},G.equals=function(t,e){return t===e||I(t)&&I(e)&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},G.equalsEpsilon=function(t,e,n){return n=T(n,0),t===e||I(t)&&I(e)&&Math.abs(t[0]-e[0])<=n&&Math.abs(t[1]-e[1])<=n&&Math.abs(t[2]-e[2])<=n&&Math.abs(t[3]-e[3])<=n&&Math.abs(t[4]-e[4])<=n&&Math.abs(t[5]-e[5])<=n&&Math.abs(t[6]-e[6])<=n&&Math.abs(t[7]-e[7])<=n&&Math.abs(t[8]-e[8])<=n},G.IDENTITY=Object.freeze(new G(1,0,0,0,1,0,0,0,1)),G.ZERO=Object.freeze(new G(0,0,0,0,0,0,0,0,0)),G.COLUMN0ROW0=0,G.COLUMN0ROW1=1,G.COLUMN0ROW2=2,G.COLUMN1ROW0=3,G.COLUMN1ROW1=4,G.COLUMN1ROW2=5,G.COLUMN2ROW0=6,G.COLUMN2ROW1=7,G.COLUMN2ROW2=8,Object.defineProperties(G.prototype,{length:{get:function(){return G.packedLength}}}),G.prototype.clone=function(t){return G.clone(this,t)},G.prototype.equals=function(t){return G.equals(this,t)},G.equalsArray=function(t,e,n){return t[0]===e[n]&&t[1]===e[n+1]&&t[2]===e[n+2]&&t[3]===e[n+3]&&t[4]===e[n+4]&&t[5]===e[n+5]&&t[6]===e[n+6]&&t[7]===e[n+7]&&t[8]===e[n+8]},G.prototype.equalsEpsilon=function(t,e){return G.equalsEpsilon(this,t,e)},G.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n("+this[1]+", "+this[4]+", "+this[7]+")\n("+this[2]+", "+this[5]+", "+this[8]+")"},I(Object.create)&&((t.prototype=Object.create(Error.prototype)).constructor=t),t.prototype.toString=function(){var t=this.name+": "+this.message;return I(this.stack)&&(t+="\n"+this.stack.toString()),t},tt.fromElements=function(t,e,n,r,i){return I(i)?(i.x=t,i.y=e,i.z=n,i.w=r,i):new tt(t,e,n,r)},tt.fromColor=function(t,e){return I(e)?(e.x=t.red,e.y=t.green,e.z=t.blue,e.w=t.alpha,e):new tt(t.red,t.green,t.blue,t.alpha)},tt.clone=function(t,e){if(I(t))return I(e)?(e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e):new tt(t.x,t.y,t.z,t.w)},tt.packedLength=4,tt.pack=function(t,e,n){return n=T(n,0),e[n++]=t.x,e[n++]=t.y,e[n++]=t.z,e[n]=t.w,e},tt.unpack=function(t,e,n){return e=T(e,0),(n=!I(n)?new tt:n).x=t[e++],n.y=t[e++],n.z=t[e++],n.w=t[e],n},tt.packArray=function(t,e){var n=t.length,r=4*n;if(I(e)){if(!Array.isArray(e)&&e.length!==r)throw new a("If result is a typed array, it must have exactly array.length * 4 elements");e.length!==r&&(e.length=r)}else e=new Array(r);for(var i=0;i<n;++i)tt.pack(t[i],e,4*i);return e},tt.unpackArray=function(t,e){var n=t.length;I(e)?e.length=n/4:e=new Array(n/4);for(var r=0;r<n;r+=4){var i=r/4;e[i]=tt.unpack(t,r,e[i])}return e},tt.fromArray=tt.unpack,tt.maximumComponent=function(t){return Math.max(t.x,t.y,t.z,t.w)},tt.minimumComponent=function(t){return Math.min(t.x,t.y,t.z,t.w)},tt.minimumByComponent=function(t,e,n){return n.x=Math.min(t.x,e.x),n.y=Math.min(t.y,e.y),n.z=Math.min(t.z,e.z),n.w=Math.min(t.w,e.w),n},tt.maximumByComponent=function(t,e,n){return n.x=Math.max(t.x,e.x),n.y=Math.max(t.y,e.y),n.z=Math.max(t.z,e.z),n.w=Math.max(t.w,e.w),n},tt.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},tt.magnitude=function(t){return Math.sqrt(tt.magnitudeSquared(t))};var et=new tt;tt.distance=function(t,e){return tt.subtract(t,e,et),tt.magnitude(et)},tt.distanceSquared=function(t,e){return tt.subtract(t,e,et),tt.magnitudeSquared(et)},tt.normalize=function(t,e){var n=tt.magnitude(t);return 0!=n?(e.x=t.x/n,e.y=t.y/n,e.z=t.z/n,e.w=t.w/n):tt.clone(t,e),Math.abs(e.x)<U.EPSILON8&&(e.x=0),Math.abs(e.y)<U.EPSILON8&&(e.y=0),Math.abs(e.z)<U.EPSILON8&&(e.z=0),Math.abs(e.w)<U.EPSILON8&&(e.w=0),e},tt.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},tt.multiplyComponents=function(t,e,n){return n.x=t.x*e.x,n.y=t.y*e.y,n.z=t.z*e.z,n.w=t.w*e.w,n},tt.divideComponents=function(t,e,n){return n.x=t.x/e.x,n.y=t.y/e.y,n.z=t.z/e.z,n.w=t.w/e.w,n},tt.add=function(t,e,n){return n.x=t.x+e.x,n.y=t.y+e.y,n.z=t.z+e.z,n.w=t.w+e.w,n},tt.subtract=function(t,e,n){return n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n.w=t.w-e.w,n},tt.multiplyByScalar=function(t,e,n){return n.x=t.x*e,n.y=t.y*e,n.z=t.z*e,n.w=t.w*e,n},tt.divideByScalar=function(t,e,n){return n.x=t.x/e,n.y=t.y/e,n.z=t.z/e,n.w=t.w/e,n},tt.negate=function(t,e){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=-t.w,e},tt.abs=function(t,e){return e.x=Math.abs(t.x),e.y=Math.abs(t.y),e.z=Math.abs(t.z),e.w=Math.abs(t.w),e};var nt=new tt;tt.lerp=function(t,e,n,r){return tt.multiplyByScalar(e,n,nt),r=tt.multiplyByScalar(t,1-n,r),tt.add(nt,r,r)};var rt=new tt;tt.mostOrthogonalAxis=function(t,e){t=tt.normalize(t,rt);return tt.abs(t,t),e=t.x<=t.y?t.x<=t.z?t.x<=t.w?tt.clone(tt.UNIT_X,e):tt.clone(tt.UNIT_W,e):t.z<=t.w?tt.clone(tt.UNIT_Z,e):tt.clone(tt.UNIT_W,e):t.y<=t.z?t.y<=t.w?tt.clone(tt.UNIT_Y,e):tt.clone(tt.UNIT_W,e):t.z<=t.w?tt.clone(tt.UNIT_Z,e):tt.clone(tt.UNIT_W,e)},tt.equals=function(t,e){return t===e||I(t)&&I(e)&&t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},tt.equalsArray=function(t,e,n){return t.x===e[n]&&t.y===e[n+1]&&t.z===e[n+2]&&t.w===e[n+3]},tt.equalsEpsilon=function(t,e,n,r){return t===e||I(t)&&I(e)&&U.equalsEpsilon(t.x,e.x,n,r)&&U.equalsEpsilon(t.y,e.y,n,r)&&U.equalsEpsilon(t.z,e.z,n,r)&&U.equalsEpsilon(t.w,e.w,n,r)},tt.ZERO=Object.freeze(new tt(0,0,0,0)),tt.UNIT_X=Object.freeze(new tt(1,0,0,0)),tt.UNIT_Y=Object.freeze(new tt(0,1,0,0)),tt.UNIT_Z=Object.freeze(new tt(0,0,1,0)),tt.UNIT_W=Object.freeze(new tt(0,0,0,1)),tt.WHITE=Object.freeze(new tt(1,1,1,1)),tt.prototype.clone=function(t){return tt.clone(this,t)},tt.prototype.equals=function(t){return tt.equals(this,t)},tt.prototype.equalsEpsilon=function(t,e,n){return tt.equalsEpsilon(this,t,e,n)},tt.prototype.toString=function(t){if(I(t)&&16==t){var e=parseInt(255*this.x).toString(16),n=parseInt(255*this.y).toString(16),t=parseInt(255*this.z).toString(16);return"00".substring(0,2-e.length)+e+"00".substring(0,2-n.length)+n+"00".substring(0,2-t.length)+t}return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};var it=new Float32Array(1);function at(t,e,n,r,i,a,o,u,s,l,h,c,f,y,p,d){this[0]=T(t,0),this[1]=T(i,0),this[2]=T(s,0),this[3]=T(f,0),this[4]=T(e,0),this[5]=T(a,0),this[6]=T(l,0),this[7]=T(y,0),this[8]=T(n,0),this[9]=T(o,0),this[10]=T(h,0),this[11]=T(p,0),this[12]=T(r,0),this[13]=T(u,0),this[14]=T(c,0),this[15]=T(d,0)}tt.packFloat=function(t,e){if(I(e)||(e=new tt),it[0]=t,0===(t=it[0]))return tt.clone(tt.ZERO,e);var n,r=t<0?1:0;isFinite(t)?(t=Math.abs(t),n=Math.floor(U.logBase(t,10))+1,t/=Math.pow(10,n)):(t=.1,n=38);t*=256;return e.x=Math.floor(t),t=256*(t-e.x),e.y=Math.floor(t),t=256*(t-e.y),e.z=Math.floor(t),e.w=2*(n+38)+r,e},tt.unpackFloat=function(t){var e=t.w/2,n=Math.floor(e),r=-(r=2*(r=2*(e-n))-1);if(38<=(n-=38))return r<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;e=r*t.x*(1/256);return e+=r*t.y*(1/65536),(e+=r*t.z*(1/16777216))*Math.pow(10,n)},at.packedLength=16,at.pack=function(t,e,n){return n=T(n,0),e[n++]=t[0],e[n++]=t[1],e[n++]=t[2],e[n++]=t[3],e[n++]=t[4],e[n++]=t[5],e[n++]=t[6],e[n++]=t[7],e[n++]=t[8],e[n++]=t[9],e[n++]=t[10],e[n++]=t[11],e[n++]=t[12],e[n++]=t[13],e[n++]=t[14],e[n]=t[15],e},at.unpack=function(t,e,n){return e=T(e,0),(n=!I(n)?new at:n)[0]=t[e++],n[1]=t[e++],n[2]=t[e++],n[3]=t[e++],n[4]=t[e++],n[5]=t[e++],n[6]=t[e++],n[7]=t[e++],n[8]=t[e++],n[9]=t[e++],n[10]=t[e++],n[11]=t[e++],n[12]=t[e++],n[13]=t[e++],n[14]=t[e++],n[15]=t[e],n},at.clone=function(t,e){if(I(t))return I(e)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e):new at(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},at.fromArray=at.unpack,at.fromColumnMajorArray=function(t,e){return at.clone(t,e)},at.fromRowMajorArray=function(t,e){return I(e)?(e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e):new at(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},at.fromRotationTranslation=function(t,e,n){return e=T(e,N.ZERO),I(n)?(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[3],n[5]=t[4],n[6]=t[5],n[7]=0,n[8]=t[6],n[9]=t[7],n[10]=t[8],n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,n):new at(t[0],t[3],t[6],e.x,t[1],t[4],t[7],e.y,t[2],t[5],t[8],e.z,0,0,0,1)},at.fromTranslationQuaternionRotationScale=function(t,e,n,r){I(r)||(r=new at);var i=n.x,a=n.y,o=n.z,u=e.x*e.x,s=e.x*e.y,l=e.x*e.z,h=e.x*e.w,c=e.y*e.y,f=e.y*e.z,y=e.y*e.w,p=e.z*e.z,d=e.z*e.w,g=e.w*e.w,m=2*(s-d),n=2*(l+y),e=2*(s+d),s=c-u-p+g,d=2*(f-h),y=2*(l-y),f=2*(f+h),h=-u-c+p+g;return r[0]=(u-c-p+g)*i,r[1]=e*i,r[2]=y*i,r[3]=0,r[4]=m*a,r[5]=s*a,r[6]=f*a,r[7]=0,r[8]=n*o,r[9]=d*o,r[10]=h*o,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,r},at.fromTranslationRotationScale=function(t,e){return at.fromTranslationQuaternionRotationScale(t.translation,t.rotation,t.scale,e)},at.fromTranslation=function(t,e){return at.fromRotationTranslation(G.IDENTITY,t,e)},at.fromScale=function(t,e){return I(e)?(e[0]=t.x,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t.y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t.z,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e):new at(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1)},at.fromUniformScale=function(t,e){return I(e)?(e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e):new at(t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1)};var ot=new N,ut=new N,st=new N;at.fromObserver=function(t,e){var n=t.position,r=t.direction,i=t.up;N.normalize(r,ot),N.normalize(N.cross(ot,i,ut),ut),N.normalize(N.cross(ut,ot,st),st);var a=ut.x,o=ut.y,u=ut.z,s=ot.x,l=ot.y,h=ot.z,c=st.x,f=st.y,y=st.z,p=n.x,t=n.y,r=n.z,i=a*-p+o*-t+u*-r,n=c*-p+f*-t+y*-r,r=s*p+l*t+h*r;return I(e)?(e[0]=a,e[1]=c,e[2]=-s,e[3]=0,e[4]=o,e[5]=f,e[6]=-l,e[7]=0,e[8]=u,e[9]=y,e[10]=-h,e[11]=0,e[12]=i,e[13]=n,e[14]=r,e[15]=1,e):new at(a,o,u,i,c,f,y,n,-s,-l,-h,r,0,0,0,1)},at.computePerspectiveFieldOfView=function(t,e,n,r,i){var a=1/Math.tan(.5*t),t=(r+n)/(n-r),r=2*r*n/(n-r);return i[0]=a/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t,i[11]=-1,i[12]=0,i[13]=0,i[14]=r,i[15]=0,i},at.computeOrthographicOffCenter=function(t,e,n,r,i,a,o){var u=1/(e-t),s=1/(r-n),l=1/(a-i),t=-(e+t)*u,n=-(r+n)*s,i=-(a+i)*l;return s*=2,l*=-2,o[0]=u*=2,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=s,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=l,o[11]=0,o[12]=t,o[13]=n,o[14]=i,o[15]=1,o},at.computePerspectiveOffCenter=function(t,e,n,r,i,a,o){var u=2*i/(r-n),s=(e+t)/(e-t),r=(r+n)/(r-n),n=-(a+i)/(a-i),a=-2*a*i/(a-i);return o[0]=2*i/(e-t),o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=u,o[6]=0,o[7]=0,o[8]=s,o[9]=r,o[10]=n,o[11]=-1,o[12]=0,o[13]=0,o[14]=a,o[15]=0,o},at.computeInfinitePerspectiveOffCenter=function(t,e,n,r,i,a){var o=2*i/(r-n),u=(e+t)/(e-t),r=(r+n)/(r-n),n=-2*i;return a[0]=2*i/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o,a[6]=0,a[7]=0,a[8]=u,a[9]=r,a[10]=-1,a[11]=-1,a[12]=0,a[13]=0,a[14]=n,a[15]=0,a},at.computeViewportTransformation=function(t,e,n,r){I(r)||(r=new at),t=T(t,T.EMPTY_OBJECT);var i=T(t.x,0),a=T(t.y,0),o=T(t.width,0),u=T(t.height,0);e=T(e,0);var s=.5*o,t=.5*u,o=.5*((n=T(n,1))-e),u=t,n=o,i=i+s,t=a+t,o=e+o;return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=u,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n,r[11]=0,r[12]=i,r[13]=t,r[14]=o,r[15]=1,r},at.computeView=function(t,e,n,r,i){return i[0]=r.x,i[1]=n.x,i[2]=-e.x,i[3]=0,i[4]=r.y,i[5]=n.y,i[6]=-e.y,i[7]=0,i[8]=r.z,i[9]=n.z,i[10]=-e.z,i[11]=0,i[12]=-N.dot(r,t),i[13]=-N.dot(n,t),i[14]=N.dot(e,t),i[15]=1,i};var lt=new N,ht=new N,ct=new N;at.computeViewByLookAt=function(t,e,n,r){var i=lt,a=ht,o=ct;return N.subtract(t,e,i),N.normalize(i,i),N.cross(n,i,o),N.normalize(o,o),N.cross(i,o,a),N.normalize(a,a),at.computeView(t,i,a,o,r)},at.computeViewByLookAtEx=function(t,e,n,r){var i=lt,a=ht,o=ct;return N.subtract(e,t,i),N.normalize(i,i),N.cross(n,i,o),N.normalize(o,o),N.cross(i,o,a),N.normalize(a,a),at.computeView(t,i,a,o,r)},at.toArray=function(t,e){return I(e)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e):[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},at.getElementIndex=function(t,e){return 4*t+e},at.getColumn=function(t,e,n){var r=4*e,i=t[r],a=t[1+r],e=t[2+r],r=t[3+r];return n.x=i,n.y=a,n.z=e,n.w=r,n},at.setColumn=function(t,e,n,r){e*=4;return(r=at.clone(t,r))[e]=n.x,r[1+e]=n.y,r[2+e]=n.z,r[3+e]=n.w,r},at.setTranslation=function(t,e,n){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=t[15],n};var ft=new N;at.setScale=function(t,e,n){var r=at.getScale(t,ft),r=N.divideComponents(e,r,ft);return at.multiplyByScale(t,r,n)},at.getRow=function(t,e,n){var r=t[e],i=t[e+4],a=t[e+8],e=t[e+12];return n.x=r,n.y=i,n.z=a,n.w=e,n},at.setRow=function(t,e,n,r){return(r=at.clone(t,r))[e]=n.x,r[e+4]=n.y,r[e+8]=n.z,r[e+12]=n.w,r};var yt=new N;at.getScale=function(t,e){return e.x=N.magnitude(N.fromElements(t[0],t[1],t[2],yt)),e.y=N.magnitude(N.fromElements(t[4],t[5],t[6],yt)),e.z=N.magnitude(N.fromElements(t[8],t[9],t[10],yt)),e};var pt=new N;at.getMaximumScale=function(t){return at.getScale(t,pt),N.maximumComponent(pt)},at.multiply=function(t,e,n){var r=t[0],i=t[1],a=t[2],o=t[3],u=t[4],s=t[5],l=t[6],h=t[7],c=t[8],f=t[9],y=t[10],p=t[11],d=t[12],g=t[13],m=t[14],x=t[15],_=e[0],w=e[1],v=e[2],z=e[3],M=e[4],b=e[5],I=e[6],O=e[7],E=e[8],S=e[9],P=e[10],R=e[11],A=e[12],T=e[13],N=e[14],B=e[15],q=i*_+s*w+f*v+g*z,C=a*_+l*w+y*v+m*z,k=o*_+h*w+p*v+x*z,L=r*M+u*b+c*I+d*O,t=i*M+s*b+f*I+g*O,e=a*M+l*b+y*I+m*O,M=o*M+h*b+p*I+x*O,b=r*E+u*S+c*P+d*R,I=i*E+s*S+f*P+g*R,O=a*E+l*S+y*P+m*R,P=o*E+h*S+p*P+x*R,R=r*A+u*T+c*N+d*B,g=i*A+s*T+f*N+g*B,m=a*A+l*T+y*N+m*B,B=o*A+h*T+p*N+x*B;return n[0]=r*_+u*w+c*v+d*z,n[1]=q,n[2]=C,n[3]=k,n[4]=L,n[5]=t,n[6]=e,n[7]=M,n[8]=b,n[9]=I,n[10]=O,n[11]=P,n[12]=R,n[13]=g,n[14]=m,n[15]=B,n},at.add=function(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n[4]=t[4]+e[4],n[5]=t[5]+e[5],n[6]=t[6]+e[6],n[7]=t[7]+e[7],n[8]=t[8]+e[8],n[9]=t[9]+e[9],n[10]=t[10]+e[10],n[11]=t[11]+e[11],n[12]=t[12]+e[12],n[13]=t[13]+e[13],n[14]=t[14]+e[14],n[15]=t[15]+e[15],n},at.subtract=function(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n[3]=t[3]-e[3],n[4]=t[4]-e[4],n[5]=t[5]-e[5],n[6]=t[6]-e[6],n[7]=t[7]-e[7],n[8]=t[8]-e[8],n[9]=t[9]-e[9],n[10]=t[10]-e[10],n[11]=t[11]-e[11],n[12]=t[12]-e[12],n[13]=t[13]-e[13],n[14]=t[14]-e[14],n[15]=t[15]-e[15],n},at.multiplyTransformation=function(t,e,n){var r=t[0],i=t[1],a=t[2],o=t[4],u=t[5],s=t[6],l=t[8],h=t[9],c=t[10],f=t[12],y=t[13],p=t[14],d=e[0],g=e[1],m=e[2],x=e[4],_=e[5],w=e[6],v=e[8],z=e[9],M=e[10],b=e[12],I=e[13],O=e[14],E=i*d+u*g+h*m,S=a*d+s*g+c*m,t=r*x+o*_+l*w,e=i*x+u*_+h*w,x=a*x+s*_+c*w,_=r*v+o*z+l*M,w=i*v+u*z+h*M,M=a*v+s*z+c*M,f=r*b+o*I+l*O+f,y=i*b+u*I+h*O+y,p=a*b+s*I+c*O+p;return n[0]=r*d+o*g+l*m,n[1]=E,n[2]=S,n[3]=0,n[4]=t,n[5]=e,n[6]=x,n[7]=0,n[8]=_,n[9]=w,n[10]=M,n[11]=0,n[12]=f,n[13]=y,n[14]=p,n[15]=1,n},at.multiplyByMatrix3=function(t,e,n){var r=t[0],i=t[1],a=t[2],o=t[4],u=t[5],s=t[6],l=t[8],h=t[9],c=t[10],f=e[0],y=e[1],p=e[2],d=e[3],g=e[4],m=e[5],x=e[6],_=e[7],w=e[8],v=i*f+u*y+h*p,z=a*f+s*y+c*p,M=r*d+o*g+l*m,e=i*d+u*g+h*m,g=a*d+s*g+c*m,m=r*x+o*_+l*w,h=i*x+u*_+h*w,w=a*x+s*_+c*w;return n[0]=r*f+o*y+l*p,n[1]=v,n[2]=z,n[3]=0,n[4]=M,n[5]=e,n[6]=g,n[7]=0,n[8]=m,n[9]=h,n[10]=w,n[11]=0,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},at.multiplyByTranslation=function(t,e,n){var r=e.x,i=e.y,a=e.z,o=r*t[0]+i*t[4]+a*t[8]+t[12],e=r*t[1]+i*t[5]+a*t[9]+t[13],a=r*t[2]+i*t[6]+a*t[10]+t[14];return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=o,n[13]=e,n[14]=a,n[15]=t[15],n};var dt=new N;at.multiplyByUniformScale=function(t,e,n){return dt.x=e,dt.y=e,dt.z=e,at.multiplyByScale(t,dt,n)},at.multiplyByScale=function(t,e,n){var r=e.x,i=e.y,e=e.z;return 1===r&&1===i&&1===e?at.clone(t,n):(n[0]=r*t[0],n[1]=r*t[1],n[2]=r*t[2],n[3]=0,n[4]=i*t[4],n[5]=i*t[5],n[6]=i*t[6],n[7]=0,n[8]=e*t[8],n[9]=e*t[9],n[10]=e*t[10],n[11]=0,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=1,n)},at.multiplyByVector=function(t,e,n){var r=e.x,i=e.y,a=e.z,o=I(e.w)?e.w:1,u=t[0]*r+t[4]*i+t[8]*a+t[12]*o,s=t[1]*r+t[5]*i+t[9]*a+t[13]*o,e=t[2]*r+t[6]*i+t[10]*a+t[14]*o,o=t[3]*r+t[7]*i+t[11]*a+t[15]*o;return n.x=u,n.y=s,n.z=e,I(n.w)&&(n.w=o),n},at.multiplyByPointAsVector=function(t,e,n){var r=e.x,i=e.y,a=e.z,o=t[0]*r+t[4]*i+t[8]*a,e=t[1]*r+t[5]*i+t[9]*a,a=t[2]*r+t[6]*i+t[10]*a;return n.x=o,n.y=e,n.z=a,n},at.multiplyByPoint=function(t,e,n){var r=e.x,i=e.y,a=e.z,o=t[0]*r+t[4]*i+t[8]*a+t[12],e=t[1]*r+t[5]*i+t[9]*a+t[13],t=t[2]*r+t[6]*i+t[10]*a+t[14];return n.x=o,n.y=e,n.z=t,n},at.multiplyByScalar=function(t,e,n){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n[4]=t[4]*e,n[5]=t[5]*e,n[6]=t[6]*e,n[7]=t[7]*e,n[8]=t[8]*e,n[9]=t[9]*e,n[10]=t[10]*e,n[11]=t[11]*e,n[12]=t[12]*e,n[13]=t[13]*e,n[14]=t[14]*e,n[15]=t[15]*e,n},at.negate=function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e},at.transpose=function(t,e){var n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],u=t[11];return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[10]=t[10],e[11]=t[14],e[12]=i,e[13]=o,e[14]=u,e[15]=t[15],e},at.abs=function(t,e){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e[3]=Math.abs(t[3]),e[4]=Math.abs(t[4]),e[5]=Math.abs(t[5]),e[6]=Math.abs(t[6]),e[7]=Math.abs(t[7]),e[8]=Math.abs(t[8]),e[9]=Math.abs(t[9]),e[10]=Math.abs(t[10]),e[11]=Math.abs(t[11]),e[12]=Math.abs(t[12]),e[13]=Math.abs(t[13]),e[14]=Math.abs(t[14]),e[15]=Math.abs(t[15]),e},at.equals=function(t,e){return t===e||I(t)&&I(e)&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[3]===e[3]&&t[7]===e[7]&&t[11]===e[11]&&t[15]===e[15]},at.equalsEpsilon=function(t,e,n){return n=T(n,0),t===e||I(t)&&I(e)&&Math.abs(t[0]-e[0])<=n&&Math.abs(t[1]-e[1])<=n&&Math.abs(t[2]-e[2])<=n&&Math.abs(t[3]-e[3])<=n&&Math.abs(t[4]-e[4])<=n&&Math.abs(t[5]-e[5])<=n&&Math.abs(t[6]-e[6])<=n&&Math.abs(t[7]-e[7])<=n&&Math.abs(t[8]-e[8])<=n&&Math.abs(t[9]-e[9])<=n&&Math.abs(t[10]-e[10])<=n&&Math.abs(t[11]-e[11])<=n&&Math.abs(t[12]-e[12])<=n&&Math.abs(t[13]-e[13])<=n&&Math.abs(t[14]-e[14])<=n&&Math.abs(t[15]-e[15])<=n},at.getTranslation=function(t,e){return e.x=t[12],e.y=t[13],e.z=t[14],e},at.getMatrix3=function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e};var gt,mt,xt=new G,_t=new G,wt=new tt,vt=new tt(0,0,0,1);function zt(t,e,n,r){return Mt(t).then(e,n,r)}function Mt(t){var e,n,t=t instanceof bt?t:Et(t)?(e=Ot(),t.then(function(t){e.resolve(t)},function(t){e.reject(t)},function(t){e.progress(t)}),e.promise):(n=t,new bt(function(t){try{return Mt(t?t(n):n)}catch(t){return It(t)}}));return t}function bt(t){this.then=t}function It(n){return new bt(function(t,e){try{return e?Mt(e(n)):It(n)}catch(t){return It(t)}})}function Ot(){var t=new bt(i),o=[],u=[],r=function(e,n,r){var i=Ot(),a="function"==typeof r?function(t){try{i.progress(r(t))}catch(t){i.progress(t)}}:function(t){i.progress(t)};return o.push(function(t){t.then(e,n).then(i.resolve,i.reject,a)}),u.push(a),i.promise},e=function(t){return At(u,t),t},n=function(t){return t=Mt(t),r=t.then,n=Mt,e=Tt,At(o,t),u=o=gt,t};return{then:i,resolve:a,reject:s,progress:l,promise:t,resolver:{resolve:a,reject:s,progress:l}};function i(t,e,n){return r(t,e,n)}function a(t){return n(t)}function s(t){return n(It(t))}function l(t){return e(t)}}function Et(t){return t&&"function"==typeof t.then}function St(t,y,p,d,g){return zt(t,function(t){var e,n,r,i,a=t.length>>>0,o=Math.max(0,Math.min(y,a)),u=[],s=a-o+1,l=[],h=Ot();if(o)for(r=h.progress,n=function(t){l.push(t),--s||(e=n=Tt,h.reject(l))},e=function(t){u.push(t),--o||(e=n=Tt,h.resolve(u))},i=0;i<a;++i)i in t&&zt(t[i],f,c,r);else h.resolve(u);return h.then(p,d,g);function c(t){n(t)}function f(t){e(t)}})}function Pt(t,e,n,r){return Rt(t,Nt).then(e,n,r)}function Rt(t,u){return zt(t,function(t){var e,n,r,i=e=t.length>>>0,a=[],o=Ot();if(i)for(n=function(t,e){zt(t,u).then(function(t){a[e]=t,--i||o.resolve(a)},o.reject)},r=0;r<e;r++)r in t?n(t[r],r):--i;else o.resolve(a);return o.promise})}function At(t,e){for(var n,r=0;n=t[r++];)n(e)}function Tt(){}function Nt(t){return t}at.inverse=function(t,e){var n=t[0],r=t[4],i=t[8],a=t[12],o=t[1],u=t[5],s=t[9],l=t[13],h=t[2],c=t[6],f=t[10],y=t[14],p=t[3],d=t[7],g=t[11],m=t[15],x=f*m,_=y*g,w=c*m,v=y*d,z=c*g,M=f*d,b=h*m,I=y*p,O=h*g,E=f*p,S=h*d,P=c*p,R=x*u+v*s+z*l-(_*u+w*s+M*l),A=_*o+b*s+E*l-(x*o+I*s+O*l),T=w*o+I*u+S*l-(v*o+b*u+P*l),N=M*o+O*u+P*s-(z*o+E*u+S*s),B=_*r+w*i+M*a-(x*r+v*i+z*a),q=x*n+I*i+O*a-(_*n+b*i+E*a),C=v*n+b*r+P*a-(w*n+I*r+S*a),k=z*n+E*r+S*i-(M*n+O*r+P*i),L=(x=i*l)*d+(v=a*u)*g+(z=r*s)*m-((_=a*s)*d+(w=r*l)*g+(M=i*u)*m),s=_*p+(b=n*l)*g+(E=i*o)*m-(x*p+(I=a*o)*g+(O=n*s)*m),m=w*p+I*d+(S=n*u)*m-(v*p+b*d+(P=r*o)*m),d=M*p+O*d+P*g-(z*p+E*d+S*g),g=w*f+M*y+_*c-(z*y+x*c+v*f),_=O*y+x*h+I*f-(b*f+E*y+_*h),I=b*c+P*y+v*h-(S*y+w*h+I*c),h=S*f+z*h+E*c-(O*c+P*f+M*h),a=n*R+r*A+i*T+a*N;return Math.abs(a)<U.EPSILON21&&G.equalsEpsilon(at.getMatrix3(t,xt),_t,U.EPSILON7)&&tt.equals(at.getRow(t,3,wt),vt)?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=0,e[11]=0,e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=1):(e[0]=R*(a=1/a),e[1]=A*a,e[2]=T*a,e[3]=N*a,e[4]=B*a,e[5]=q*a,e[6]=C*a,e[7]=k*a,e[8]=L*a,e[9]=s*a,e[10]=m*a,e[11]=d*a,e[12]=g*a,e[13]=_*a,e[14]=I*a,e[15]=h*a),e},at.inverseTransformation=function(t,e){var n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],u=t[6],s=t[8],l=t[9],h=t[10],c=t[12],f=t[13],y=t[14],p=-n*c-r*f-i*y,t=-a*c-o*f-u*y,y=-s*c-l*f-h*y;return e[0]=n,e[1]=a,e[2]=s,e[3]=0,e[4]=r,e[5]=o,e[6]=l,e[7]=0,e[8]=i,e[9]=u,e[10]=h,e[11]=0,e[12]=p,e[13]=t,e[14]=y,e[15]=1,e},at.IDENTITY=Object.freeze(new at(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),at.ZERO=Object.freeze(new at(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),at.TRANSYZ=Object.freeze(new at(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1)),at.COLUMN0ROW0=0,at.COLUMN0ROW1=1,at.COLUMN0ROW2=2,at.COLUMN0ROW3=3,at.COLUMN1ROW0=4,at.COLUMN1ROW1=5,at.COLUMN1ROW2=6,at.COLUMN1ROW3=7,at.COLUMN2ROW0=8,at.COLUMN2ROW1=9,at.COLUMN2ROW2=10,at.COLUMN2ROW3=11,at.COLUMN3ROW0=12,at.COLUMN3ROW1=13,at.COLUMN3ROW2=14,at.COLUMN3ROW3=15,Object.defineProperties(at.prototype,{length:{get:function(){return at.packedLength}}}),at.prototype.clone=function(t){return at.clone(this,t)},at.prototype.equals=function(t){return at.equals(this,t)},at.equalsArray=function(t,e,n){return t[0]===e[n]&&t[1]===e[n+1]&&t[2]===e[n+2]&&t[3]===e[n+3]&&t[4]===e[n+4]&&t[5]===e[n+5]&&t[6]===e[n+6]&&t[7]===e[n+7]&&t[8]===e[n+8]&&t[9]===e[n+9]&&t[10]===e[n+10]&&t[11]===e[n+11]&&t[12]===e[n+12]&&t[13]===e[n+13]&&t[14]===e[n+14]&&t[15]===e[n+15]},at.prototype.equalsEpsilon=function(t,e){return at.equalsEpsilon(this,t,e)},at.prototype.toString=function(){return"("+this[0]+", "+this[4]+", "+this[8]+", "+this[12]+")\n("+this[1]+", "+this[5]+", "+this[9]+", "+this[13]+")\n("+this[2]+", "+this[6]+", "+this[10]+", "+this[14]+")\n("+this[3]+", "+this[7]+", "+this[11]+", "+this[15]+")"},at.from_tnbp=function(t,e,n,r,i){return I(i)?(i[0]=t.x,i[4]=e.x,i[8]=n.x,i[12]=r.x,i[1]=t.y,i[5]=e.y,i[9]=n.y,i[13]=r.y,i[2]=t.z,i[6]=e.z,i[10]=n.z,i[14]=r.z,i[3]=0,i[7]=0,i[11]=0,i[15]=1):i=new at(t.x,e.x,n.x,r.x,t.y,e.y,n.y,r.y,t.z,e.z,n.z,r.z,0,0,0,1),i},at.rotate_axis_rh=function(t,e,n){var r=at.clone(at.IDENTITY),i=N.distance(e,t),a=Math.cos(n),o=1-a,u=Math.sin(n),s=(e.x-t.x)/i,n=(e.y-t.y)/i,i=(e.z-t.z)/i;r[0]=s*s*o+a,r[1]=s*n*o-i*u,r[2]=s*i*o+n*u,r[4]=n*s*o+i*u,r[5]=n*n*o+a,r[6]=n*i*o-s*u,r[8]=i*s*o-n*u,r[9]=i*n*o+s*u,r[10]=i*i*o+a;a=at.translation(-t.x,-t.y,-t.z),t=at.translation(t.x,t.y,t.z);return at.multiply(t,at.multiply(r,a,new at),new at)},at.rotate_axis_lh=function(t,e,n){var r=at.clone(at.IDENTITY),i=N.distance(e,t),a=Math.cos(n),o=1-a,u=Math.sin(n),s=(e.x-t.x)/i,n=(e.y-t.y)/i,i=(e.z-t.z)/i;r[0]=s*s*o+a,r[1]=s*n*o+i*u,r[2]=s*i*o-n*u,r[4]=n*s*o-i*u,r[5]=n*n*o+a,r[6]=n*i*o+s*u,r[8]=i*s*o+n*u,r[9]=i*n*o-s*u,r[10]=i*i*o+a;a=at.translation(-t.x,-t.y,-t.z),t=at.translation(t.x,t.y,t.z);return at.multiply(a,at.multiply(r,t,new at),new at)},at.translation=function(t,e,n,r){r=at.clone(at.IDENTITY,r);return r[12]=t,r[13]=e,r[14]=n,r},at.scaling=function(t,e,n,r){r=at.clone(at.IDENTITY,r);return r[0]=t,r[5]=e,r[10]=n,r},at.rotate_y=function(t){var e=at.clone(at.IDENTITY);return e[0]=e[10]=Math.cos(t),e[2]=e[8]=Math.sin(t),e[2]=-e[2],e},at.perspective=function(t,e,n,r,i){var a=1/Math.tan(.5*t),t=r/(r-n),r=r*n/(n-r);return i[0]=a/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t,i[11]=-1,i[12]=0,i[13]=0,i[14]=r,i[15]=0,i},at.prototype.makeRotationAxis=function(t,e,n){I(n)||(n=new at);var r=Math.cos(e),i=Math.sin(e),a=1-r,o=t.x,u=t.y,s=t.z,e=a*o,t=a*u;return n[0]=e*o+r,n[1]=e*u+i*s,n[2]=e*s-i*u,n[3]=0,n[4]=e*u-i*s,n[5]=t*u+r,n[6]=t*s+i*o,n[7]=0,n[8]=e*s+i*u,n[9]=t*s-i*o,n[10]=a*s*s+r,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},at.transformNormal=function(t,e,n){I(n)||(n=new N);var r=new N;r.x=e[0]*t.x+e[4]*t.y+e[8]*t.z+e[12],r.y=e[1]*t.x+e[5]*t.y+e[9]*t.z+e[13],r.z=e[2]*t.x+e[6]*t.y+e[10]*t.z+e[14];e=e[3]*t.x+e[7]*t.y+e[11]*t.z+e[15];return r.x*=e=1/e,r.y*=e,r.z*=e,N.clone(r,n),n},at.rotate_normal=function(t,e,n){I(n)||(n=new N);var r=new N;return r.x=e[0]*t.x+e[4]*t.y+e[8]*t.z,r.y=e[1]*t.x+e[5]*t.y+e[9]*t.z,r.z=e[2]*t.x+e[6]*t.y+e[10]*t.z,N.clone(r,n),r},at.fromQuaternion=function(t,e){void 0===e&&(e=new at),e=at.clone(at.IDENTITY,e);var n=t.x*t.x,r=t.x*t.y,i=t.x*t.z,a=t.x*t.w,o=t.y*t.y,u=t.y*t.z,s=t.y*t.w,l=t.z*t.z,t=t.z*t.w;return e[0]=1-2*(o+l),e[1]=2*(r+t),e[2]=2*(i-s),e[4]=2*(r-t),e[5]=1-2*(n+l),e[6]=2*(u+a),e[8]=2*(i+s),e[9]=2*(u-a),e[10]=1-2*(n+o),e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1,e},zt.defer=Ot,zt.resolve=Mt,zt.reject=function(t){return zt(t,It)},zt.join=function(){return Rt(arguments,Nt)},zt.all=Pt,zt.map=Rt,zt.reduce=function(t,a){var e=Kt.call(arguments,1);return zt(t,function(t){var i=t.length;return e[0]=function(t,n,r){return zt(t,function(e){return zt(n,function(t){return a(e,t,r,i)})})},Qt.apply(t,e)})},zt.any=function(t,e,n,r){return St(t,1,function(t){return e?e(t[0]):t[0]},n,r)},zt.some=St,zt.chain=function(t,e,n){var r=2<arguments.length;return zt(t,function(t){return e.resolve(t=r?n:t),t},function(t){return e.reject(t),It(t)},e.progress)},zt.isPromise=Et,bt.prototype={always:function(t,e){return this.then(t,t,e)},otherwise:function(t){return this.then(gt,t)},yield:function(t){return this.then(function(){return t})},spread:function(e){return this.then(function(t){return Pt(t,function(t){return e.apply(gt,t)})})}};var Bt,qt,Ct,kt,Lt,Ut,Dt,Wt,Vt,Xt,Zt,Yt,Gt,jt,Ft,Ht,Jt,Kt=[].slice,Qt=[].reduce||function(t){var e,n=0,r=Object(this),i=r.length>>>0,a=arguments;if(a.length<=1)for(;;){if(n in r){e=r[n++];break}if(++n>=i)throw new TypeError}else e=a[1];for(;n<i;++n)n in r&&(e=t(e,r[n],n,r));return e},$t={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},te={};function ee(t){for(var e=t.split("."),n=0,r=e.length;n<r;++n)e[n]=parseInt(e[n],10);return e}function ne(){var t;return I(qt)||(qt=!1,oe()||null!==(t=/ Chrome\/([\.0-9]+)/.exec(Bt.userAgent))&&(qt=!0,Ct=ee(t[1]))),qt}function re(){var t;return I(kt)||(kt=!1,ne()||oe()||!/ Safari\/[\.0-9]+/.test(Bt.userAgent)||null!==(t=/ Version\/([\.0-9]+)/.exec(Bt.userAgent))&&(kt=!0,Lt=ee(t[1]))),kt}function ie(){var t;return I(Ut)||(Ut=!1,null!==(t=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(Bt.userAgent))&&(Ut=!0,(Dt=ee(t[1])).isNightly=!!t[2])),Ut}function ae(){var t;return I(Wt)||(Wt=!1,"Microsoft Internet Explorer"===Bt.appName?null!==(t=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(Bt.userAgent))&&(Wt=!0,Vt=ee(t[1])):"Netscape"===Bt.appName&&null!==(t=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(Bt.userAgent))&&(Wt=!0,Vt=ee(t[1]))),Wt}function oe(){var t;return I(Xt)||(Xt=!1,null!==(t=/ Edge\/([\.0-9]+)/.exec(Bt.userAgent))&&(Xt=!0,Zt=ee(t[1]))),Xt}function ue(){var t;return I(Yt)||(Yt=!1,null!==(t=/Firefox\/([\.0-9]+)/.exec(Bt.userAgent))&&(Yt=!0,Gt=ee(t[1]))),Yt}function se(){var t;return I(Jt)||((t=document.createElement("canvas")).setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;"),t=t.style.imageRendering,(Jt=I(t)&&""!==t)&&(Ht=t)),Jt}function le(){return le._result}Object.defineProperties(te,{element:{get:function(){if(te.supportsFullscreen())return document[$t.fullscreenElement]}},changeEventName:{get:function(){if(te.supportsFullscreen())return $t.fullscreenchange}},errorEventName:{get:function(){if(te.supportsFullscreen())return $t.fullscreenerror}},enabled:{get:function(){if(te.supportsFullscreen())return document[$t.fullscreenEnabled]}},fullscreen:{get:function(){if(te.supportsFullscreen())return null!==te.element}}}),te.supportsFullscreen=function(){if(I(mt))return mt;mt=!1;var t=document.body;if("function"==typeof t.requestFullscreen)return $t.requestFullscreen="requestFullscreen",$t.exitFullscreen="exitFullscreen",$t.fullscreenEnabled="fullscreenEnabled",$t.fullscreenElement="fullscreenElement",$t.fullscreenchange="fullscreenchange",$t.fullscreenerror="fullscreenerror",mt=!0;for(var e=["webkit","moz","o","ms","khtml"],n=0,r=e.length;n<r;++n){var i,a=e[n];"function"!=typeof t[i=a+"RequestFullscreen"]&&"function"!=typeof t[i=a+"RequestFullScreen"]||($t.requestFullscreen=i,mt=!0),i=a+"ExitFullscreen","function"==typeof document[i]?$t.exitFullscreen=i:(i=a+"CancelFullScreen","function"==typeof document[i]&&($t.exitFullscreen=i)),i=a+"FullscreenEnabled",void 0!==document[i]?$t.fullscreenEnabled=i:(i=a+"FullScreenEnabled",void 0!==document[i]&&($t.fullscreenEnabled=i)),i=a+"FullscreenElement",void 0!==document[i]?$t.fullscreenElement=i:(i=a+"FullScreenElement",void 0!==document[i]&&($t.fullscreenElement=i)),i=a+"fullscreenchange",void 0!==document["on"+i]&&($t.fullscreenchange=i="ms"===a?"MSFullscreenChange":i),i=a+"fullscreenerror",void 0!==document["on"+i]&&($t.fullscreenerror=i="ms"===a?"MSFullscreenError":i)}return mt},te.requestFullscreen=function(t,e){te.supportsFullscreen()&&t[$t.requestFullscreen]({vrDisplay:e})},te.exitFullscreen=function(){te.supportsFullscreen()&&document[$t.exitFullscreen]()},te._names=$t,Bt="undefined"!=typeof navigator?navigator:{},le._promise=void 0,le._result=void 0,le.initialize=function(){if(I(le._promise))return le._promise;var t=zt.defer();if(le._promise=t.promise,oe())return le._result=!1,t.resolve(le._result),t.promise;var e=new Image;return e.onload=function(){le._result=0<e.width&&0<e.height,t.resolve(le._result)},e.onerror=function(){le._result=!1,t.resolve(le._result)},e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.promise},Object.defineProperties(le,{initialized:{get:function(){return I(le._result)}}});var he=[];"undefined"!=typeof ArrayBuffer&&(he.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!=typeof Uint8ClampedArray&&he.push(Uint8ClampedArray),"undefined"!=typeof Uint8ClampedArray&&he.push(Uint8ClampedArray));var ce={isChrome:ne,chromeVersion:function(){return ne()&&Ct},isSafari:re,safariVersion:function(){return re()&&Lt},isWebkit:ie,webkitVersion:function(){return ie()&&Dt},isInternetExplorer:ae,internetExplorerVersion:function(){return ae()&&Vt},isEdge:oe,edgeVersion:function(){return oe()&&Zt},isFirefox:ue,firefoxVersion:function(){return ue()&&Gt},isWindows:function(){return jt=!I(jt)?/Windows/i.test(Bt.appVersion):jt},hardwareConcurrency:T(Bt.hardwareConcurrency,3),supportsPointerEvents:function(){return Ft=!I(Ft)?!ue()&&"undefined"!=typeof PointerEvent&&(!I(Bt.pointerEnabled)||Bt.pointerEnabled):Ft},supportsImageRenderingPixelated:se,supportsWebP:le,imageRenderingValue:function(){return se()?Ht:void 0},typedArrayTypes:he};function fe(t,e,n,r){this.x=T(t,0),this.y=T(e,0),this.z=T(n,0),this.w=T(r,0)}ce.supportsFullscreen=function(){return te.supportsFullscreen()},ce.supportsTypedArrays=function(){return"undefined"!=typeof ArrayBuffer},ce.supportsWebWorkers=function(){return"undefined"!=typeof Worker},ce.supportsWebAssembly=function(){return"undefined"!=typeof WebAssembly&&!ce.isEdge()};var ye=new N;fe.fromAxisAngle=function(t,e,n){var r=e/2,i=Math.sin(r),e=(ye=N.normalize(t,ye)).x*i,t=ye.y*i,i=ye.z*i,r=Math.cos(r);return I(n)?(n.x=e,n.y=t,n.z=i,n.w=r,n):new fe(e,t,i,r)};var pe=[1,2,0],de=new Array(3);fe.fromRotationMatrix=function(t,e){var n,r,i,a,o=t[G.COLUMN0ROW0],u=t[G.COLUMN1ROW1],s=t[G.COLUMN2ROW2],l=o+u+s,h=0<l?(i=.5*(a=Math.sqrt(l+1)),n=(t[G.COLUMN1ROW2]-t[G.COLUMN2ROW1])*(a=.5/a),r=(t[G.COLUMN2ROW0]-t[G.COLUMN0ROW2])*a,(t[G.COLUMN0ROW1]-t[G.COLUMN1ROW0])*a):(u=pe[o=pe[s=o<s&&u<s?2:o<u?1:0]],a=Math.sqrt(t[G.getElementIndex(s,s)]-t[G.getElementIndex(o,o)]-t[G.getElementIndex(u,u)]+1),(h=de)[s]=.5*a,a=.5/a,i=(t[G.getElementIndex(u,o)]-t[G.getElementIndex(o,u)])*a,h[o]=(t[G.getElementIndex(o,s)]+t[G.getElementIndex(s,o)])*a,h[u]=(t[G.getElementIndex(u,s)]+t[G.getElementIndex(s,u)])*a,n=-h[0],r=-h[1],-h[2]);return I(e)?(e.x=n,e.y=r,e.z=h,e.w=i,e):new fe(n,r,h,i)};var ge,me,xe,_e=new fe;new fe,new fe,new fe;fe.fromHeadingPitchRoll=function(t,e){return xe=fe.fromAxisAngle(N.UNIT_X,t.roll,_e),me=fe.fromAxisAngle(N.UNIT_Y,-t.pitch,e),e=fe.multiply(me,xe,me),ge=fe.fromAxisAngle(N.UNIT_Z,-t.heading,_e),fe.multiply(ge,e,e)};var we=new N,ve=new N;fe.fromNormal=function(t,e,n){var r=N.add(t,e,we);N.normalize(r,r);var i,a,o,u,s=N.dot(t,r),e=s;return u=0!=s?(a=(i=N.cross(t,r,ve)).x,o=i.y,i.z):Math.abs(t.x)>=Math.abs(t.y)?(u=1/Math.sqrt(t.x*t.x+t.z*t.z),a=-t.z*u,o=0,t.x*u):(u=1/Math.sqrt(t.x*t.x+t.z*t.z),a=0,o=t.z*u,-t.y*u),I(n)?(n.x=a,n.y=o,n.z=u,n.w=e,n):new fe(a,o,u,e)};var ze=new N,Me=new N,be=new fe,Ie=new fe,Oe=new fe;fe.packedLength=4,fe.pack=function(t,e,n){return n=T(n,0),e[n++]=t.x,e[n++]=t.y,e[n++]=t.z,e[n]=t.w,e},fe.unpack=function(t,e,n){return e=T(e,0),(n=!I(n)?new fe:n).x=t[e],n.y=t[e+1],n.z=t[e+2],n.w=t[e+3],n},fe.packedInterpolationLength=3,fe.convertPackedArrayForInterpolation=function(t,e,n,r){fe.unpack(t,4*n,Oe),fe.conjugate(Oe,Oe);for(var i=0,a=n-e+1;i<a;i++){var o=3*i;fe.unpack(t,4*(e+i),be),fe.multiply(be,Oe,be),be.w<0&&fe.negate(be,be),fe.computeAxis(be,ze);var u=fe.computeAngle(be);(r=!I(r)?[]:r)[o]=ze.x*u,r[1+o]=ze.y*u,r[2+o]=ze.z*u}},fe.unpackInterpolationResult=function(t,e,n,r,i){I(i)||(i=new fe),N.fromArray(t,0,Me);t=N.magnitude(Me);return fe.unpack(e,4*r,Ie),0===t?fe.clone(fe.IDENTITY,be):fe.fromAxisAngle(Me,t,be),fe.multiply(be,Ie,i)},fe.clone=function(t,e){if(I(t))return I(e)?(e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e):new fe(t.x,t.y,t.z,t.w)},fe.conjugate=function(t,e){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w,e},fe.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},fe.magnitude=function(t){return Math.sqrt(fe.magnitudeSquared(t))},fe.normalize=function(t,e){var n=1/fe.magnitude(t),r=t.x*n,i=t.y*n,a=t.z*n,n=t.w*n;return e.x=r,e.y=i,e.z=a,e.w=n,e},fe.inverse=function(t,e){var n=fe.magnitudeSquared(t);return e=fe.conjugate(t,e),fe.multiplyByScalar(e,1/n,e)},fe.add=function(t,e,n){return n.x=t.x+e.x,n.y=t.y+e.y,n.z=t.z+e.z,n.w=t.w+e.w,n},fe.subtract=function(t,e,n){return n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n.w=t.w-e.w,n},fe.negate=function(t,e){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=-t.w,e},fe.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},fe.multiply=function(t,e,n){var r=t.x,i=t.y,a=t.z,o=t.w,u=e.x,s=e.y,l=e.z,h=e.w,c=o*s-r*l+i*h+a*u,t=o*l+r*s-i*u+a*h,e=o*h-r*u-i*s-a*l;return n.x=o*u+r*h+i*l-a*s,n.y=c,n.z=t,n.w=e,n},fe.multiplyByScalar=function(t,e,n){return n.x=t.x*e,n.y=t.y*e,n.z=t.z*e,n.w=t.w*e,n},fe.divideByScalar=function(t,e,n){return n.x=t.x/e,n.y=t.y/e,n.z=t.z/e,n.w=t.w/e,n},fe.computeAxis=function(t,e){var n=t.w;if(Math.abs(n-1)<U.EPSILON6)return e.x=e.y=e.z=0,e;n=1/Math.sqrt(1-n*n);return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},fe.computeAngle=function(t){return Math.abs(t.w-1)<U.EPSILON6?0:2*Math.acos(t.w)};var Ee=new fe;fe.lerp=function(t,e,n,r){return Ee=fe.multiplyByScalar(e,n,Ee),r=fe.multiplyByScalar(t,1-n,r),fe.add(Ee,r,r)};var Se=new fe,Pe=new fe,Re=new fe;fe.slerp=function(t,e,n,r){var i=fe.dot(t,e),a=e;if(i<0&&(i=-i,a=Se=fe.negate(e,Se)),1-i<U.EPSILON6)return fe.lerp(t,a,n,r);i=Math.acos(i);return Pe=fe.multiplyByScalar(t,Math.sin((1-n)*i),Pe),Re=fe.multiplyByScalar(a,Math.sin(n*i),Re),r=fe.add(Pe,Re,r),fe.multiplyByScalar(r,1/Math.sin(i),r)},fe.log=function(t,e){var n=U.acosClamped(t.w),r=0;return 0!==n&&(r=n/Math.sin(n)),N.multiplyByScalar(t,r,e)},fe.exp=function(t,e){var n=N.magnitude(t),r=0;return 0!==n&&(r=Math.sin(n)/n),e.x=t.x*r,e.y=t.y*r,e.z=t.z*r,e.w=Math.cos(n),e};var Ae=new N,Te=new N,Ne=new fe,Be=new fe;fe.computeInnerQuadrangle=function(t,e,n,r){var i=fe.conjugate(e,Ne);fe.multiply(i,n,Be);n=fe.log(Be,Ae);fe.multiply(i,t,Be);t=fe.log(Be,Te);return N.add(n,t,n),N.multiplyByScalar(n,.25,n),N.negate(n,n),fe.exp(n,Ne),fe.multiply(e,Ne,r)},fe.squad=function(t,e,n,r,i,a){e=fe.slerp(t,e,i,Ne),r=fe.slerp(n,r,i,Be);return fe.slerp(e,r,2*i*(1-i),a)};for(var qe=new fe,he=1.9011074535173003,Ce=ce.supportsTypedArrays()?new Float32Array(8):[],ke=ce.supportsTypedArrays()?new Float32Array(8):[],Le=ce.supportsTypedArrays()?new Float32Array(8):[],Ue=ce.supportsTypedArrays()?new Float32Array(8):[],De=0;De<7;++De){var We=De+1,Ve=2*We+1;Ce[De]=1/(We*Ve),ke[De]=We/Ve}function Xe(t,e,n){this.heading=T(t,0),this.pitch=T(e,0),this.roll=T(n,0)}Ce[7]=he/136,ke[7]=8*he/17,fe.fastSlerp=function(t,e,n,r){var i,a=fe.dot(t,e);0<=a?i=1:(i=-1,a=-a);for(var o=a-1,a=1-n,u=n*n,s=a*a,l=7;0<=l;--l)Le[l]=(Ce[l]*u-ke[l])*o,Ue[l]=(Ce[l]*s-ke[l])*o;n=i*n*(1+Le[0]*(1+Le[1]*(1+Le[2]*(1+Le[3]*(1+Le[4]*(1+Le[5]*(1+Le[6]*(1+Le[7])))))))),a*=1+Ue[0]*(1+Ue[1]*(1+Ue[2]*(1+Ue[3]*(1+Ue[4]*(1+Ue[5]*(1+Ue[6]*(1+Ue[7]))))))),a=fe.multiplyByScalar(t,a,qe);return fe.multiplyByScalar(e,n,r),fe.add(a,r,r)},fe.fastSquad=function(t,e,n,r,i,a){e=fe.fastSlerp(t,e,i,Ne),r=fe.fastSlerp(n,r,i,Be);return fe.fastSlerp(e,r,2*i*(1-i),a)},fe.equals=function(t,e){return t===e||I(t)&&I(e)&&t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},fe.equalsEpsilon=function(t,e,n){return n=T(n,0),t===e||I(t)&&I(e)&&Math.abs(t.x-e.x)<=n&&Math.abs(t.y-e.y)<=n&&Math.abs(t.z-e.z)<=n&&Math.abs(t.w-e.w)<=n},fe.ZERO=Object.freeze(new fe(0,0,0,0)),fe.IDENTITY=Object.freeze(new fe(0,0,0,1)),fe.prototype.clone=function(t){return fe.clone(this,t)},fe.prototype.equals=function(t){return fe.equals(this,t)},fe.prototype.equalsEpsilon=function(t,e){return fe.equalsEpsilon(this,t,e)},fe.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},fe.from_euler=function(t,e,n,r){var i=Math.cos(.5*e),a=Math.cos(.5*n),o=Math.cos(.5*t),u=Math.sin(.5*e),s=Math.sin(.5*n),l=Math.sin(.5*t),e=i*a*o-u*s*l,n=u*s*o+i*a*l,t=u*a*o+i*s*l,l=i*s*o-u*a*l;return I(r)?(r.x=n,r.y=t,r.z=l,r.w=e,r):r=new fe(n,t,l,e)},fe.to_euler=function(t,e){I(e)||(e=new N);var n=t.w,r=t.x,i=t.y,a=t.z,o=r*r,u=i*i,s=a*a,t=r*i+a*n;return.499<t?(e.x=0,e.y=2*Math.atan2(r,n),e.z=U.PI_OVER_TWO):t<-.499?(e.x=0,e.y=2*-Math.atan2(r,n),e.z=-U.PI_OVER_TWO):(e.y=Math.atan2(2*i*n-2*r*a,1-2*u-2*s),e.z=Math.asin(2*r*i+2*a*n),e.x=Math.atan2(2*r*n-2*i*a,1-2*o-2*s)),e},Xe.fromQuaternion=function(t,e){I(e)||(e=new Xe);var n=2*(t.w*t.y-t.z*t.x),r=1-2*(t.x*t.x+t.y*t.y),i=2*(t.w*t.x+t.y*t.z),a=1-2*(t.y*t.y+t.z*t.z),t=2*(t.w*t.z+t.x*t.y);return e.heading=-Math.atan2(t,a),e.roll=Math.atan2(i,r),e.pitch=-U.asinClamped(n),e},Xe.fromDegrees=function(t,e,n,r){return(r=!I(r)?new Xe:r).heading=t*U.RADIANS_PER_DEGREE,r.pitch=e*U.RADIANS_PER_DEGREE,r.roll=n*U.RADIANS_PER_DEGREE,r},Xe.clone=function(t,e){if(I(t))return I(e)?(e.heading=t.heading,e.pitch=t.pitch,e.roll=t.roll,e):new Xe(t.heading,t.pitch,t.roll)},Xe.equals=function(t,e){return t===e||I(t)&&I(e)&&t.heading===e.heading&&t.pitch===e.pitch&&t.roll===e.roll},Xe.equalsEpsilon=function(t,e,n,r){return t===e||I(t)&&I(e)&&U.equalsEpsilon(t.heading,e.heading,n,r)&&U.equalsEpsilon(t.pitch,e.pitch,n,r)&&U.equalsEpsilon(t.roll,e.roll,n,r)},Xe.prototype.clone=function(t){return Xe.clone(this,t)},Xe.prototype.equals=function(t){return Xe.equals(this,t)},Xe.prototype.equalsEpsilon=function(t,e,n){return Xe.equalsEpsilon(this,t,e,n)},Xe.prototype.toString=function(){return"("+this.heading+", "+this.pitch+", "+this.roll+")"};var Ze={transform_from_cartesian_d:function(t,e,n){var r=M.WGS84,i=new N;i.x=2*t/r.radiiSquared.x,i.y=2*e/r.radiiSquared.z,i.z=2*n/r.radiiSquared.y,N.normalize(i,i);var a=new N;N.cross(i,N.UNIT_Y,a),N.normalize(a,a);r=new N;return N.cross(a,i,r),N.normalize(r,r),new at(a.x,i.x,r.x,t,a.y,i.y,r.y,e,a.z,i.z,r.z,n,0,0,0,1)}},Ye={};function Ge(t){this.longitude=T(t.longitude,0),this.latitude=T(t.latitude,0),this.altitude=T(t.altitude,0),this.heading=T(t.heading,0),this.tilt=T(t.tilt,0),this.roll=T(t.roll,0),this.scale=T(t.scale,new N(1,1,1)),this.mat_tnb=new at,this.mat_tnb_inverse=new at,this.parent_object=T(t.parent_object,void 0),I(t.longitude)&&I(t.latitude)&&I(t.altitude)?Ke(this):(at.clone(at.IDENTITY,this.mat_tnb),at.clone(at.IDENTITY,this.mat_tnb_inverse))}function je(t){var e=t.z;t.z=t.y,t.y=e}Ye.transform_from_geocentric_d=function(t){var e=M.WGS84,n=new N;n.x=2*t.x/e.radiiSquared.x,n.y=2*t.z/e.radiiSquared.z,n.z=2*t.y/e.radiiSquared.y,N.normalize(n,n);var r=N.cross(n,N.UNIT_Y,new N);N.normalize(r,r);e=N.cross(r,n,new N);N.normalize(e,e);t=new at(r.x,n.x,e.x,t.x,r.y,n.y,e.y,t.z,r.z,n.z,e.z,t.y,0,0,0,1);return at.multiply(at.TRANSYZ,t,t),at.inverse(t,t)};var Fe=new Xe,He=new fe,Je=new G;function Ke(t){var e=N.fromRadians(t.longitude,t.latitude,t.altitude),n=Ze.transform_from_cartesian_d(e.x,e.z,e.y);at.multiply(at.TRANSYZ,n,n),Fe.heading=t.heading,Fe.pitch=t.tilt,Fe.roll=t.roll,Fe.heading=Fe.heading-U.PI_OVER_TWO;var r=fe.fromHeadingPitchRoll(Fe,He),i=G.fromQuaternion(r,Je),a=new N,e=new N,r=new N;G.getColumn(i,0,a),G.getColumn(i,2,e),N.cross(a,e,r),N.normalize(a,a),N.normalize(e,e),N.normalize(r,r),je(a),je(e),je(r);a=at.from_tnbp(r,e,a,N.ZERO);t.mat_tnb=at.multiplyByScale(at.IDENTITY,t.scale,t.mat_tnb),at.multiply(a,t.mat_tnb,t.mat_tnb),at.multiply(n,t.mat_tnb,t.mat_tnb),t.mat_tnb_inverse=at.inverse(t.mat_tnb,t.mat_tnb_inverse)}function Qe(t,e){t=U.equalsEpsilon(Math.abs(t.y),1,U.EPSILON3)?Math.atan2(e.z,e.x)-U.PI_OVER_TWO:Math.atan2(t.z,t.x)-U.PI_OVER_TWO;return U.TWO_PI-U.zeroToTwoPi(t)}function $e(t){return U.PI_OVER_TWO-U.acosClamped(t.y)}function tn(t,e,n){var r=0;return U.equalsEpsilon(Math.abs(t.y),1,U.EPSILON3)||(r=Math.atan2(-n.y,e.y),r=U.zeroToTwoPi(r+U.TWO_PI)),r}function en(t,e,n){n=n||2;var r,i,a,o,u,s=e&&e.length,l=s?e[0]*n:t.length,h=nn(t,0,l,n,!0),c=[];if(!h||h.next===h.prev)return c;if(s&&(h=function(t,e,n,r){var i,a,o,u,s=[];for(i=0,a=e.length;i<a;i++)o=e[i]*r,u=i<a-1?e[i+1]*r:t.length,(u=nn(t,o,u,r,!1))===u.next&&(u.steiner=!0),s.push(function(t){var e=t,n=t;for(;(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next,e!==t;);return n}(u));for(s.sort(on),i=0;i<s.length;i++)!function(t,e){(e=function(t,e){var n,r=e,i=t.x,a=t.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var u=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(u<=i&&o<u){if((o=u)===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}}while(r=r.next,r!==e);if(!n)return null;if(i===o)return n.prev;var s,l=n,h=n.x,c=n.y,f=1/0;r=n.next;for(;r!==l;)i>=r.x&&r.x>=h&&i!==r.x&&sn(a<c?i:o,a,h,c,a<c?o:i,a,r.x,r.y)&&((s=Math.abs(a-r.y)/(i-r.x))<f||s===f&&r.x>n.x)&&fn(r,t)&&(n=r,f=s),r=r.next;return n}(t,e))&&rn(t=yn(e,t),t.next)}(s[i],n),n=rn(n,n.next);return n}(t,e,h,n)),t.length>80*n){for(var f=r=t[0],y=i=t[1],p=n;p<l;p+=n)(a=t[p])<f&&(f=a),(o=t[p+1])<y&&(y=o),r<a&&(r=a),i<o&&(i=o);u=0!==(u=Math.max(r-f,i-y))?1/u:0}return an(h,c,n,f,y,u),c}function nn(t,e,n,r,i){var a,o;if(i===0<mn(t,e,n,r))for(a=e;a<n;a+=r)o=pn(a,t[a],t[a+1],o);else for(a=n-r;e<=a;a-=r)o=pn(a,t[a],t[a+1],o);return o&&hn(o,o.next)&&(dn(o),o=o.next),o}function rn(t,e){if(!t)return t;e=e||t;var n,r=t;do{if(n=!1,r.steiner||!hn(r,r.next)&&0!==ln(r.prev,r,r.next))r=r.next;else{if(dn(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function an(t,e,n,r,i,a,o){if(t){!o&&a&&function(t,e,n,r){var i=t;for(;null===i.z&&(i.z=un(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==t;);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,a,o,u,s,l=1;do{for(n=t,a=t=null,o=0;n;){for(o++,r=n,e=u=0;e<l&&(u++,r=r.nextZ);e++);for(s=l;0<u||0<s&&r;)0!==u&&(0===s||!r||n.z<=r.z)?(n=(i=n).nextZ,u--):(r=(i=r).nextZ,s--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;n=r}}while(a.nextZ=null,l*=2,1<o)}(i)}(t,r,i,a);for(var u,s,l=t;t.prev!==t.next;)if(u=t.prev,s=t.next,a?function(t,e,n,r){var i=t.prev,a=t,o=t.next;if(0<=ln(i,a,o))return!1;var u=(i.x<a.x?i.x<o.x?i:o:a.x<o.x?a:o).x,s=(i.y<a.y?i.y<o.y?i:o:a.y<o.y?a:o).y,l=(i.x>a.x?i.x>o.x?i:o:a.x>o.x?a:o).x,h=(i.y>a.y?i.y>o.y?i:o:a.y>o.y?a:o).y,c=un(u,s,e,n,r),f=un(l,h,e,n,r),y=t.prevZ,p=t.nextZ;for(;y&&y.z>=c&&p&&p.z<=f;){if(y!==t.prev&&y!==t.next&&sn(i.x,i.y,a.x,a.y,o.x,o.y,y.x,y.y)&&0<=ln(y.prev,y,y.next))return!1;if(y=y.prevZ,p!==t.prev&&p!==t.next&&sn(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&0<=ln(p.prev,p,p.next))return!1;p=p.nextZ}for(;y&&y.z>=c;){if(y!==t.prev&&y!==t.next&&sn(i.x,i.y,a.x,a.y,o.x,o.y,y.x,y.y)&&0<=ln(y.prev,y,y.next))return!1;y=y.prevZ}for(;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&sn(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&0<=ln(p.prev,p,p.next))return!1;p=p.nextZ}return!0}(t,r,i,a):function(t){var e=t.prev,n=t,r=t.next;if(0<=ln(e,n,r))return!1;var i=t.next.next;for(;i!==t.prev;){if(sn(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&0<=ln(i.prev,i,i.next))return!1;i=i.next}return!0}(t))e.push(u.i/n),e.push(t.i/n),e.push(s.i/n),dn(t),t=s.next,l=s.next;else if((t=s)===l){o?1===o?an(t=function(t,e,n){var r=t;do{var i=r.prev,a=r.next.next}while(!hn(i,a)&&cn(i,r,r.next,a)&&fn(i,a)&&fn(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),dn(r),dn(r.next),r=t=a),r=r.next,r!==t);return r}(t,e,n),e,n,r,i,a,2):2===o&&function(t,e,n,r,i,a){var o=t;do{for(var u=o.next.next;u!==o.prev;){if(o.i!==u.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&cn(n,n.next,t,e))return!0}while(n=n.next,n!==t);return!1}(t,e)&&fn(t,e)&&fn(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;for(;n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==t;);return r}(t,e)}(o,u)){var s=yn(o,u);return o=rn(o,o.next),s=rn(s,s.next),an(o,e,n,r,i,a),an(s,e,n,r,i,a)}u=u.next}}while(o=o.next,o!==t)}(t,e,n,r,i,a):an(rn(t),e,n,r,i,a,1);break}}}function on(t,e){return t.x-e.x}function un(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function sn(t,e,n,r,i,a,o,u){return 0<=(i-o)*(e-u)-(t-o)*(a-u)&&0<=(t-o)*(r-u)-(n-o)*(e-u)&&0<=(n-o)*(a-u)-(i-o)*(r-u)}function ln(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function hn(t,e){return t.x===e.x&&t.y===e.y}function cn(t,e,n,r){return hn(t,e)&&hn(n,r)||hn(t,r)&&hn(n,e)||0<ln(t,e,n)!=0<ln(t,e,r)&&0<ln(n,r,t)!=0<ln(n,r,e)}function fn(t,e){return ln(t.prev,t,t.next)<0?0<=ln(t,e,t.next)&&0<=ln(t,t.prev,e):ln(t,e,t.prev)<0||ln(t,t.next,e)<0}function yn(t,e){var n=new gn(t.i,t.x,t.y),r=new gn(e.i,e.x,e.y),i=t.next,a=e.prev;return(t.next=e).prev=t,(n.next=i).prev=n,(r.next=n).prev=r,(a.next=r).prev=a,r}function pn(t,e,n,r){n=new gn(t,e,n);return r?(n.next=r.next,(n.prev=r).next.prev=n,r.next=n):(n.prev=n).next=n,n}function dn(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function gn(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function mn(t,e,n,r){for(var i=0,a=e,o=n-r;a<n;a+=r)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}function xn(t,e){this.x=T(t,0),this.y=T(e,0)}Ge.prototype.get_position_sphr=function(){return new B(this.longitude,this.latitude,this.altitude)},Ge.prototype.get_position_sphr_degree=function(){return new B(U.toDegrees(this.longitude),U.toDegrees(this.latitude),this.altitude)},Ge.prototype.get_position_geo=function(){return B.toCartesian(this.get_position_sphr())},Ge.prototype.set_position_sphr=function(t){this.longitude=t.longitude,this.latitude=t.latitude,this.altitude=t.height,Ke(this)},Ge.prototype.set_position_sphr_degree=function(t){this.longitude=t.longitude*U.RADIANS_PER_DEGREE,this.latitude=t.latitude*U.RADIANS_PER_DEGREE,this.altitude=t.height,Ke(this)},Ge.prototype.set_position_geo=function(t){t=B.fromCartesian(t);this.longitude=t.longitude,this.latitude=t.latitude,this.altitude=t.height,Ke(this)},Ge.prototype.set_altitude=function(t){this.altitude=t,Ke(this)},Ge.prototype.get_rotation=function(){return new N(this.tilt,this.heading,this.roll)},Ge.prototype.set_rotation=function(t){this.heading=t.y,this.tilt=t.x,this.roll=t.z,Ke(this)},Ge.prototype.set_heading=function(t){this.heading=t,Ke(this)},Ge.prototype.set_tilt=function(t){this.tilt=t,Ke(this)},Ge.prototype.add_quaternion=function(t){Fe.heading=this.heading,Fe.pitch=this.tilt,Fe.roll=this.roll,Fe.heading=Fe.heading-U.PI_OVER_TWO;var e=fe.fromHeadingPitchRoll(Fe,He),n=fe.multiply(e,t,new fe),r=G.fromQuaternion(n,Je),e=new N,t=new N,n=new N;G.getColumn(r,0,e),G.getColumn(r,2,t),N.cross(e,t,n),N.normalize(e,e),N.normalize(t,t),N.normalize(n,n),je(e),je(t),je(n),this.heading=Qe(e,t),this.tilt=$e(e),this.roll=tn(e,t,n),Ke(this)},Ge.prototype.get_scale=function(){return this.scale},Ge.prototype.set_scale=function(t){N.clone(t,this.scale),Ke(this)},Ge.prototype.create_from_geo=function(t,e,n){var r=B.fromCartesian(t);this.longitude=r.longitude,this.latitude=r.latitude,this.altitude=r.height;t=Ye.transform_from_geocentric_d(t),e=at.multiplyByPointAsVector(t,e,new N);N.normalize(e,e);t=at.multiplyByPointAsVector(t,n,new N);N.normalize(t,t);n=N.cross(e,t,new N);N.normalize(n,n),this.heading=Qe(e,t),this.tilt=$e(e),this.roll=tn(e,t,n),Ke(this)},Ge.prototype.copy_from=function(t){this.longitude=t.longitude,this.latitude=t.latitude,this.altitude=t.altitude,this.heading=t.heading,this.tilt=t.tilt,this.roll=t.roll,N.clone(t.scale,this.scale),at.clone(t.mat_tnb,this.mat_tnb)},en.deviation=function(t,e,n,r){var i=e&&e.length,a=i?e[0]*n:t.length,o=Math.abs(mn(t,0,a,n));if(i)for(var u=0,s=e.length;u<s;u++){var l=e[u]*n,h=u<s-1?e[u+1]*n:t.length;o-=Math.abs(mn(t,l,h,n))}for(var c=0,u=0;u<r.length;u+=3){var f=r[u]*n,y=r[u+1]*n,p=r[u+2]*n;c+=Math.abs((t[f]-t[p])*(t[1+y]-t[1+f])-(t[f]-t[y])*(t[1+p]-t[1+f]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},en.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var o=0;o<e;o++)n.vertices.push(t[i][a][o]);0<i&&(r+=t[i-1].length,n.holes.push(r))}return n},xn.fromElements=function(t,e,n){return I(n)?(n.x=t,n.y=e,n):new xn(t,e)},xn.fromCartesian3=xn.clone=function(t,e){if(I(t))return I(e)?(e.x=t.x,e.y=t.y,e):new xn(t.x,t.y)},xn.fromCartesian4=xn.clone,xn.packedLength=2,xn.pack=function(t,e,n){return n=T(n,0),e[n++]=t.x,e[n]=t.y,e},xn.unpack=function(t,e,n){return e=T(e,0),(n=!I(n)?new xn:n).x=t[e++],n.y=t[e],n},xn.packArray=function(t,e){var n=t.length,r=2*n;if(I(e)){if(!Array.isArray(e)&&e.length!==r)throw new a("If result is a typed array, it must have exactly array.length * 2 elements");e.length!==r&&(e.length=r)}else e=new Array(r);for(var i=0;i<n;++i)xn.pack(t[i],e,2*i);return e},xn.unpackArray=function(t,e){var n=t.length;I(e)?e.length=n/2:e=new Array(n/2);for(var r=0;r<n;r+=2){var i=r/2;e[i]=xn.unpack(t,r,e[i])}return e},xn.fromArray=xn.unpack,xn.maximumComponent=function(t){return Math.max(t.x,t.y)},xn.minimumComponent=function(t){return Math.min(t.x,t.y)},xn.minimumByComponent=function(t,e,n){return n.x=Math.min(t.x,e.x),n.y=Math.min(t.y,e.y),n},xn.maximumByComponent=function(t,e,n){return n.x=Math.max(t.x,e.x),n.y=Math.max(t.y,e.y),n},xn.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},xn.magnitude=function(t){return Math.sqrt(xn.magnitudeSquared(t))};var _n=new xn;xn.distance=function(t,e){return xn.subtract(t,e,_n),xn.magnitude(_n)},xn.distanceSquared=function(t,e){return xn.subtract(t,e,_n),xn.magnitudeSquared(_n)},xn.normalize=function(t,e){var n=xn.magnitude(t);return 0!=n?(e.x=t.x/n,e.y=t.y/n):xn.clone(t,e),Math.abs(e.x)<U.EPSILON8&&(e.x=0),Math.abs(e.y)<U.EPSILON8&&(e.y=0),e},xn.dot=function(t,e){return t.x*e.x+t.y*e.y},xn.multiplyComponents=function(t,e,n){return n.x=t.x*e.x,n.y=t.y*e.y,n},xn.divideComponents=function(t,e,n){return n.x=t.x/e.x,n.y=t.y/e.y,n},xn.add=function(t,e,n){return n.x=t.x+e.x,n.y=t.y+e.y,n},xn.subtract=function(t,e,n){return n.x=t.x-e.x,n.y=t.y-e.y,n},xn.multiplyByScalar=function(t,e,n){return n.x=t.x*e,n.y=t.y*e,n},xn.divideByScalar=function(t,e,n){return n.x=t.x/e,n.y=t.y/e,n},xn.negate=function(t,e){return e.x=-t.x,e.y=-t.y,e},xn.abs=function(t,e){return e.x=Math.abs(t.x),e.y=Math.abs(t.y),e};var wn=new xn;xn.lerp=function(t,e,n,r){return xn.multiplyByScalar(e,n,wn),r=xn.multiplyByScalar(t,1-n,r),xn.add(wn,r,r)};var vn=new xn,zn=new xn;xn.angleBetween=function(t,e){return xn.normalize(t,vn),xn.normalize(e,zn),U.acosClamped(xn.dot(vn,zn))};var Mn=new xn;function bn(){}function In(t,e){this.normal=N.clone(t),this.distance=e}xn.mostOrthogonalAxis=function(t,e){t=xn.normalize(t,Mn);return xn.abs(t,t),e=t.x<=t.y?xn.clone(xn.UNIT_X,e):xn.clone(xn.UNIT_Y,e)},xn.equals=function(t,e){return t===e||I(t)&&I(e)&&t.x===e.x&&t.y===e.y},xn.equalsArray=function(t,e,n){return t.x===e[n]&&t.y===e[n+1]},xn.equalsEpsilon=function(t,e,n,r){return t===e||I(t)&&I(e)&&U.equalsEpsilon(t.x,e.x,n,r)&&U.equalsEpsilon(t.y,e.y,n,r)},xn.ZERO=Object.freeze(new xn(0,0)),xn.UNIT_X=Object.freeze(new xn(1,0)),xn.UNIT_Y=Object.freeze(new xn(0,1)),xn.prototype.clone=function(t){return xn.clone(this,t)},xn.prototype.equals=function(t){return xn.equals(this,t)},xn.prototype.equalsEpsilon=function(t,e,n){return xn.equalsEpsilon(this,t,e,n)},xn.prototype.toString=function(){return"("+this.x+", "+this.y+")"},xn.prototype.set=function(t,e){this.x=t,this.y=e},xn.prototype.fromArray=function(t,e){return this.x=t[e=void 0===e?0:e],this.y=t[e+1],this},xn.prototype.toArray=function(t,e){return(t=void 0===t?[]:t)[e=void 0===e?0:e]=this.x,t[e+1]=this.y,t},bn.Contain=function(t,e,n,r){var i=JudgeSide(t,e,n),a=JudgeSide(t,e,r),t=JudgeSide(t,n,r);return(0==i||i==JudgeSide(r,e,n))&&((0==a||a==JudgeSide(n,e,r))&&(0==t||t==JudgeSide(e,n,r)))},bn.JudgeSide=function(t,e,n){e=(t.y-e.y)*(t.x-n.x)-(t.y-n.y)*(t.x-e.x);return Math.abs(e)<1e-7?0:0<e?1:-1},bn.IsCCW=function(t){for(var e=0,n=-999999,r=[],i=0;i<t.length-1;i++){var a={x:t[i].x,y:t[i].y};0<r.length&&r[r.length-1].x==a.x&&r[r.length-1].y==a.y||r.push(a)}a={x:t[t.length-1].x,y:t[t.length-1].y};0<r.length&&(r[r.length-1].x==a.x&&r[r.length-1].y==a.y||r[0].x==a.x&&r[0].y==a.y||r.push(a));for(var o=r.length,i=0;i<o;i++)(r[i].y>n||r[i].y==n&&r[i].x>r[e].x)&&(n=r[e=i].y);var u=new xn(r[e].x,r[e].y),s=0==e?o-1:e-1,l=new xn(r[s].x,r[s].y),s=new xn(r[s=e==o-1?0:e+1].x,r[s].y);return xn.subtract(l,u,l),xn.normalize(l,l),xn.subtract(l,u,l),xn.subtract(s,u,s),xn.normalize(s,s),xn.add(s,u,s),l.x<s.x},bn.is_polygon_ccw=function(t){for(var e=N.equals(t[0],t[t.length-1]),n=-1,r=-Number.MAX_VALUE,i=t.length,a=0;a<i;++a)(t[a].z>r||t[a].z==r&&t[a].x>t[n].x)&&(r=t[n=a].z);var o=new N,u=new N;return N.subtract(e?0===n?t[t.length-2]:t[n-1]:0===n?t[t.length-1]:t[n-1],t[n],o),o.y=0,N.normalize(o,o),N.subtract(e?n===i-1?t[1]:t[n+1]:n===i-1?t[0]:t[n+1],t[n],u),u.y=0,N.normalize(u,u),o.x>u.x},bn.is_polygon_ccw_2d=function(t){for(var e=xn.equals(t[0],t[t.length-1]),n=-1,r=-Number.MAX_VALUE,i=t.length,a=0;a<i;++a)(t[a].y>r||t[a].y==r&&t[a].x>t[n].x)&&(r=t[n=a].y);var o=new xn,u=new xn;return xn.subtract(e?0===n?t[t.length-2]:t[n-1]:0===n?t[t.length-1]:t[n-1],t[n],o),xn.normalize(o,o),xn.subtract(e?n===i-1?t[1]:t[n+1]:n===i-1?t[0]:t[n+1],t[n],u),xn.normalize(u,u),o.x>u.x},bn.area=function(t){var e=N.distance(t[0],t[1]),n=N.distance(t[0],t[2]),t=.5*((r=N.distance(t[1],t[2]))+n+e),n=t-n,r=t-r;return n=(e=(e=t-e)<0?0:e)<0?0:n,r=e<0?0:r,Math.sqrt(t*e*n*r)},In.fromPointNormal=function(t,e,n){t=-N.dot(e,t);return I(n)?(N.clone(e,n.normal),n.distance=t,n):new In(e,t)};var On=new N;In.fromCartesian4=function(t,e){var n=N.fromCartesian4(t,On),t=t.w;return I(e)?(N.clone(n,e.normal),e.distance=t,e):new In(n,t)},In.fromPoints=function(t,e,n,r){var i=N.subtract(e,t,new N),e=N.subtract(n,e,new N);N.normalize(i,i),N.normalize(e,e);e=N.cross(i,e,new N);N.normalize(e,e);t=-N.dot(e,t);return I(r)?(N.clone(e,r.normal),r.distance=t,r):new In(e,t)},In.getPointDistance=function(t,e){return N.dot(t.normal,e)+t.distance};var En=new N;In.projectPointOntoPlane=function(t,e,n){I(n)||(n=new N);var r=In.getPointDistance(t,e),r=N.multiplyByScalar(t.normal,r,En);return N.subtract(e,r,n)},In.projection=function(t,e,n){var r=N.dot(e,t.normal),r=N.multiplyByScalar(t.normal,r,En);return I(n)||(n=new N),N.subtract(e,r,n)};var Sn=new N;function Pn(){}function Rn(t){var e=t.z;t.z=t.y,t.y=e}In.transform=function(t,e,n){return at.multiplyByPointAsVector(e,t.normal,On),N.normalize(On,On),N.multiplyByScalar(t.normal,-t.distance,Sn),at.multiplyByPoint(e,Sn,Sn),In.fromPointNormal(Sn,On,n)},In.clone=function(t,e){return I(e)?(N.clone(t.normal,e.normal),e.distance=t.distance,e):new In(t.normal,t.distance)},In.equals=function(t,e){return t.distance===e.distance&&N.equals(t.normal,e.normal)},In.prototype.intersect=function(t,e){I(e)||(e=new N);var n,r=t.origin,i=t.direction,t=N.dot(i,this.normal);return Math.abs(t)<U.EPSILON15?(n=r.x*this.normal.x*r.y*this.normal.y+r.z*this.normal.z+this.distance)<U.EPSILON15?(N.clone(r,e),e):void 0:(n=-(this.normal.x*r.x+this.normal.y*r.y+this.normal.z*r.z+this.distance),e=N.multiplyByScalar(i,n/=t,e),e=N.add(r,e,e))},In.ORIGIN_XY_PLANE=Object.freeze(new In(N.UNIT_Z,0)),In.ORIGIN_YZ_PLANE=Object.freeze(new In(N.UNIT_X,0)),In.ORIGIN_ZX_PLANE=Object.freeze(new In(N.UNIT_Y,0));var An=new Xe,Tn=new fe,Nn=new G;function Bn(t){this.min_t=t.min_t,this.max_t=t.max_t}function qn(t){Bn.call(this,{min_t:t.afTime[0],max_t:t.afTime[t.iSegments]}),this.iSegments=t.iSegments,this.afTime=t.afTime,this.afLength=void 0,this.afAccumLength=void 0}function Cn(t){qn.call(this,t),this.akPoint=t.akPoint,this.afTension=t.afTension,this.afContinuity=t.afContinuity,this.afBias=t.afBias,this.akA=new Array(this.iSegments),this.akB=new Array(this.iSegments),this.akC=new Array(this.iSegments),this.akD=new Array(this.iSegments),this.compute_poly(0,0,1,2);for(var e=1;e<this.iSegments-1;e++)this.compute_poly(e-1,e,e+1,e+2);this.compute_poly(this.iSegments-2,this.iSegments-1,this.iSegments,this.iSegments)}Pn.create_from_target_geo=function(t,e,n,r,i){var a=Ze.transform_from_cartesian_d(t.x,t.z,t.y);at.multiply(at.TRANSYZ,a,a),An.heading=e,An.pitch=n,An.roll=r,An.heading=An.heading-U.PI_OVER_TWO;var o=fe.fromHeadingPitchRoll(An,Tn),e=G.fromQuaternion(o,Nn),n=new N,r=new N,o=new N;G.getColumn(e,0,n),G.getColumn(e,2,r),N.cross(n,r,o),N.normalize(n,n),N.normalize(r,r),N.normalize(o,o),Rn(n),Rn(r),Rn(o);r=at.from_tnbp(o,r,n,N.ZERO),n=at.clone(at.IDENTITY);at.multiply(r,n,n),at.multiply(a,n,n);i=N.multiplyByScalar(N.UNIT_Z,-i,new N),i=at.multiplyByPoint(n,i,i),n=N.subtract(t,i,new N);N.normalize(n,n);t=N.normalize(i,new N),t=N.cross(n,t,new N),t=N.cross(t,n,new N);return N.normalize(t,t),{in_pos_geo:i,in_dir_geo:n,in_up_geo:t}},Pn.create_from_cart=function(t,e,n){var r=Ze.transform_from_cartesian_d(t.x,t.z,t.y);at.multiply(at.TRANSYZ,r,r);e=at.multiplyByPointAsVector(r,e,new N);N.normalize(e,e);n=at.multiplyByPointAsVector(r,n,new N);return N.normalize(n,n),{in_pos_geo:t,in_dir_geo:e,in_up_geo:n}},Pn.create_from_geo=function(t,e,n){t=Ye.transform_from_geocentric_d(t),e=at.multiplyByPointAsVector(t,e,new N);N.normalize(e,e);n=at.multiplyByPointAsVector(t,n,new N);return N.normalize(n,n),{in_dir_cart:e,in_up_cart:n}},Pn.create_from_sphr=function(t,e,n,r,i,a,o){t=new B(t,e,n),t=B.toCartesian(t),e=Ze.transform_from_cartesian_d(t.x,t.z,t.y);at.multiply(at.TRANSYZ,e,e),An.heading=r,An.pitch=i,An.roll=a,An.heading=An.heading-U.PI_OVER_TWO;n=fe.fromHeadingPitchRoll(An,Tn),r=G.fromQuaternion(n,Nn),i=new N,a=new N,n=new N;G.getColumn(r,0,i),G.getColumn(r,2,a),N.cross(i,a,n),N.normalize(i,i),N.normalize(a,a),N.normalize(n,n),Rn(i),Rn(a),Rn(n);a=at.from_tnbp(n,a,i,N.ZERO),i=at.clone(at.IDENTITY);at.multiply(a,i,i),at.multiply(e,i,i);o=N.multiplyByScalar(N.UNIT_Z,o,new N),o=at.multiplyByPoint(i,o,o),i=N.subtract(o,t,new N);N.normalize(i,i);o=N.normalize(t,new N),o=N.cross(i,o,new N),o=N.cross(o,i,new N);return N.normalize(o,o),{in_pos_geo:t,in_dir_geo:i,in_up_geo:o}},Pn.calc_heading=function(t,e,n){var t=Ye.transform_from_geocentric_d(t),e=at.multiplyByPointAsVector(t,e,new N);N.normalize(e,e);n=at.multiplyByPointAsVector(t,n,new N);return N.normalize(n,n),e=e,n=n,e=U.equalsEpsilon(Math.abs(e.y),1,U.EPSILON3)?Math.atan2(n.z,n.x)-U.PI_OVER_TWO:Math.atan2(e.z,e.x)-U.PI_OVER_TWO,U.TWO_PI-U.zeroToTwoPi(e)},I(Object.create)&&((qn.prototype=Object.create(Bn.prototype)).constructor=qn),qn.prototype.Suicide=function(){void(this.afTime.length=0)!==this.afLength&&(this.afLength.length=0),void 0!==this.afAccumLength&&(this.afAccumLength.length=0)},I(Object.create)&&((Cn.prototype=Object.create(qn.prototype)).constructor=Cn),Cn.prototype.compute_poly=function(t,e,n,r){var i=N.subtract(this.akPoint[n],this.akPoint[e],new N),a=this.afTime[n]-this.afTime[e],o=1-this.afTension[e],u=1-this.afContinuity[e],s=1+this.afContinuity[e],l=1-this.afBias[e],h=1+this.afBias[e],c=2*a/(this.afTime[n]-this.afTime[t]),f=.5*c*o*s*h,s=N.multiplyByScalar(i,.5*c*o*u*l,new N),h=N.subtract(this.akPoint[e],this.akPoint[t],new N),h=N.multiplyByScalar(h,f,h),c=N.add(s,h,new N),o=1-this.afTension[n],u=1-this.afContinuity[n],l=1+this.afContinuity[n],t=1-this.afBias[n],f=1+this.afBias[n],a=2*a/(this.afTime[r]-this.afTime[e]),t=.5*a*o*l*t,s=N.multiplyByScalar(i,.5*a*o*u*f,s);h=N.subtract(this.akPoint[r],this.akPoint[n],h),h=N.multiplyByScalar(h,t,h);t=N.add(h,s,new N);this.akA[e]=this.akPoint[e],this.akB[e]=c,s=N.multiplyByScalar(i,3,s),h=N.multiplyByScalar(c,2,h),this.akC[e]=N.subtract(s,h,new N),this.akC[e]=N.subtract(this.akC[e],t,this.akC[e]),s=N.multiplyByScalar(i,-2,s),this.akD[e]=N.add(s,c,new N),this.akD[e]=N.add(this.akD[e],t,this.akD[e])},Cn.prototype.get_position=function(t){var e=this.get_key_info(t);e.fDt/=this.afTime[e.iKey+1]-this.afTime[e.iKey];t=N.multiplyByScalar(this.akD[e.iKey],e.fDt,new N),t=N.add(this.akC[e.iKey],t,t);return t=N.multiplyByScalar(t,e.fDt,t),t=N.add(this.akB[e.iKey],t,t),t=N.multiplyByScalar(t,e.fDt,t),t=N.add(this.akA[e.iKey],t,t)},Cn.prototype.get_first_derivative=function(t){var e=this.get_key_info(t);e.fDt/=this.afTime[e.iKey+1]-this.afTime[e.iKey];var n=N.multiplyByScalar(this.akD[e.iKey],3*e.fDt,new N),t=N.multiplyByScalar(this.akC[e.iKey],2,new N),t=N.add(n,t,new N),t=N.multiplyByScalar(t,e.fDt,t);return t=N.add(this.akB[e.iKey],t,t)},Cn.prototype.get_key_info=function(t){var e=void 0,n=void 0;if(t<=this.afTime[0])n=e=0;else if(t>=this.afTime[this.iSegments])e=this.iSegments-1,n=this.afTime[this.iSegments]-this.afTime[this.iSegments-1];else for(var r=0;r<this.iSegments;r++)if(t<this.afTime[r+1]){e=r,n=t-this.afTime[r];break}return{iKey:e,fDt:n}},Cn.prototype.Suicide=function(){qn.prototype.Suicide.call(this),this.akPoint.length=0,this.afTension.length=0,this.afContinuity.length=0,this.afBias.length=0,this.akA.length=0,this.akB.length=0,this.akC.length=0,this.akD.length=0};var kn=0,Ln=1;function Un(){}var Dn=new N,Wn=new N,Vn=new N;function Xn(){}new at,Un.get_third_point=function(t,e,n,r,i,a){var o=N.normalize(e,Dn),n=N.subtract(n,e,Wn);N.normalize(n,n);i=at.rotate_axis_lh(N.ZERO,n,i/M.WGS84.maximumRadius),e=at.multiplyByPoint(i,e,Vn);a==kn?r=U.PI/2-r:a==Ln&&(r=U.PI/2+r),i=at.rotate_axis_lh(N.ZERO,o,r),at.multiplyByPoint(i,e,t)},Un.get_hean_GBJ=function(t,e,n,r,i,a,o,u,s){i=T(i,.1),a=T(a,.15),o=T(o,.4),u=T(u,.75),s=T(s,.15);var l=e*a,h=N.distance(n,r),a=(l=h<l?h:l)*u,u=0,h=l*s,u=l*o,o=new N;Un.get_third_point(o,r,n,0,a,kn);a=new N;Un.get_third_point(a,r,n,0,l,kn);for(var c=0;c<8;++c)t.push(new N);return Un.get_third_point(t[0],n,r,Math.PI/2,e*i,kn),Un.get_third_point(t[6],n,r,Math.PI/2,e*i,Ln),Un.get_third_point(t[1],o,r,Math.PI/2,h,kn),Un.get_third_point(t[5],o,r,Math.PI/2,h,Ln),Un.get_third_point(t[2],a,r,Math.PI/2,u,kn),Un.get_third_point(t[4],a,r,Math.PI/2,u,Ln),N.clone(r,t[3]),N.clone(t[0],t[7]),8},Un.get_hean_GBJ_user_defined=function(t,e,n,r){var i=N.add(e,n,new N);N.multiplyByScalar(i,.5,i);var a=N.distance(i,r),i=Un.get_hean_GBJ(t,a,i,r);return!bn.is_polygon_ccw([e,n,r])?(N.clone(n,t[0]),N.clone(e,t[6])):(N.clone(e,t[0]),N.clone(n,t[6])),N.clone(t[0],t[7]),i},Un.use_bezier=function(t,e,n,r){for(var i=parseInt(20),a=0;a<=1;){var o=new N;o.x=Math.pow(1-a,2)*e.x+2*a*(1-a)*n.x+Math.pow(a,2)*r.x,o.z=Math.pow(1-a,2)*e.z+2*a*(1-a)*n.z+Math.pow(a,2)*r.z,o.y=Math.pow(1-a,2)*e.y+2*a*(1-a)*n.y+Math.pow(a,2)*r.y,t.push(o),a+=.05}return i},Un.use_four_bezier=function(t,e,n,r,i){for(var a=parseInt(20),o=0,u=1-o;o<=1;){var s=new N;s.x=Math.pow(u,3)*e.x+3*o*Math.pow(u,2)*n.x+3*Math.pow(o,2)*u*r.x+Math.pow(o,3)*i.x,s.z=Math.pow(u,3)*e.z+3*o*Math.pow(u,2)*n.z+3*Math.pow(o,2)*u*r.z+Math.pow(o,3)*i.z,s.y=Math.pow(u,3)*e.y+3*o*Math.pow(u,2)*n.y+3*Math.pow(o,2)*u*r.y+Math.pow(o,3)*i.y,t.push(s),u=1-(o+=.05)}return a},Un.use_five_bezier=function(t,e,n,r,i,a){for(var o=parseInt(20),u=0,s=1-u;u<=1;){var l=new N;l.x=Math.pow(s,4)*e.x+4*u*Math.pow(s,3)*n.x+6*Math.pow(u,2)*Math.pow(s,2)*r.x+4*Math.pow(u,3)*s*i.x+Math.pow(u,4)*a.x,l.z=Math.pow(s,4)*e.z+4*u*Math.pow(s,3)*n.z+6*Math.pow(u,2)*Math.pow(s,2)*r.z+4*Math.pow(u,3)*s*i.z+Math.pow(u,4)*a.z,l.y=Math.pow(s,4)*e.y+4*u*Math.pow(s,3)*n.y+6*Math.pow(u,2)*Math.pow(s,2)*r.y+4*Math.pow(u,3)*s*i.y+Math.pow(u,4)*a.y,t.push(l),s=1-(u+=.05)}return o},Un.get_bezier_points=function(t,e,n){if(n<=2){for(var r=0;r<e.length;++r)t.push(new N),N.clone(e[r],t[r]);return n}for(var i=0;i<=1;){for(var a=new N,r=0;r<n;r++){var o=Un.get_binormial_factor(n-1,r)*Math.pow(i,r)*Math.pow(1-i,n-1-r),o=N.multiplyByScalar(e[r],o,Dn);N.add(o,a,a)}t.push(a),i+=.01}a=new N;return N.clone(e[n-1],a),t.push(a),t.length},Un.use_advanced_bezier=function(t,e,n){for(var r=new Array(n),i=0;i<n-2;i++){var a=new N;N.add(e[i],e[i+1],a),N.multiplyByScalar(a,.5,a),r[i]=a}r[n-2]=new N,N.clone(r[0],r[n-2]);for(var o=new Array(n),i=0;i<n-2;i++){var u=N.subtract(e[i],e[i+1],Dn),s=N.magnitude(u),u=N.subtract(e[i+1],e[i+2],Dn),l=N.magnitude(u);u=N.subtract(r[i],r[i+1],Dn);l=s*N.magnitude(u)/(s+l);o[i]=new N,Un.get_third_point(o[i],r[i],r[i+1],0,l,kn)}for(var h=new Array(3*(n-2)+2),i=0;i<n-2;i++){a=new N;N.add(r[i],e[i+1],a),N.subtract(a,o[i],a),h[3*i]=a,h[3*i+1]=new N,N.clone(e[i+1],h[3*i+1]),a=new N,N.add(r[i+1],e[i+1],a),N.subtract(a,o[i],a),h[3*i+2]=a}h[3*(n-2)]=new N,N.clone(h[0],h[3*(n-2)]),h[3*(n-2)+1]=new N,N.clone(h[1],h[3*(n-2)+1]);for(i=1;i<h.length-1;i+=3){for(var c=[],f=new Array(4),y=0;y<4;++y)f[y]=h[i+y];for(var p=Un.get_bezier_points(c,f,4),y=0;y<p;y++)t.push(c[y])}return t.length},Un.use_bspline=function(t,e,n,r){if(n<=(r=T(r,2))){for(var i=0;i<e.length;++i)t.push(new N),N.clone(e[i],t[i]);return n}for(i=0;i<=n-r-1;i++)for(var a=0;a<=1;a+=.05){for(var o=new N,u=0;u<=r;u++){var s=Un.get_bspline_factor(u,r,a);o.x+=s*e[i+u].x,o.z+=s*e[i+u].z,o.y+=s*e[i+u].y}t.push(o)}return t.length},Un.get_bspline_factor=function(t,e,n){if(2==e)return Un.get_quadric_bspline_factor(t,n);for(var r=0,i=Un.get_factorial(e),a=0;a<e-t;a++)r+=(a%2==0?1:-1)*Un.get_binormial_factor(e+1,a)*Math.pow(n+e-t-a,e);return r/i},Un.get_quadric_bspline_factor=function(t,e){var n=0;switch(t){case 0:n=Math.pow(e-1,2)/2;break;case 1:n=(-2*Math.pow(e,2)+2*e+1)/2;break;case 2:n=Math.pow(e,2)/2}return n},Un.get_factorial=function(t){if(t<=1)return 1;if(2==t)return 2;if(3==t)return 6;if(4==t)return 24;if(5==t)return 120;for(var e=1,n=0;n<t;n++)e*=n;return e},Un.get_binormial_factor=function(t,e){return Un.get_factorial(t)/Un.get_factorial(e)/Un.get_factorial(t-e)},Un.draw_left_right_curve=function(t,e,n,r,i,a){r=T(r,!1),i=T(i,!1),a=T(a,!1);var o=[],u=[],s=[],l=new N,h=new N,c=0,f=0,y=.1,p=.15,d=.4,g=.75,m=.15;r&&(p=.1,d=1.2,g=1,m=.7),a?(c=2,r=N.add(e[0],e[1],Dn),N.multiplyByScalar(r,.5,r),f+=N.distance(r,e[2])):f+=N.distance(e[0],e[c=1]);for(var x=c;x<n-1;x++)f+=N.distance(e[x],e[x+1]);a?(s.push(e[0]),s.push(e[1]),s.push(e[2]),(O=!bn.is_polygon_ccw(s))?(o.push(e[1]),u.push(e[0])):(o.push(e[0]),u.push(e[1])),y=N.distance(e[0],e[1])/2/f):(Un.get_third_point(l,e[0],e[1],.5*Math.PI,f*y,kn),o.push(l),Un.get_third_point(h,e[0],e[1],.5*Math.PI,f*y,Ln),u.push(h));var _=[];Un.get_hean_GBJ(_,f,e[n-2],e[n-1],y,p,d,g,m);for(var w=0,v=0,z=0,M=0,x=c;x<n-1;x++){var b,I=N.subtract(e[x+1],e[x],Dn),s=[];c==x&&2==c?(A=N.add(e[0],e[1],Wn),N.multiplyByScalar(A,.5,A),b=N.subtract(A,e[x],Vn),s.push(N.clone(A))):(b=N.subtract(e[x-1],e[x],Vn),s.push(e[x-1])),s.push(e[x]),s.push(e[x+1]);var O=!bn.is_polygon_ccw(s);z+=N.distance(s[0],s[1]),N.normalize(I,I),N.normalize(b,b);I=Math.acos(N.dot(I,b)),M=f*y-z/f*(f*y-N.distance(_[1],_[5])/2);M/=Math.sin(I/2),O?w=U.PI-(v=I/2):v=U.PI-(w=I/2);I=new N;Un.get_third_point(I,e[x],e[x+1],w,M,kn),o.push(I),I=new N,Un.get_third_point(I,e[x],e[x+1],v,M,Ln),u.push(I)}o.push(_[1]),u.push(_[5]);var E=[],S=Un.use_bspline(E,o,o.length),P=[],m=Un.use_bspline(P,u,u.length),R=[];R.push(o[0]);for(x=0;x<S-1;x++)R.push(E[x]);R.push(o[o.length-1]),R.push(_[2]),R.push(e[n-1]),R.push(_[4]),R.push(u[u.length-1]);for(var A,x=m-1;0<=x;x--)R.push(P[x]);R.push(u[0]),i&&(i=new N,a?(A=new N,N.add(e[0],e[1],A),N.multiplyByScalar(A,.5,A),Un.get_third_point(i,A,e[2],0,f*y,kn)):Un.get_third_point(i,e[0],e[1],0,f*y,kn),R.push(i)),R.push(R[0]);for(x=0;x<R.length;++x)t.push(new N),N.clone(R[x],t[x]);return t.length},Un.make_middle_points=function(t,e,n,r,i,a){return r=T(r,!1),i=T(i,!1),a=T(a,!1),Un.draw_left_right_curve(t,e,n,r,i,a)},Un.draw_xmiddle_curve=function(t,e,n){var r=N.distance(e[n-3],e[n-2]);r+=N.distance(e[n-2],e[n-1])/2;var i=[];Un.get_hean_GBJ(i,r,e[n-3],e[n-1],.2,.3,.5,.7);for(var a=[],o=Un.use_bezier(a,i[0],e[n-2],i[1]),u=[],s=Un.use_bezier(u,i[5],e[n-2],i[6]),l=0;l<o;l++)t.push(a[l]);t.push(i[1]),t.push(i[2]),t.push(N.clone(e[n-1],new N)),t.push(i[4]),t.push(i[5]);for(l=0;l<s;l++)t.push(u[l]);return t.push(N.clone(t[0],new N)),t.length},Xn.SE_SHAPE_MIN_HEIGHT=1e-5;var Zn=new at,Yn=new N;Xn.create_circle=function(t,e,n,r){for(var i=N.fromRadians(e.longitude,e.latitude,e.height),e=N.normalize(i,Yn),e=N.cross(N.UNIT_Z,e,Yn),a=at.rotate_axis_lh(N.ZERO,e,n),o=at.multiplyByPoint(a,i,Yn),u=0;u<r;u++){a=at.rotate_axis_lh(N.ZERO,i,-U.TWO_PI/r*u);t.push(at.multiplyByPoint(a,o,new N))}},Xn.create_circle_not_clamp=function(t,e,n,r){for(var i=N.fromRadians(e.longitude,e.latitude,e.height),e=N.normalize(i,Yn),e=N.cross(N.UNIT_Z,e,Yn),a=at.rotate_axis_lh(N.ZERO,e,n),o=at.multiplyByPoint(a,i,Yn),n=1/Math.cos(n),o=N.multiplyByScalar(o,n,Yn),u=0;u<r;u++){a=at.rotate_axis_lh(N.ZERO,i,-U.TWO_PI/r*u);t.push(at.multiplyByPoint(a,o,new N))}return t},Xn.create_circle_on_plane=function(t,e,n,r){for(var i,a,o=e.y,u=0,s=U.TWO_PI/r,l=0;l<r;l++)i=e.x+Math.sin(u)*n,a=e.z+Math.cos(u)*n,t[l]=new N(i,o,a),u-=s},Xn.create_ellipse=function(t,e,n,r){for(var i=N.fromRadians(e.longitude,e.latitude,e.height),a=new N,e=N.normalize(i,a),o=e.cross(e,N.UNIT_Y,a),u=0;u<r;u++){var s=U.TWO_PI/r*u,l=n.x*Math.cos(s),h=n.y*Math.sin(s),c=Math.sqrt(l*l+h*h),s=at.rotate_axis_lh(N.ZERO,o,c),c=at.multiplyByPoint(s,i,Yn),l=Math.atan2(h,l),s=at.rotate_axis_lh(N.ZERO,i,l,Zn);t[u]=at.multiplyByPoint(s,c,t[u])}},Xn.create_sector=function(t,e,n,r,i,a){for(var o=N.fromRadians(e.longitude,e.latitude,e.height),e=N.fromRadians(n.longitude,n.latitude,n.height),e=N.normalize(e,e),n=N.normalize(o,Yn),e=N.cross(n,e,Yn),u=at.rotate_axis_lh(N.ZERO,e,r,Zn),s=at.multiplyByPoint(u,o,Yn),l=i/a,h=0;h<=a;h++){u=at.rotate_axis_lh(N.ZERO,o,l*h-.5*i,Zn);t.push(at.multiplyByPoint(u,s,new N))}t.push(o)},Xn.calculate_tilt=function(t,e){var n=Ye.transform_from_geocentric_d(t),t=N.subtract(e,t,Yn),t=N.normalize(t,Yn),t=at.multiplyByPointAsVector(n,t,Yn);N.normalize(t,t);t=N.negate(t,Yn),t=N.dot(N.UNIT_Y,t);return Math.acos(t)-U.PI_OVER_TWO};var Gn=new N;new N,Xn.calculate_heading=function(t,e){var n=0,r=N.subtract(e,t,new N),i=N.normalize(t,new N),e=new N;return N.normalize(N.cross(i,r,new N),e),n=Pn.calc_heading(t,e,i),n+=U.PI_OVER_TWO,n=U.zeroToTwoPi(n)},Xn.create_spline=function(t,e){var n=e.length;if(n<=2){for(var r=0;r<n;++r){var i=N.clone(e[r]);t.push(i)}return n}for(var a=20*n,o=new Array(n),u=new Array(n),s=new Array(n),r=0;r<n;++r)o[r]=0,u[r]=0,s[r]=0;for(var l=new Array(n),r=0;r<n;++r)l[r]=parseFloat(r)/(n-1);l[n-1]=1;for(var h=new Array(n),r=0;r<n;++r)h[r]=N.clone(e[r]);for(var c=new Cn({iSegments:n-1,afTime:l,akPoint:h,afTension:o,afContinuity:u,afBias:s}),f=1/a,r=0;r<a;r++){var y=c.get_position(f*r);t.push(y)}return t.push(N.clone(e[n-1])),t.length},Xn.create_spline_close=function(t,e,n){if(n<=2){t=new Array(n);for(var r=0;r<n;++r)t[r]=new N,N.clone(e[r],t[r]);return n}t=[];for(var i=20*(n+=3),a=(new Array(n),new Array(n),new Array(n),new Array(n)),r=0;r<n;r++)a[r]=r/n;var o=new Array(n);o[0]=new N,N.clone(e[n-4],o[0]);for(r=0;r<n-3;++r)o[r+1]=new N,N.clone(e[r],o[r+1]);for(r=0;r<2;++r)o[r+n-2]=new N,N.clone(e[r],o[r+n-2]);for(var u=new Cn(n-1),s=1/i,r=20;r<i-40;r++){var l=u.get_position(s*r);t.push(l)}var h=new N;return N.clone(e[0],h),t.push(h),t.length},Xn.create_line_with_triangle_arrow=function(t,e,n,r){var i=e[n-2],a=e[n-1],o=N.subtract(a,i,Yn),u=N.magnitude(o),o=new N;r?.06<u&&Un.get_third_point(o,a,i,0,u=.06,kn):Un.get_third_point(o,a,i,0,u/=8,kn);r=u*Math.tan(Math.PI/180*30),i=new N,u=new N;Un.get_third_point(i,o,a,U.PI_OVER_TWO,r,kn),Un.get_third_point(u,o,a,U.PI_OVER_TWO,r,Ln);for(var s=0;s<n-1;++s)t[s]=new N,N.clone(e[s],t[s]);for(var l=[o,i,a,u,o],s=n-1;s<n+4;++s)t[s]=new N,N.clone(l[s-n+1],t[s]);return n+4},Xn.create_line_with_umbrella_arrow=function(t,e,n,r){var i=e[n-2],a=e[n-1],o=N.subtract(a,i,Yn),u=N.magnitude(o),o=new N;r?.06<u&&Un.get_third_point(o,a,i,0,u=.06,kn):Un.get_third_point(o,a,i,0,u/=8,kn);r=u*Math.tan(Math.PI/180*30),i=new N,u=new N;Un.get_third_point(i,o,a,U.PI_OVER_TWO,r,kn),Un.get_third_point(u,o,a,U.PI_OVER_TWO,r,Ln);for(var s=0;s<n;++s)t[s]=new N,N.clone(e[s],t[s]);for(var l=[i,a,u,a],s=n;s<n+4;++s)t[s]=new N,N.clone(l[s-n],t[s]);return n+4},Xn.create_sarrow=function(t,e,n){if(2!=n)return 2<n?Un.make_middle_points(t,e,n):0;n=N.subtract(e[1],e[0],Yn),n=N.magnitude(n);return Un.get_hean_GBJ(t,n,e[0],e[1])},Xn.create_xarrow=function(t,e,n){if(2==n){var r=N.distance(e[1],e[0]);return Un.get_hean_GBJ(t,r,e[0],e[1],.2,.3,.5,.7)}if(3==n)return Un.draw_xmiddle_curve(t,e,n);if(3<n){var i=[],a=[],o=[],u=[],s=[],l=[],h=[],c=[],f=[],y=0;n%3==0?y=n-2:n%3==1?y=n-3:n%3==2&&(y=n-4);for(var p=0;p<y;p+=3){var r=N.distance(e[p],e[p+1])+N.distance(e[p+1],e[p+2])/2,d=[],g=Un.get_hean_GBJ(d,r,e[p],e[p+2],.2,.3,.5,.7);i.push(e[p]),a.push(e[p+1]),o.push(d[6]),u.push(d[5]),s.push(d[4]),l.push(d[3]),h.push(d[2]),c.push(d[1]),f.push(d[0])}for(p=0;p<parseInt(n/3);p++){var m=[],x=0;x=0==p?Un.use_bezier(m,o[p],a[p],u[p]):Un.use_five_bezier(m,c[p-1],a[p-1],i[p],a[p],u[p]);for(var _=0;_<x;_++)t.push(m[_]);t.push(u[p]),t.push(s[p]),t.push(l[p]),t.push(h[p]),t.push(c[p])}if(n%3!=2){for(m=[],x=Un.use_bezier(m,c[parseInt(n/3)-1],a[parseInt(n/3)-1],f[parseInt(n/3)-1]),p=0;p<x;p++)t.push(m[p]);n%3==1&&t.push(N.clone(e[n-1],new N))}else if(n%3==2){for(var r=N.distance(e[n-2],e[n-1]),d=[],g=Un.get_hean_GBJ(d,r,e[n-2],e[n-1],.2,.3,.5,.7),w=[],x=Un.use_four_bezier(w,c[parseInt(n/3)-1],e[n-4],e[n-2],d[5]),p=0;p<x;p++)t.push(w[p]);for(p=g-3;0<=p;p--)t.push(d[p])}return t.push(N.clone(t[0],new N)),t.length}return 0},Xn.create_equal_sarrow=function(t,e,n){if(2!=n)return 2<n?Un.make_middle_points(t,e,n,!0):0;for(var n=N.distance(e[0],e[1]),r=0;r<8;++r)t.push(new N);return Un.get_third_point(t[0],e[0],e[1],U.PI_OVER_TWO,n/10,kn),Un.get_third_point(t[6],e[0],e[1],U.PI_OVER_TWO,n/10,Ln),Un.get_third_point(t[1],t[0],e[0],U.PI_OVER_TWO,.8*n,kn),Un.get_third_point(t[5],t[6],e[0],U.PI_OVER_TWO,.8*n,Ln),Un.get_third_point(t[2],e[1],t[1],U.PI/8,n/3.15,Ln),Un.get_third_point(t[4],e[1],t[5],U.PI/8,n/3.15,kn),N.clone(e[1],t[3]),N.clone(e[0],t[7]),8},Xn.create_equal_sarrow_thin=function(t,e,n){if(2!=n)return 2<n?Un.make_middle_points(t,e,n,!0):0;n=N.subtract(e[0],e[1],Yn),n=N.magnitude(n);t=new Array(8);for(var r=0;r<8;++r)t[r]=new N;return Un.get_third_point(t[0],e[0],e[1],U.PI_OVER_TWO,n/15,kn),Un.get_third_point(t[6],e[0],e[1],U.PI_OVER_TWO,n/15,Ln),Un.get_third_point(t[1],t[0],e[0],U.PI_OVER_TWO,.6*n,kn),Un.get_third_point(t[5],t[6],e[0],U.PI_OVER_TWO,.6*n,Ln),Un.get_third_point(t[2],e[1],t[1],U.PI_OVER_SIX,n/3,Ln),Un.get_third_point(t[4],e[1],t[5],U.PI_OVER_SIX,n/3,kn),N.clone(e[1],t[3]),N.clone(e[0],t[7]),8},Xn.create_tail_sarrow=function(t,e,n){if(2!=n)return 2<n?Un.make_middle_points(t,e,n,!1,!0):0;var r=N.subtract(e[1],e[0],Yn),n=N.magnitude(r),i=[],a=Un.get_hean_GBJ(i,n,e[0],e[1]),r=new N;Un.get_third_point(r,e[0],e[1],0,.1*n,kn);for(var o=0;o<a-1;o++)t.push(i[o]);return t.push(r),N.clone(t[0],t[a]),a+1},Xn.create_double_sarrow=function(t,e,n){if(n<2||4<n)return 0;if(2==n)return t.push(N.clone(e[0])),t.push(N.clone(e[1])),t.push(N.clone(e[0])),3;var r=N.distance(e[1],e[2]),i=[];Un.get_hean_GBJ(i,r,e[1],e[2],.2,.3,.5,.7);var a=N.subtract(e[0],e[1],Yn);N.normalize(a,a);var o=N.subtract(e[2],e[1],Gn);N.normalize(o,o);a=Math.acos(N.dot(a,o)),o=[];o.push(e[0]),o.push(e[2]),o.push(e[1]);var u=!bn.is_polygon_ccw(o),o=new N;3==n?Un.get_third_point(o,e[0],e[1],a,r,u?kn:Ln):4==n&&N.clone(e[3],o);var n=N.distance(e[0],o),s=[];Un.get_hean_GBJ(s,n,e[0],o,.2,.3,.5,.7);var l=new Array(4);u?(l[0]=s[1],l[1]=i[5],l[2]=s[5],l[3]=i[1]):(l[0]=s[5],l[1]=i[1],l[2]=s[1],l[3]=i[5]);for(var h=N.distance(e[0],l[0]),c=N.distance(e[1],l[1]),f=[],y=[],p=0;p<2;p++)for(var d,g,m,x=.5*U.PI;0<=x;x-=.025*U.PI)0==p?(d=new N,m=h*Math.sin(x),g=u?kn:Ln,Un.get_third_point(d,e[0],l[0],(.5*U.PI-x)/8,m,g),f.push(d)):(d=new N,g=u?Ln:kn,m=c*Math.sin(x),Un.get_third_point(d,e[1],l[1],(.5*U.PI-x)/8,m,g),y.push(d));o=N.add(e[0],e[1],Yn);N.multiplyByScalar(o,.5,o);for(var _=[],w=Un.use_bezier(_,l[2],o,l[3]),p=0;p<f.length;p++)t.push(f[f.length-1-p]);if(u){for(p=1;p<6;p++)t.push(s[p]);for(p=0;p<w;p++)t.push(_[p]);t.push(i[1]),t.push(i[2]);var v=new N;N.clone(e[2],v),t.push(v),t.push(i[4]),t.push(i[5])}else{for(p=5;0<p;p--)t.push(s[p]);for(p=0;p<w;p++)t.push(_[p]);t.push(i[5]),t.push(i[4]);v=new N;N.clone(e[2],v),t.push(v),t.push(i[2]),t.push(i[1])}for(p=0;p<y.length;p++)t.push(y[p]);v=new N;return N.clone(e[1],v),t.push(v),v=new N,N.clone(e[0],v),t.push(v),v=new N,N.clone(t[0],v),t.push(v),t.length},Xn.create_user_define_sarrow=function(t,e,n){return 2==n?(t.push(N.clone(e[0])),t.push(N.clone(e[1])),t.push(N.clone(e[0])),3):3==n?Un.get_hean_GBJ_user_defined(t,e[0],e[1],e[2]):3<n?Un.make_middle_points(t,e,n,!1,!1,!0):0},Xn.create_user_define_tail_sarrow=function(t,e,n){if(2==n)return t.push(e[0]),t.push(e[1]),t.push(e[0]),3;if(3!=n)return 3<n?Un.make_middle_points(t,e,n,!1,!0,!0):0;var r=[],i=Un.get_hean_GBJ_user_defined(r,e[0],e[1],e[2]),a=N.add(e[0],e[1],Yn);N.multiplyByScalar(a,.5,a);var o=N.distance(a,e[2]),n=new N;Un.get_third_point(n,a,e[2],0,.2*o,kn);for(var u=0;u<i-1;u++)t.push(r[u]);t[i-1]=n;n=new N;return N.clone(t[0],n),t.push(n),i+1},Xn.create_triangle_flag=function(t,e,n,r){e=B.fromCartesian(e),n=B.fromCartesian(n),r=B.fromCartesian(r);t.push(n),t.push(r),t.push(new B((e.longitude+n.longitude)/2,(e.latitude+n.latitude)/2,(e.height+n.height)/2)),t[1].height=t[2].height,t.push(e),t.push(t[0]);for(var i=0;i<5;i++)t[i]=N.fromRadians(t[i].longitude,t[i].latitude,t[i].height);return 5},Xn.create_rect_flag=function(t,e,n,r){e=B.fromCartesian(e),n=B.fromCartesian(n),r=B.fromCartesian(r);t.push(n),t.push(r),t[1].height=t[0].height,t.push(B.clone(t[1])),t.push(new B((e.longitude+n.longitude)/2,(e.latitude+n.latitude)/2,(e.height+n.height)/2)),t[2].height=t[3].height,t.push(e),t.push(t[0]);for(var i=0;i<6;i++)t[i]=N.fromRadians(t[i].longitude,t[i].latitude,t[i].height);return 6},Xn.create_curve_flag=function(t,e,n,r){var i=[];Xn.create_rect_flag(i,e,n,r);var a=N.subtract(i[1],i[2],Yn),o=N.magnitude(a)/2,a=N.subtract(i[0],i[1],Yn),e=N.magnitude(a),n=new N,r=[new N,new N],a=[new N,new N];Un.get_third_point(n,i[0],i[1],0,e/4,kn),Un.get_third_point(r[0],n,i[0],.5*Math.PI,o,Ln),Un.get_third_point(n,i[0],i[1],0,.75*e,kn),Un.get_third_point(r[1],n,i[0],.5*Math.PI,o,kn),Un.get_third_point(n,i[3],i[2],0,e/4,kn),Un.get_third_point(a[0],n,i[3],.5*Math.PI,o,Ln),Un.get_third_point(n,i[3],i[2],0,.75*e,kn),Un.get_third_point(a[1],n,i[3],.5*Math.PI,o,kn);var u=[],o=new Array(4);o[0]=i[0],o[1]=r[0],o[2]=r[1],o[3]=i[1];var s=Un.get_bezier_points(u,o,4),l=[];o[0]=i[3],o[1]=a[0],o[2]=a[1],o[3]=i[2];for(var h=Un.get_bezier_points(l,o,4),c=0;c<s;++c)t.push(u[c]);for(c=0;c<h;c++)t.push(l[h-c-1]);return t.push(i[4]),t.push(N.clone(t[0])),s+h+2},Xn.create_assembly_area_two_pt=function(t,e,n){for(var r=N.distance(e,n),i=N.add(e,n,Yn),i=N.multiplyByScalar(i,.5,Yn),a=new Array(7),o=0;o<7;++o)a[o]=new N;Un.get_third_point(a[0],i,e,.5*U.PI,r/4.5,Ln),Un.get_third_point(a[1],n,e,0,.8*r,kn),Un.get_third_point(a[2],a[1],e,.5*U.PI,r/5,kn),Un.get_third_point(a[3],n,e,0,.45*r,kn),Un.get_third_point(a[4],a[3],e,.5*U.PI,r/10,kn),Un.get_third_point(a[5],n,e,0,.15*r,kn),Un.get_third_point(a[6],a[5],e,.5*U.PI,r/7,kn);r=new Array(8);return r[0]=e,r[1]=a[0],r[2]=n,r[3]=a[6],r[4]=a[4],r[5]=a[2],r[6]=r[0],r[7]=r[1],Un.use_advanced_bezier(t,r,r.length)},Xn.create_assembly_area_three_pt=function(t,e,n,r){for(var i=N.distance(e,n),a=new Array(6),o=0;o<6;++o)a[o]=new N;Un.get_third_point(a[0],n,e,0,.8*i,kn),Un.get_third_point(a[1],a[0],e,.5*U.PI,i/5,kn),Un.get_third_point(a[2],n,e,0,.45*i,kn),Un.get_third_point(a[3],a[2],e,.5*U.PI,i/10,kn),Un.get_third_point(a[4],n,e,0,.15*i,kn),Un.get_third_point(a[5],a[4],e,.5*U.PI,i/7,kn);i=new Array(8);return i[0]=e,i[1]=r,i[2]=n,i[3]=a[5],i[4]=a[3],i[5]=a[1],i[6]=i[0],i[7]=i[1],Un.use_advanced_bezier(t,i,i.length)},Xn.create_dotted_line=function(t,e,n,r,i,a,o){var u=[],s=[],l=i-1,h=new N;N.clone(r[l],h),u.push(h),s.push(1);for(var c=0,f=0;0<l;){var y=a[c%o],p=new N;N.clone(r[l-1],p);var d=N.subtract(p,h,Yn),g=N.magnitude(d)+f;y<g?(d=N.multiplyByScalar(d,(y-f)/(g-f),Yn),p=new N,N.add(h,d,p),u.push(p),h=p,f=0,s[s.length-1]+=1,c%2==0&&s.push(0),c++):g==y?(u.push(p),h=p,f=0,l--,s[s.length-1]+=1,c%2==0&&s.push(0),c++):(0<s[s.length-1]&&(u.push(p),s[s.length-1]+=1),h=p,f=g,0==--l&&0==s[s.length-1]&&(g=new N,N.subtract(p,u[u.length-1],g),N.multiplyByScalar(g,.9,g),N.add(u[u.length-1],g,g),u.push(g),u.push(p),s[s.length-1]=2))}return u.reverse(),s.reverse(),u.length};var jn=Object.freeze({UNKNOWN:-1,EXTERIOR:0,INTERIOR:1,VERTEX_A:2,VERTEX_B:3,VERTEX_C:4,BOUNDARY_AB:5,BOUNDARY_BC:6,BOUNDARY_AC:7});function Fn(){}function Hn(){}function Jn(t,e,n){return r=e,e=(t.y-r.y)*(t.x-n.x),r=(t.y-n.y)*(t.x-r.x),r=e-r,Math.abs(r)<1e-10?0:0<r?1:-1;var r}Fn.douglasPeuckerSimplification=function(t,e,n,r){if(t&&0!=t.length&&!(t.length<3||(r=null==r?t.length-1:r,(n=null==n?0:n)<0||r<0||n>t.length-1||r>t.length-1))){if(r-n<2){for(var i=[],a=n;a<=r;a++)i.push(t[a]);return i}for(var o,u,s,l,h=e*e,c=-1/0,f=-1,a=n+1;a<r;a++){var y=(o=t[a],u=t[n],y=t[r],l=s=void 0,s=y.latitude-u.latitude,l=u.longitude-y.longitude,u=y.longitude*u.latitude-u.longitude*y.latitude,y=s*s+l*l,u=Math.abs(s*o.longitude+l*o.latitude+u),u*=u,0==y?0:u/y);c<y&&(c=y,f=a)}if(h<c){h=Fn.douglasPeuckerSimplification(t,e,n,f),e=Fn.douglasPeuckerSimplification(t,e,f,r);return h.pop(),h.concat(e)}return[t[n],t[r]]}},Hn.point_in_triangle=function(t,e,n,r){if(t.x>e.x&&t.x>n.x&&t.x>r.x||t.x<e.x&&t.x<n.x&&t.x<r.x||t.y>e.y&&t.y>n.y&&t.y>r.y||t.y<e.y&&t.y<n.y&&t.y<r.y)return jn.EXTERIOR;var i=Jn(r,e,n),a=Jn(e,n,r),o=Jn(n,e,r),u=Jn(t,e,n),n=Jn(t,n,r),r=Jn(t,e,r);return 0!=u&&u!=i||0!=n&&n!=a||0!=r&&r!=o?jn.EXTERIOR:0!=u&&0!=n&&0!=r?jn.INTERIOR:0==u&&0==r?jn.VERTEX_A:0==u&&0==n?jn.VERTEX_B:0==r&&0==n?jn.VERTEX_C:0==u?jn.BOUNDARY_AB:0==n?jn.BOUNDARY_BC:0==r?jn.BOUNDARY_AC:jn.UNKNOWN},Hn.point_in_polygon=function(t,e){for(var n=e.length,r=!1,i=0;i<n;i++){var a,o=e[(i+n)%n],u=e[(i+1+n)%n];t.latitude<u.latitude?t.latitude>=o.latitude&&(a=(t.latitude-o.latitude)*(u.longitude-o.longitude),(t.longitude-o.longitude)*(u.latitude-o.latitude)<a&&(r=!r)):t.latitude<o.latitude&&(a=(t.latitude-o.latitude)*(u.longitude-o.longitude))<(t.longitude-o.longitude)*(u.latitude-o.latitude)&&(r=!r)}return r},Hn.point_in_polygon_cart=function(t,e){for(var n,r,i=!1,a=0,o=e.length,u=0;u<o;u++){var s=e[(u+o)%o],l=e[(u+1+o)%o];if(t.y<l.y){if(t.y>=s.y)if(1e-6<(n=(t.y-s.y)*(l.x-s.x))-(r=(t.x-s.x)*(l.y-s.y)))i=!i;else if(Math.abs(n-r)<1e-6){a=2;break}}else if(t.y<s.y){if((n=(t.y-s.y)*(l.x-s.x))-(r=(t.x-s.x)*(l.y-s.y))<-1e-6)i=!i;else if(Math.abs(n-r)<1e-6){a=2;break}}else if(t.y==l.y&&t.y==s.y){a=2;break}}return a=2!=a?i?1:0:a};var Kn=new N,Qn=new N,$n=new N;function tr(t,e,n,r,i,a,o){var u=t*i-r*e;return!(Math.abs(u)<1e-6)&&((o=!I(o)?new xn:o).x=(e*a-n*i)/u,o.y=(n*r-a*t)/u,o)}function er(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)}function nr(t){var e,n=0,n=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2));return Math.abs(n)<=0?0:(e=t.x/n,t.y,n=0<t.y?Math.acos(e):2*U.PI-Math.acos(e))}function rr(t,e,n,r){var i=[],a=0,o=xn.subtract(e,t,Qn),u=xn.subtract(n,t,$n),s=nr(o),u=nr(u),l=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));u-s>U.PI?u-=2*U.PI:s-u>U.PI&&(s-=2*U.PI),(a=Math.abs(u-s)/r)-a<.01&&--a,u-s<0&&(r*=-1),i.push(e);for(var h=1;h<a+1;++h)i.push(new xn(t.x+l*Math.cos(s+h*r),t.y+l*Math.sin(s+h*r)));return i.push(n),i}function ir(t,e,n){for(var r=0,i=0,a=t.length,o=e.length,u=[],r=0;r<a-1;++r)for(i=0;i<o-1;++i){var s=Hn.line_line_intsect(t[r],t[r+1],e[i],e[i+1],n);if(I(s))return(u=u.concat(t.slice(0,r+1))).push(s),u=u.concat(e.slice(i+1))}return u}function ar(t,e){var n,r,e=Math.abs(e.x-t.x)<1e-7?(r=0,n=1,-t.x):-((n=(t.y-e.y)/(t.x-e.x))*t.x+(r=-1)*t.y),t=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return{pa:n/=t,pb:r/=t,pc:e/=t}}function or(t,e,n){return I(n)||(n=1e-6),Math.abs(t.x-e.x)<n&&Math.abs(t.y-e.y)<n?1:0}function ur(t,e,n,r,i){var a;if(Math.abs(t.x-e.x)<1e-5&&Math.abs(t.y-e.y)<1e-5||Math.abs(n.x-r.x)<1e-5&&Math.abs(n.y-r.y)<1e-5)return-2;var o=ar(t,e),u=-(o.pa*(r.x-n.x)+o.pb*(r.y-n.y));return Math.abs(u)<1e-7?-2:(a=(o.pa*n.x+o.pb*n.y+o.pc)/u,i.x=n.x+a*(r.x-n.x),i.y=n.y+a*(r.y-n.y),r=t,n=e,t=i,e=new xn,i=new xn,1==or(r,t)||1==or(n,t)?0:(e.x=n.x-r.x,e.y=n.y-r.y,i.x=t.x-n.x,i.y=t.y-n.y,xn.normalize(e,e),xn.normalize(i,i),Math.abs(i.x-e.x)<1e-7&&Math.abs(i.y-e.y)<1e-7?1:(e.x=n.x-t.x,e.y=n.y-t.y,i.x=t.x-r.x,i.y=t.y-r.y,xn.normalize(e,e),xn.normalize(i,i),Math.abs(i.x-e.x)<1e-7&&Math.abs(i.y-e.y)<1e-7?1:(e.x=n.x-r.x,e.y=n.y-r.y,i.x=r.x-t.x,i.y=r.y-t.y,xn.normalize(e,e),xn.normalize(i,i),Math.abs(i.x-e.x)<1e-7&&Math.abs(i.y-e.y)<1e-7?-1:-2))))}function sr(t,e){for(var n=0,r=0,i=t.length,a=[],n=0;n<i-1;++n)for(r=i-2;n+1<r;--r){var o=Hn.line_line_intsect(t[n],t[n+1],t[r],t[r+1],e);if(I(o))return a.push(o),(a=a.concat(t.slice(n+1,r+1))).push(o),a}return a}function lr(t,e,n,r){var i,a=0,o=t.length,u=new xn,s=[],l=[];for(c=t[0],a=0;a<o-1;++a)if(0<(s=ir(c,t[a+1])).length)c=s;else if(-1==(i=ur(t[a+1][0],t[a+1][1],c[c.length-1],c[c.length-2],u))&&r){c.pop(),c.push(xn.clone(u,new xn));var h=t[a+1].slice(1),c=c.concat(h)}else{if(1==i)l.push(c),c=t[a+1];else{(s=rr(e[a+1],c[c.length-1],t[a+1][0],n)).pop();var f=ir(h=c.slice(0,c.length-1),s);if(0<f.length){c=(c=f).concat(t[a+1]);continue}s.splice(0,1),c=(c=0<s.length?c.concat(s):c).concat(t[a+1])}0<l.length&&0<(s=ir(l[0],c)).length&&(c=s,l=[])}or(e[0],e[e.length-1])&&(0<(s=sr(c)).length?c=s:((s=rr(e[0],c[c.length-1],c[0],n)).splice(0,1),0<s.length&&(c=c.concat(s))));for(var y=[],o=c.length,a=0;a<o;++a)y.push(xn.clone(c[a]));return y}function hr(t,e,n,r){for(var i=0,a=new xn,o=[],u=[],s=t[0],i=0,l=t.length;i<l-1;++i)0<(o=function(t,e,n){for(var r=0,i=0,a=t.length,o=e.length,u=[],r=a-2;0<=r;--r)for(i=0;i<o-1;++i){var s=Hn.line_line_intsect(t[r],t[r+1],e[i],e[i+1],n);if(I(s))return 0==r&&0==i&&2<a?0:((u=u.concat(t.slice(0,r+1))).push(s),u=u.concat(e.slice(i+1)))}return u}(s,t[i+1],0==r)).length?s=o:(s=1==ur(t[i+1][0],t[i+1][1],s[s.length-1],s[s.length-2],a)?(u.push(s),t[i+1]):(o=[],(o=rr(e[i+1],s[s.length-1],t[i+1][0],n)).pop(),o.splice(0,1),(s=0<o.length?s.concat(o):s).concat(t[i+1])),0<u.length&&0<(o=ir(u[0],s,0==r)).length&&(s=o,u=[]));return or(e[0],e[e.length-1])&&(0<u.length?(o=[],(o=rr(e[0],s[s.length-1],u[0][0],n)).pop(),o.splice(0,1),o=o.concat(u[0]),u[0]=o,0<(o=sr(u[0])).length?(s=o,u=[]):(o=[],(o=rr(e[0],s[s.length-1],s[0],n)).splice(0,1),0<o.length&&(s=s.concat(o)))):0<(o=sr(s,0==r)).length?s=o:(o=[],(o=rr(e[0],s[s.length-1],s[0],n)).splice(0,1),0<o.length&&(s=s.concat(o)))),s}function cr(t,e){var n=0;return n+=Math.abs(Number(t.r)-Number(e.r)),n+=Math.abs(Number(t.g)-Number(e.g)),n+=Math.abs(Number(t.b)-Number(e.b))}function fr(t,e,n,r){this.r=t,this.g=e,this.b=n,this.a=r}Hn.createPolygonFromPolylineAndWidth=function(t,e,n){var r=t.length;if(r<2)return i;var i=new Array(2*r);if(2==r){var a=t[0],o=t[1],u=N.cross(a,o,Kn),s=N.normalize(u,u);i[0]=N.multiplyByScalar(s,e,new N),N.subtract(a,i[0],i[0]),i[3]=N.multiplyByScalar(s,n,new N),N.add(a,i[3],i[3]),i[1]=N.multiplyByScalar(s,e,new N),N.subtract(o,i[1],i[1]),i[2]=N.multiplyByScalar(s,n,new N),N.add(o,i[2],i[2])}else{a=t[0],o=t[1],u=N.cross(a,o,Kn),s=N.normalize(u,u);i[0]=N.multiplyByScalar(s,e,new N),N.subtract(a,i[0],i[0]),i[2*r-1]=N.multiplyByScalar(s,n,new N),N.add(a,i[2*r-1],i[2*r-1]);for(var l=1;l<r-1;l++){var a=t[l-1],o=t[l],h=t[l+1],c=N.cross(a,o,Qn);N.normalize(c,c);var f=N.cross(o,h,$n);N.normalize(f,f);s=N.midpoint(c,f,Kn);N.normalize(s,s);h=N.subtract(a,o,Qn);N.normalize(h,h);c=N.dot(h,s);c<0&&(f=N.negate(s,$n),c=N.dot(h,f)),c=Math.acos(c)<+U.RADIANS_PER_DEGREE?1:1/Math.sin(Math.acos(c)),i[l]=N.multiplyByScalar(s,e*c,new N),N.subtract(o,i[l],i[l]),i[2*r-1-l]=N.multiplyByScalar(s,n*c,new N),N.add(o,i[2*r-1-l],i[2*r-1-l])}a=t[r-2],o=t[r-1],s=N.cross(a,o,Kn);N.normalize(s,s),i[r-1]=N.multiplyByScalar(s,e,new N),N.subtract(o,i[r-1],i[r-1]),i[r]=N.multiplyByScalar(s,n,new N),N.add(o,i[r],i[r])}return i},Hn.CreatePolygonBufferFromPolyline=function(t,e,n,r,i,a){for(var o=t.length,u=[],s=[],l=new B,h=new B(0,0,Number.MAX_VALUE),c=0;c<o;c++){var f=B.fromDegrees(t[c].longitude,t[c].latitude,t[c].height,l);h.longitude+=f.longitude,h.latitude+=f.latitude,h.height=Math.min(h.height,f.height)}h.longitude/=o,h.latitude/=o;var y=new Ge({});y.set_position_sphr(h);var p=at.inverse(y.mat_tnb,new at);for(c=0;c<o;c++)s.push(N.fromDegrees(t[c].longitude,t[c].latitude,t[c].height)),at.multiplyByVector(p,s[c],s[c]),s[c].y=s[c].z,s[c].z=0,u.push(new xn(s[c].x,s[c].y));var d=Hn.cal_line_buffer(u,e,n,r,i,a),g=new N(0,0,0),m=[];for(d.length,c=0;c<d.length;++c)g.x=d[c].x,g.z=d[c].y,g.y=0,at.multiplyByVector(y.mat_tnb,g,g),m.push(B.fromCartesian(g)),m[c].longitude=U.toDegrees(m[c].longitude),m[c].latitude=U.toDegrees(m[c].latitude);return m},Hn.CreatePolygonBufferFromPolygon=function(t,e,n,r,i){t.push(B.clone(t[0]));for(var a=t.length,o=[],u=[],s=[],l=new B,h=new B(0,0,Number.MAX_VALUE),c=0;c<a;c++){var f=B.fromDegrees(t[c].longitude,t[c].latitude,t[c].height,l);h.longitude+=f.longitude,h.latitude+=f.latitude,h.height=Math.min(h.height,f.height)}h.longitude/=a,h.latitude/=a;var y=new Ge({});y.set_position_sphr(h);var p=at.inverse(y.mat_tnb,new at);for(c=0;c<a;c++)s.push(N.fromDegrees(t[c].longitude,t[c].latitude,t[c].height)),at.multiplyByVector(p,s[c],s[c]),s[c].y=s[c].z,s[c].z=0,o.push(new xn(s[c].x,s[c].y));var r=function(t,e,n,r){if(e<=0)return 0;var i=0,a=0,o=0,u=0,s=[],l=[];if((u=t.length)<=3)return 0;var h=!1;if(!or(t[0],t[u-1]))return 0;var c=new xn;new xn,new xn;var f=new xn,y=new xn,p=[],d=[],g=[],m=[],x=[],_=0,w=0,v=0,z=0,M=[],b=[],I=[],O=[],E=2*Math.PI/r;for(i=0;i<u-1;++i){var S=ar(t[i],t[i+1]);if(p[i]=S.pa,d[i]=S.pb,g[i]=S.pc,m[i]=g[i]+.1,x[i]=g[i]-.1,_=d[i],w=-1*p[i],v=p[i]*t[i].y-d[i]*t[i].x,z=p[i]*t[i+1].y-d[i]*t[i+1].x,tr(p[i],d[i],m[i],_,w,v,c),0<er(t[i],t[i+1],c)?(xn.clone(c,f),tr(p[i],d[i],m[i],_,w,z,c),f.x=.5*(f.x+c.x),f.y=.5*(f.y+c.y),tr(p[i],d[i],x[i],_,w,v,c),xn.clone(c,y),tr(p[i],d[i],x[i],_,w,z,c),y.x=.5*(y.x+c.x),y.y=.5*(y.y+c.y)):(xn.clone(c,y),tr(p[i],d[i],m[i],_,w,z,c),y.x=.5*(y.x+c.x),y.y=.5*(y.y+c.y),tr(p[i],d[i],x[i],_,w,v,c),xn.clone(c,f),tr(p[i],d[i],x[i],_,w,z,c),f.x=.5*(f.x+c.x),f.y=.5*(f.y+c.y)),a=Hn.point_in_polygon_cart(f,t),o=Hn.point_in_polygon_cart(y,t),0==a&&1==o){h=!1;break}if(1==a&&0==o){h=!0;break}}for(i=0;i<u-1;++i){S=ar(t[i],t[i+1]);p[i]=S.pa,d[i]=S.pb,g[i]=S.pc,t[i+1].x>=t[i].x?(m[i]=g[i]+e,x[i]=g[i]-e):(m[i]=g[i]-e,x[i]=g[i]+e),_=d[i],w=-1*p[i],v=p[i]*t[i].y-d[i]*t[i].x,z=p[i]*t[i+1].y-d[i]*t[i+1].x,tr(p[i],d[i],m[i],_,w,v,c),0<er(t[i],t[i+1],c)?(M.push(xn.clone(c)),tr(p[i],d[i],m[i],_,w,z,c),M.push(xn.clone(c)),tr(p[i],d[i],x[i],_,w,v,c),b.push(xn.clone(c)),tr(p[i],d[i],x[i],_,w,z,c),b.push(xn.clone(c))):(b.push(xn.clone(c)),tr(p[i],d[i],m[i],_,w,z,c),b.push(xn.clone(c)),tr(p[i],d[i],x[i],_,w,v,c),M.push(xn.clone(c)),tr(p[i],d[i],x[i],_,w,z,c),M.push(c))}for(i=0;i<u-1;++i){var P=[];P.push(M[2*i]),P.push(M[2*i+1]),I.push(P);P=[];P.push(b[2*i]),P.push(b[2*i+1]),O.push(P)}r=hr(I,t,E,n),n=hr(O,t,E,n);l=h?(s=s.concat(n),l.concat(r)):(s=s.concat(r),l.concat(n));return{out:s,in:l}}(o,e,n,r),u=0==i?r.out:1==i?r.in:r.out.concat(r.in),d=new N(0,0,0),g=[];for(u.length,c=0;c<u.length;++c)d.x=u[c].x,d.z=u[c].y,d.y=0,at.multiplyByVector(y.mat_tnb,d,d),g.push(B.fromCartesian(d)),g[c].longitude=U.toDegrees(g[c].longitude),g[c].latitude=U.toDegrees(g[c].latitude);return t.pop(),g},new N,Hn.calculate_length=function(t,e){for(var n=0,r=t.length-1,i=0,a=r;i<a;i++){var o=N.subtract(t[i+1],t[i],Kn);n+=N.magnitude(o)}return(e=!I(e)?!1:e)&&(o=N.subtract(t[0],t[r],Kn),n+=N.magnitude(o)),n},Hn.line_line_intersect_simp_xy=function(t,e,n,r){var i=bn.JudgeSide(n,t,e),a=bn.JudgeSide(r,t,e);return 0==i?!(t.x!=e.x&&0<(n.x-t.x)*(n.x-e.x))&&!(t.y!=e.y&&0<(n.y-t.y)*(n.y-e.y)):0==a?!(t.x!=e.x&&0<(r.x-t.x)*(r.x-e.x))&&!(t.y!=e.y&&0<(r.y-t.y)*(r.y-e.y)):i!=a&&bn.JudgeSide(t,n,r)!=bn.JudgeSide(e,n,r)},Hn.line_line_intersect_simp=function(t,e,n,r){var i=bn.JudgeSide(n,t,e),a=bn.JudgeSide(r,t,e);return 0==i?!(t.x!=e.x&&0<(n.x-t.x)*(n.x-e.x))&&!(t.z!=e.z&&0<(n.z-t.z)*(n.z-e.z)):0==a?!(t.x!=e.x&&0<(r.x-t.x)*(r.x-e.x))&&!(t.z!=e.z&&0<(r.z-t.z)*(r.z-e.z)):i!=a&&bn.JudgeSide(t,n,r)!=bn.JudgeSide(e,n,r)},Hn.line_line_intsect=function(t,e,n,r,i,a){var o,u=0,s=0,l=0;if(I(i)||(i=!0),!(Math.abs(t.x-e.x)<1e-6&&Math.abs(t.y-e.y)<1e-6||Math.abs(n.x-r.x)<1e-6&&Math.abs(n.y-r.y)<1e-6||(l=Math.abs(t.x-e.x)<1e-6?(s=0,u=1,-t.x):-((u=(t.y-e.y)/(t.x-e.x))*t.x+(s=-1)*t.y),h=-(u*(r.x-n.x)+s*(r.y-n.y)),Math.abs(h)<1e-6||((o=(u*n.x+s*n.y+l)/h)<0||1<o)&&i))){var h=n.x+o*(r.x-n.x),n=n.y+o*(r.y-n.y),c=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),f=Math.sqrt((t.x-h)*(t.x-h)+(t.y-n)*(t.y-n)),y=Math.sqrt((e.x-h)*(e.x-h)+(e.y-n)*(e.y-n));return Math.abs(c-f-y)<1e-4||!i?((a=!I(a)?new xn:a).x=h,a.y=n,a):void 0}},Hn.cal_line_buffer=function(t,e,n,r,i,a){var o=void 0;if(!(e<=0)){var u=0,s=t.length,l=new xn,h=new xn,c=new xn;if(!(s<2)){for(var f,y,p,d,g,m,x,_=[],w=[],v=[],z=[],M=[],b=[],I=[],O=[],E=[],r=2*U.PI/r,u=0;u<s-1;++u){var S=ar(t[u],t[u+1]);_.push(S.pa),w.push(S.pb),v.push(S.pc),t[u+1].x>=t[u].x?(z.push(v[u]+e),M.push(v[u]-e)):(z.push(v[u]-e),M.push(v[u]+e)),f=w[u],y=-1*_[u],p=_[u]*t[u].y-w[u]*t[u].x,d=_[u]*t[u+1].y-w[u]*t[u+1].x,tr(_[u],w[u],z[u],f,y,p,l),0<er(t[u],t[u+1],l)?(b.push(xn.clone(l)),tr(_[u],w[u],z[u],f,y,d,l),b.push(xn.clone(l)),tr(_[u],w[u],M[u],f,y,p,l),I.push(xn.clone(l)),tr(_[u],w[u],M[u],f,y,d,l),I.push(xn.clone(l))):(I.push(xn.clone(l)),tr(_[u],w[u],z[u],f,y,d,l),I.push(xn.clone(l)),tr(_[u],w[u],M[u],f,y,p,l),b.push(xn.clone(l)),tr(_[u],w[u],M[u],f,y,d,l),b.push(xn.clone(l)))}for(M=z=v=w=_=void 0,g=e/Math.sqrt(Math.pow(t[0].x-t[1].x,2)+Math.pow(t[0].y-t[1].y,2)),h.x=g*(t[0].x-t[1].x)+t[0].x,h.y=g*(t[0].y-t[1].y)+t[0].y,g=e/Math.sqrt(Math.pow(t[s-1].x-t[s-2].x,2)+Math.pow(t[s-1].y-t[s-2].y,2)),c.x=g*(t[s-1].x-t[s-2].x)+t[s-1].x,c.y=g*(t[s-1].y-t[s-2].y)+t[s-1].y,1==n?(O.push([t[0],b[0],b[1]]),E.push([t[0],I[0],I[1]])):((m=rr(t[0],h,b[0],r)).push(b[1]),O.push(m),(m=rr(t[0],h,I[0],r)).push(I[1]),E.push(m)),u=1;u<s-2;++u){var P=[];P.push(b[2*u]),P.push(b[2*u+1]),O.push(P);P=[];P.push(I[2*u]),P.push(I[2*u+1]),E.push(P)}if(2==s){switch(1==n?(O[0].push(t[1]),E[0].push(t[1])):((m=rr(t[s-1],b[2*s-3],c,r)).splice(0,1),O[0]=O[0].concat(m),(m=rr(t[s-1],I[2*s-3],c,r)).splice(0,1),E[0]=E[0].concat(m)),i){case 1:o=O[0];break;case 2:o=E[0];break;default:(o=O[0]).pop(),o=o.concat(E[0].reverse())}return o}1==n?((x=[]).push(b[2*s-4]),x.push(b[2*s-3]),x.push(t[t.length-1]),O.push(x),(x=[]).push(I[2*s-4]),x.push(I[2*s-3]),x.push(t[t.length-1]),E.push(x)):((x=rr(t[s-1],b[2*s-3],c,r)).splice(0,0,b[2*s-4]),O.push(x),(c=rr(t[s-1],I[2*s-3],c,r)).splice(0,0,I[2*s-4]),E.push(c));var R=lr(O,t,r,a),A=lr(E,t,r,a),T=void 0;switch(i){case 1:(T=R).pop(),T=T.concat(t.reverse());break;case 2:(T=A).pop(),T=T.concat(t.reverse());break;default:(T=R).pop(),T=T.concat(A.reverse())}return T}}},Hn.calculate_polyline_add_interpolation=function(t,e,n){if(!(null==t||t.length<2)){for(var r,i=t.length,a=new B(0,0,Number.MAX_VALUE),o=0;o<i;o++)r=B.fromCartesian(t[o]),a.longitude+=r.longitude,a.latitude+=r.latitude,a.height=Math.min(a.height,r.height);a.longitude/=i,a.latitude/=i;at.clone(at.IDENTITY);var u=at.clone(at.IDENTITY),s=N.fromRadians(a.longitude,a.latitude),l=Ze.transform_from_cartesian_d(s.x,s.z,s.y);at.multiply(at.TRANSYZ,l,l),at.inverse(l,u);for(var h=new Array(i),c=new N,o=0;o<i;o++)at.multiplyByPoint(u,t[o],c),h[o]=new N,h[o].x=c.x,h[o].y=c.y,h[o].z=c.z;var f=[];f.push(h[0]);for(var y=new N,p=new N,d=new N,g=0;g<i-1;g++){var m=h[g],x=h[g+1],_=1;for(N.subtract(x,m,y),N.normalize(y,p);;){if(N.multiplyByScalar(p,e*_,d),!(N.magnitude(d)<N.magnitude(y))){f.push(x);break}var w=new N;N.add(m,d,w),f.push(w),_++}}for(var v=f.length,z=new Array(v),M=0;M<v;M++)at.multiplyByPoint(l,f[M],f[M]),z[M]=B.fromCartesian(f[M]),z[M].height=0;return z}},Hn.get_skyline_pic=function(t,e,n,r){for(var i=0;i<t.length;i+=4)Math.abs(0-e[i])<=8&&Math.abs(0-e[i+1])<=8&&Math.abs(0-e[i+2])<=8?(e[i]=255,e[i+1]=255,e[i+2]=255):(e[i]=0,e[i+1]=0,e[i+2]=0),e[i+3]=255;for(var a=0;a<r-1;a++)for(var o=0;o<n-1;o++){var u=4*(o+a*n),s=4*(o+a*n)+1,l=4*(o+a*n)+2,h=4*(o+a*n)+3,c=4*(o+1+a*n),f=4*(o+1+a*n)+1,y=4*(o+1+a*n)+2,p=4*(o+1+a*n)+3,d=4*(o+(a+1)*n),g=4*(o+(a+1)*n)+1,m=4*(o+(a+1)*n)+2,x=4*(o+(a+1)*n)+3,_=new fr(e[u],e[s],e[l],e[h]),p=new fr(e[c],e[f],e[y],e[p]),x=new fr(e[d],e[g],e[m],e[x]),p=cr(_,p),x=cr(_,x);(200<=p||200<=x)&&(t[u]=255,t[s]=0,t[l]=0,t[h]=255)}},Hn.calulate_rect=function(t){for(var e=0,n={max_x:t[0].x,max_y:t[0].y,min_x:t[0].x,min_y:t[0].y},e=0;e<t.length;++e)t[e].x>n.max_x?n.max_x=t[e].x:t[e].x<n.min_x&&(n.min_x=t[e].x),t[e].y>n.max_y?n.max_y=t[e].y:t[e].y<n.min_y&&(n.min_y=t[e].y);return n},Hn.insert_dot_num=function(t,e){if(e<0)return 1;for(var n=0,r=0,i=t.length,n=0;n<i-1;++n)r+=Math.sqrt(pow(t[n].x-t[n+1].x,2)+pow(t[n].y-t[n+1].y,2));return this.insert_dot(t,r/e),1},Hn.insert_dot=function(t,e){for(var n,r,i=0,a=0,o=[],u=t.length,i=0;i<u-1;++i)if(o.push(t[i]),e<(r=Math.sqrt(Math.pow(t[i].x-t[i+1].x,2)+Math.pow(t[i].y-t[i+1].y,2))))for(n=parseInt(r/e),a=0;a<n;++a){var s=new N,l=parseFloat(a+1)/(n+1);s.x=t[i].x+l*(t[i+1].x-t[i].x),s.y=t[i].y+l*(t[i+1].y-t[i].y),s.z=0,o.push(s)}for(o.push(t[i]),i=t.length=0;i<o.length;++i)t.push(o[i]);return 1},Hn.get_nearestdot=function(t,e){var n,r=0,i=0,a=0,o=new N,u=new xn;for(N.subtract(e,t[0],o),a=N.magnitude(o),r=1;r<t.size();++r)N.subtract(e,t[r],o),u.x=o.x,u.y=o.y,(n=xn.magnitude(u))<a&&(i=r,a=n);return i},Hn.insert_dot_inner=function(t,e,n,r,i){var a=0,o=0;void 0===i&&(i=1e-4);for(var u=this.calulate_rect(t),s=2+parseInt((u.max_x-u.min_x)/e),l=2+parseInt((u.max_y-u.min_y)/n),h=u.min_x+.5*e,c=u.min_y+.5*n,a=0;a<s;++a)for(o=0;o<l;++o){var f=new N;f.x=h+a*e,f.y=c+o*n,f.z=0,1==this.point_in_polygon_cart(f,t)&&i<this.cal_dis_dot_to_lines(t,f)&&r.push(f)}return 1},Hn.insert_dot_inner_num=function(t,e,n,r,i){var a=this.calulate_rect(t),o=(a.max_x-a.min_x)/e,u=(a.max_y-a.min_y)/n;return this.insert_dot_inner(t,o,u,r,i)},Hn.cal_distance_dot_line=function(t,e,n){var r,i=new N,a=new N;return a.x=e.x-t.x,a.y=e.y-t.y,a.z=e.z-t.z,N.normalize(a,a),r=a.x*(n.x-t.x)+a.y*(n.y-t.y)+a.z*(n.z-t.z),i.x=a.x*r+t.x,i.y=a.y*r+t.y,i.z=a.z*r+t.z,Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y)+(i.z-n.z)*(i.z-n.z))},Hn.cal_dis_dot_to_lines=function(t,e){var n=0,r=0,i=0,a=0;if((r=t.length-1)<0)return 0;for(i=Math.sqrt(Math.pow(t[0].x-e.x,2)+Math.pow(t[0].y-e.y,2)+Math.pow(t[0].z-e.z,2)),n=0;n<r;++n)(a=this.cal_distance_dot_line(t[n],t[n+1],e))<i&&(i=a),(a=Math.sqrt(Math.pow(t[n].x-e.x,2)+Math.pow(t[n].y-e.y,2)+Math.pow(t[n].z-e.z,2)))<i&&(i=a),(a=Math.sqrt(Math.pow(t[n+1].x-e.x,2)+Math.pow(t[n+1].y-e.y,2)+Math.pow(t[n+1].z-e.z,2)))<i&&(i=a);return i},Hn.douglasPeuckerSimplification=function(t,e){if(t&&!(t.length<3)){var n=t.concat();return Math.abs(n[0].longitude-n[t.length-1].longitude)<1e-9&&Math.abs(n[0].latitude-n[t.length-1].latitude)<1e-9&&n.pop(),Fn.douglasPeuckerSimplification(n,e)}},Hn.CalculateLineLineDistance=function(t,e){if(null!=t&&null!=e){var n=t.length,r=e.length;if(!(n<2||r<2)){var i=[];i.length=n;for(var a={x:0,y:0,z:99999},o=0;o<n;o++)i[o]=new N,i[o].x=U.toRadians(t[o].x),i[o].y=U.toRadians(t[o].y),i[o].z=t[o].z,a.x+=i[o].x,a.y+=i[o].y,a.z=Math.min(a.z,i[o].z);a.x/=n,a.y/=n;var u=N.fromRadians(a.x,a.y,a.z),s=Ze.transform_from_cartesian_d(u.x,u.z,u.y);at.multiply(at.TRANSYZ,s,s);var l=at.clone(at.IDENTITY);at.inverse(s,l);for(o=0;o<n;o++)N.fromRadians(i[o].x,i[o].y,i[o].z,void 0,i[o]),at.multiplyByPoint(l,i[o],i[o]),i[o].y=i[o].z,i[o].z=0;var h=[];h.length=r;for(o=0;o<r;o++)h[o]=new N,h[o].x=U.toRadians(e[o].x),h[o].y=U.toRadians(e[o].y),h[o].z=e[o].z,N.fromRadians(h[o].x,h[o].y,h[o].z,void 0,h[o]),at.multiplyByPoint(l,h[o],h[o]),h[o].y=h[o].z,h[o].z=0;for(var c,f,y=0;y<n-1;y++)for(var p=i[y],d=i[(y+1)%n],g=0;g<r-1;g++)if(c=h[g],f=h[(g+1)%r],Hn.line_line_intersect_simp_xy(p,d,c,f))return!1;for(var m,x,_=99999,w=0,v=new N,z=new N,M=new N,y=0;y<n;y++)for(var b=i[y],g=0;g<r-1;g++)m=h[g],x=h[(g+1)%r],(w=Hn.PointSegementDistance(b,m,x,M))<_&&(_=w,N.clone(b,v),N.clone(M,z));for(y=0;y<r;y++)for(b=h[y],g=0;g<n-1;g++)m=i[g],x=i[(g+1)%n],(w=Hn.PointSegementDistance(b,m,x,M))<_&&(_=w,N.clone(M,v),N.clone(b,z));v.z=v.y,v.y=0,at.multiplyByPoint(s,v,v);u=new B;B.fromCartesian(v,void 0,u),v.x=U.toDegrees(u.longitude),v.y=U.toDegrees(u.latitude),v.z=u.height,z.z=z.y,z.y=0,at.multiplyByPoint(s,z,z),B.fromCartesian(z,void 0,u),z.x=U.toDegrees(u.longitude),z.y=U.toDegrees(u.latitude),z.z=u.height;u={m_line:[]};return u.m_line.length=2,u.m_line[0]=v,u.m_line[1]=z,u.m_dis=_,u}}},Hn.PointSegementDistance=function(t,e,n,r){var i=N.distance(e,n);if(i<1e-10)return N.clone(e,r),N.distance(t,e);var a=((e.y-t.y)*(e.y-n.y)-(e.x-t.x)*(n.x-e.x))/(i*i);if(1<a||a<-1e-10){var o=N.distance(t,e),u=N.distance(t,n);return u<o?(r=n,u):(r=e,o)}N.subtract(n,e,r),N.multiplyByScalar(r,a,r),N.add(r,e,r);e=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/(i*i);return Math.abs(e*i)},Hn.CalculateLineLineSpaceDistance=function(t,e){if(null!=t&&null!=e){var n=t.length,r=e.length;if(!(n<2||r<2)){var i=[];i.length=n;for(var a={x:0,y:0,z:99999},o=0;o<n;o++)i[o]=new N,i[o].x=U.toRadians(t[o].x),i[o].y=U.toRadians(t[o].y),i[o].z=t[o].z,a.x+=i[o].x,a.y+=i[o].y,a.z=Math.min(a.z,i[o].z);a.x/=n,a.y/=n;var u=N.fromRadians(a.x,a.y,a.z),s=Ze.transform_from_cartesian_d(u.x,u.z,u.y);at.multiply(at.TRANSYZ,s,s);var l=at.clone(at.IDENTITY);at.inverse(s,l);for(o=0;o<n;o++)N.fromRadians(i[o].x,i[o].y,i[o].z,void 0,i[o]),at.multiplyByPoint(l,i[o],i[o]);var h=[];h.length=r;for(o=0;o<r;o++)h[o]=new N,h[o].x=U.toRadians(e[o].x),h[o].y=U.toRadians(e[o].y),h[o].z=e[o].z,N.fromRadians(h[o].x,h[o].y,h[o].z,void 0,h[o]),at.multiplyByPoint(l,h[o],h[o]);for(var c,f=99999,y=0,p=new N,d=new N,g=!1,m=new N,x=new N,_=0;_<n-1;_++)for(var w=i[_],v=i[(_+1)%n],z=0;z<r-1;z++){c=h[z],E=h[(z+1)%r],N.subtract(v,w,m),N.subtract(E,c,x);var M=m.x*m.y*x.y-m.y*m.y*x.x-m.z*m.z*x.x+m.x*m.z*x.z,b=m.x*m.x*x.y-m.x*m.y*x.x-m.y*m.z*x.z+m.z*m.z*x.y,I=m.x*m.z*x.x-m.x*m.x*x.z-m.y*m.y*x.z+m.y*m.z*x.y,O=-w.x*M+w.y*b-w.z*I,E=(b*c.y-M*c.x-I*c.z-O)/(M*x.x-b*x.y+I*x.z);0<=E&&E<=1&&(M=x.x*x.y*m.y-x.y*x.y*m.x-x.z*x.z*m.x+x.x*x.z*m.z,b=x.x*x.x*m.y-x.x*x.y*m.x-x.y*x.z*m.z+x.z*x.z*m.y,I=x.x*x.z*m.x-x.x*x.x*m.z-x.y*x.y*m.z+x.y*x.z*m.y,O=-c.x*M+c.y*b-c.z*I,0<=(I=(b*w.y-M*w.x-I*w.z-O)/(M*m.x-b*m.y+I*m.z))&&I<=1&&(p.x=m.x*I+w.x,p.y=m.y*I+w.y,p.z=m.z*I+w.z,d.x=x.x*E+c.x,d.y=x.y*E+c.y,d.z=x.z*E+c.z,(y=N.distance(p,d))<f&&(f=y,g=!0)))}if(!g){for(var S,P,R=new N,_=0;_<n;_++)for(var A=i[_],z=0;z<r-1;z++)S=h[z],P=h[(z+1)%r],(y=Hn.PointSegementSpaceDistance(A,S,P,R))<f&&(f=y,N.clone(R,d),N.clone(A,p));for(_=0;_<r;_++)for(A=h[_],z=0;z<n-1;z++)S=i[z],P=i[(z+1)%n],(y=Hn.PointSegementSpaceDistance(A,S,P,R))<f&&(f=y,N.clone(R,p),N.clone(A,d))}at.multiplyByPoint(s,p,p);u=new B;B.fromCartesian(p,void 0,u),p.x=U.toDegrees(u.longitude),p.y=U.toDegrees(u.latitude),p.z=u.height,at.multiplyByPoint(s,d,d),B.fromCartesian(d,void 0,u),d.x=U.toDegrees(u.longitude),d.y=U.toDegrees(u.latitude),d.z=u.height;u={m_line:[]};return u.m_line.length=2,u.m_line[0]=p,u.m_line[1]=d,u.m_dis=f,u}}};var yr,pr,dr=new N,gr=new N;function mr(t,e){return Math.abs(t.dot-e.dot)<1e-10?0:t.dot<e.dot?-1:1}function xr(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function _r(t,e){return Math.abs(t.dot.x-e.dot.x)<1e-10?Math.abs(t.dot.y-e.dot.y)<1e-10?0:t.dot.y<e.dot.y?-1:1:t.dot.x<e.dot.x?-1:1}function wr(t){if(!(t.length<1)){for(var e=0,n=[],r=t.length,i=new Array(r),a=0;a<i.length;++a)i[a]=0;for(;;){for(e=0;e<r&&0!=i[e];++e);if(r<=e)break;var o=[];!function(t,e,n,r){var i=0,a=0,o=0,u=0,s=t.length;for(e[n]=1,r.push(t[n][0]),r.push(t[n][1]);;){for(a=0,i=n+1;i<s;++i)e[i]||(o=r[0],u=r[r.length-1],o==t[i][0]?(r.splice(0,0,t[i][1]),a=e[i]=1):o==t[i][1]?(r.splice(0,0,t[i][0]),a=e[i]=1):u==t[i][0]?(r.push(t[i][1]),a=e[i]=1):u==t[i][1]&&(r.push(t[i][0]),a=e[i]=1));if(0==a)break;if((o=r[0])==(u=r[r.length-1]))break}}(t,i,e,o),n.push(o)}return n}}function vr(t){if(!(t.length<1)){for(var e=0,n=[],r=t.length,i=new Array(r),a=0;a<i.length;++a)i[a]=0;for(;;){for(e=0;e<r&&0!=i[e];++e);if(r<=e)break;var o=function(t,e,n){var r=0,i=0,a=void 0,o=void 0,u=[],s=t.length;for(e[n]=1,u.push(t[n][0]),u.push(t[n][1]);;){for(i=0,r=n+1;r<s;++r)e[r]||(a=u[0],o=u[u.length-1],Math.abs(a.x-t[r][0].x)<1e-9&&Math.abs(a.y-t[r][0].y)<1e-9?(u.splice(0,0,t[r][1]),i=e[r]=1):Math.abs(a.x-t[r][1].x)<1e-9&&Math.abs(a.y-t[r][1].y)<1e-9?(u.splice(0,0,t[r][0]),i=e[r]=1):Math.abs(o.x-t[r][0].x)<1e-9&&Math.abs(o.y-t[r][0].y)<1e-9?(u.push(t[r][1]),i=e[r]=1):Math.abs(o.x-t[r][1].x)<1e-9&&Math.abs(o.y-t[r][1].y)<1e-9&&(u.push(t[r][0]),i=e[r]=1));if(0==i)break;if(a=u[0],o=u[u.length-1],Math.abs(a.x-o.x)<1e-9&&Math.abs(a.y-o.y)<1e-9)break}return u}(t,i,e);n.push(o)}return n}}function zr(t,e){return Math.abs(t.x-e.x)<1e-6&&Math.abs(t.y-e.y)<1e-6&&Math.abs(t.z-e.z)<1e-6}function Mr(t){if(!(t.length<=0)){for(var e=[],n=0;n<t.length;++n)(r=[]).push(t[n][0]),r.push(t[n][t[n].length-1]),e.push(r);if(1==(e=vr(e)).length)return e[0];for(var r,i=[],n=0;n<e.length;++n){(r=[]).push(e[n][0]);for(var a=0;a<e[n].length-1;++a)for(var o=0;o<t.length;++o){if(zr(e[n][a],t[o][0])&&zr(e[n][a+1],t[o][t[o].length-1])){r.pop(),r=r.concat(t[o]);break}if(zr(e[n][a],t[o][t[o].length-1])&&zr(e[n][a+1],t[o][0])){r.pop(),t[o].reverse(),r=r.concat(t[o]);break}}i.push(r)}if(i.length<=1)return i[0];for(var u=[],s=(t=i).length,l=[],n=0;n<s;++n){var h=t[n].length;l.push(new xn(t[n][0].x,t[n][0].y)),l.push(new xn(t[n][h-1].x,t[n][h-1].y))}new xn;for(var c,f,y={},n=0;n<s;++n){for(var p=[],d=[],g=[],o=0;o<s;++o)n!=o&&(c=xr(l[2*n],l[2*o]),f=xr(l[2*n],l[2*o+1]),p.push(c),p.push(f),c=xr(l[2*n+1],l[2*o]),f=xr(l[2*n+1],l[2*o+1]),d.push(c),d.push(f));g.push(p),g.push(d),y[n]=g}for(var m=[],x=[],_=Object.keys(y).length,n=0;n<_;++n){for(var w=y[n],v=m.length=0;v<w[0].length;++v)m.push(v);for(o=0;o<w.length;++o)w[o]=function(t,e){if(!(t.length<=0)){for(var n=0,r=[],i=t.length,a=new Array(i),n=0;n<i;++n)a[n]={},a[n].dot=t[n],a[n].idx=n;for(a.sort(mr),n=0;n<e.length;++n)r.push(a[n].dot),e[n]=a[n].idx;return r}}(w[o],m),m[0]>=2*n?x.push(m[0]+2):x.push(m[0])}for(var z,M=[],n=0;n<x.length;++n)n==x[x[n]]&&((z={}).x=Math.min(n,x[n]),z.y=Math.max(n,x[n]),M.push(z));m.length=0;for(var M=function(t,e){if(!(t.length<=0)){for(var n,r=0,i=[],a=t.length,o=new Array(a),u=new Array(a),r=0;r<a;++r)u[r]={},u[r].dot=t[r],u[r].idx=r;for(u.sort(_r),i.push(u[0].dot),o[u[0].idx]=0,r=1;r<a;++r)n=i.length,Math.abs(u[r].dot.x-i[n-1].x)<1e-9&&Math.abs(u[r].dot.y-i[n-1].y)<1e-9?o[u[r].idx]=n-1:(i.push(u[r].dot),o[u[r].idx]=n);for(r=0;r<e.length;++r)e[r]=o[e[r]];return i}}(M,m),b=[],n=0;n<M.length;++n){var I=[];I.push(M[n].x),I.push(M[n].y),b.push(I)}var b=wr(b),O=parseInt(b[0][0]/2),E=parseInt(b[0][0]%2),u=u.concat(t[O]);0==E&&u.reverse();for(n=0;n<b.length;++n)O=parseInt(b[n][1]/2),u=(parseInt(b[n][1]%2)&&t[O].reverse(),u.concat(t[O]));return u}}function br(){}function Ir(t,e,n,r){if(I(t)&&0!=e.length){for(var i=[],a=t,o=0;o<n.length;++o){var u=e[y=n[o]];if(u.higherX==a.higherX&&u.higherY==a.higherY&&u.offsetX!=a.offsetX)return o;if(u.offsetX&&a.offsetX&&u.higherX==a.higherX&&(u.x==a.x&&u.y==a.y-1||u.x==a.x&&u.y==a.y+1))return o;if(!u.offsetX&&!a.offsetX&&u.higherY==a.higherY&&(u.y==a.y&&u.x==a.x-1||u.y==a.y&&u.x==a.x+1))return o;a.offsetX?!u.offsetX&&(u.x==a.x&&u.y==a.y-1||u.x==a.x&&u.y==a.y||u.x==a.x+1&&u.y==a.y-1||u.x==a.x+1&&u.y==a.y)&&i.push(o):u.offsetX&&(u.y==a.y&&u.x==a.x-1||u.y==a.y&&u.x==a.x||u.y==a.y+1&&u.x==a.x-1||u.y==a.y+1&&u.x==a.x)&&i.push(o)}var s=a.x,l=a.y,h=s,c=l;a.offsetX?h++:c++;for(var f=0;f<i.length;f++){var y,p=e[y=n[i[f]]].x,d=e[y].y,g=p,m=d;e[y].offsetX?g++:m++;var p=Math.min(s,p),d=Math.min(l,d),g=Math.max(h,g),m=Math.max(c,m),x=new Array(4);x[0]=r.subHeightBuffer[d*br.GRID_POINT_NUM_X+p],x[3]=r.subHeightBuffer[m*br.GRID_POINT_NUM_X+g],x[1]=r.subHeightBuffer[d*br.GRID_POINT_NUM_X+g],x[2]=r.subHeightBuffer[m*br.GRID_POINT_NUM_X+p];for(var _=0;_<4;_++)x[_]==r.height&&(x[_]-=.1);(x[0]>r.height&&x[3]>r.height&&x[1]<r.height&&x[2]<r.height||x[0]<r.height&&x[3]<r.height&&x[1]>r.height&&x[2]>r.height)&&(i[f]=void 0)}for(f=0;f<i.length;f++)if(I(i[f]))return i[f]}}function Or(t,e,n,r){var i,a,o;I(t)&&(a=(i=Y.get_bound(e.index)).width/(br.GRID_POINT_NUM_X-1),(o=new B).longitude=i.west+t.x*a,o.latitude=i.south+t.y*a,o.height=e.height,t.offsetX?o.longitude+=t.offsetValue*a:o.latitude+=t.offsetValue*a,Hn.point_in_polygon(o,e.polygonArrayGeo)&&r.push(o),n.push(o))}function Er(t,e,n){return(t-n)/(t-e)}return Hn.PointSegementSpaceDistance=function(t,e,n,r){var i;return N.distance(e,n)<1e-10?N.distance(t,r=e):(N.subtract(t,e,dr),N.subtract(n,e,gr),(i=N.dot(dr,gr))<0?(N.clone(e,r),N.distance(t,e)):(N.subtract(t,n,dr),N.subtract(e,n,gr),(i=N.dot(dr,gr))<0?(N.clone(n,r),N.distance(t,n)):(N.subtract(n,e,dr),N.subtract(t,e,gr),N.normalize(dr,dr),i=N.dot(dr,gr),N.multiplyByScalar(dr,i,r),N.add(r,e,r),N.subtract(t,e,dr),N.subtract(e,n,gr),N.cross(dr,gr,dr),N.magnitude(dr)/N.magnitude(gr))))},Hn.connect_segments=function(t){for(var e=new B,n=new B(0,0,Number.MAX_VALUE),r=0;r<t.length;++r){var i=B.fromDegrees(t[r][0].longitude,t[r][0].latitude,t[r][0].height,e);n.longitude+=i.longitude,n.latitude+=i.latitude,n.height=Math.min(n.height,i.height);var a=t[r].length-1,i=B.fromDegrees(t[r][a].longitude,t[r][a].latitude,t[r][a].height,e);n.longitude+=i.longitude,n.latitude+=i.latitude,n.height=Math.min(n.height,i.height)}var o=2*t.length;n.longitude/=o,n.latitude/=o;o=new Ge({});o.set_position_sphr(n);for(var u=at.inverse(o.mat_tnb,new at),s=[],r=0;r<t.length;++r){for(var l=[],h=0;h<t[r].length;++h){var c=N.fromDegrees(t[r][h].longitude,t[r][h].latitude,t[r][h].height);at.multiplyByVector(u,c,c),c.y=c.z,c.z=0,l.push(c)}s.push(l)}for(var f=Mr(s),y=[],p=o.mat_tnb,r=0;r<f.length;++r)f[r].z=f[r].y,f[r].y=0,at.multiplyByVector(p,f[r],f[r]),y.push(B.fromCartesian(f[r])),y[a=y.length-1].longitude=U.toDegrees(y[a].longitude),y[a].latitude=U.toDegrees(y[a].latitude);return y},Hn.get_area=function(t){if(0==t.length)return 0;new B;for(var e=new B(0,0,Number.MAX_VALUE),n=0;n<t[0].length;++n){var r=B.fromCartesian(t[0][n]);e.longitude+=r.longitude,e.latitude+=r.latitude,e.height=Math.min(e.height,r.height)}var i=t[0].length;e.longitude/=i,e.latitude/=i;i=new Ge({});i.set_position_sphr(e);for(var a=at.inverse(i.mat_tnb,new at),o=[],u=[],n=0;n<t.length;++n)for(var s=0;s<t[n].length;++s){var l=at.multiplyByVector(a,t[n][s],new N);u.push(l.x),u.push(l.z),o.push(l)}var h=[];if(1<t.length)for(var c=t[0].length,f=1;f<t.length;++f)h.push(c),c+=t[f].length;for(var y=en(u,h,2),p=0,n=0,d=y.length;n<d;n+=3){var g=o[y[n]],m=o[y[n+1]],x=o[y[n+2]];p+=bn.area([g,m,x])}return p},Hn.create_circle=function(t,e,n,r){var i=t._application.frameState.observer,t=N.magnitude(i.originGeoWC),i=[];return Xn.create_circle(i,e,n/t,null==r?r:32),i},br.GRID_POINT_NUM_X=33,br.GRID_POINT_NUM_Y=33,br.createContour=function(t){for(var e={drawCoordArray:[],exportCoordArray:[]},n=t.gridBuffer,r=t.elevationMin,i=t.elevationMax,r=Math.floor(r/t.stride),a=(r+=0<r?1:0)*t.stride;a<i;)!function(t){for(var e=function(t){for(var e=function(t){for(var e=[],n=0;n<br.GRID_POINT_NUM_Y;n++)for(var r=0;r<br.GRID_POINT_NUM_X;r++)t.subHeightBuffer[n*br.GRID_POINT_NUM_X+r]==t.height&&(t.subHeightBuffer[n*br.GRID_POINT_NUM_X+r]-=.1,e.push(n*br.GRID_POINT_NUM_X+r));return e}(t),n=[],r=0;r<br.GRID_POINT_NUM_Y;r++)for(var i=0;i<br.GRID_POINT_NUM_X-1;i++){var a=t.subHeightBuffer[r*br.GRID_POINT_NUM_X+i],o=t.subHeightBuffer[r*br.GRID_POINT_NUM_X+i+1];Math.max(a,o)>t.height&&Math.min(a,o)<t.height&&(u=Er(a,o,t.height),n.push({offsetX:!0,x:i,y:r,offsetValue:u,higherX:a>t.height?i:i+1,higherY:r}))}for(r=0;r<br.GRID_POINT_NUM_Y-1;r++)for(i=0;i<br.GRID_POINT_NUM_X;i++){var u,a=t.subHeightBuffer[r*br.GRID_POINT_NUM_X+i],o=t.subHeightBuffer[(r+1)*br.GRID_POINT_NUM_X+i];Math.max(a,o)>t.height&&Math.min(a,o)<t.height&&(u=Er(a,o,t.height),n.push({offsetX:!1,x:i,y:r,offsetValue:u,higherX:i,higherY:a>t.height?r:r+1}))}return function(t,e){for(var n=0;n<e.length;++n){var r=e[n];t.subHeightBuffer[r]=t.height}}(t,e),n}(t),n=[],r=[],i=[],a=0;a<e.length;++a)n.push(a),r.push(a);for(;0<r.length;){var o=r[0];r.splice(0,1);for(var u=1,s=0;s<r.length;++s){var l=r[s];if(e[o].higherX==e[l].higherX&&e[o].higherY==e[l].higherY&&(r.splice(s,1),--s,4==++u)){i.push(o);break}}}var h=[],c=[];for(;0<i.length;){o=i[0];i.splice(0,1);for(var u=0,f=[],a=0;a<n.length;++a){l=n[a];if(e[l].higherX==e[o].higherX&&e[l].higherY==e[o].higherY&&(++u,f.push(l),n.splice(a,1),--a,4==u)){h=[],c=[];l=void 0,o=f[0];for(f.splice(0,1),Or(e[l=o],t,h,c);0<f.length;)I(d=Ir(e[l],e,f,t))&&(l=f[d],Or(e[l],t,h,c)),f.splice(d,1);Or(e[o],t,h,c),1<h.length&&t.drawCoordArray.push(h),1<c.length&&t.exportCoordArray.push(c);break}}}var o=void 0,y=void 0,l=void 0;h=[],c=[];var p=0;for(;0<n.length;){var d,g;I(y)||(o=n[0],l=o,n.splice(0,1),1<h.length&&t.drawCoordArray.push(h),1<c.length&&t.exportCoordArray.push(c),h=[],c=[],Or(e[l],t,h,c),p=0),I(d=Ir(e[l],e,n,t))?(p++,y=n[d],l=y,n.splice(d,1),Or(e[l],t,h,c),l==o&&(y=l=void 0),2==p&&n.splice(0,0,o)):0==p?-1!=(g=n.indexOf(o))&&n.splice(g,1):1==p?n.push(o):(-1!=(g=n.indexOf(o))&&n.splice(g,1),n.push(o),n.push(l),y=l=void 0)}}({index:t.index,height:a,subHeightBuffer:n,polygonArrayGeo:t.polygonArrayGeo,drawCoordArray:e.drawCoordArray,exportCoordArray:e.exportCoordArray}),a+=t.stride;return n=void 0,e},yr=function(t,e){var n=br.createContour(t);return n.stride=t.stride,n},function(t){var i=t.data,a=[],o={id:i.id,result:void 0,error:void 0};return zt(function(t,e,n){try{return t(e,n)}catch(t){return zt.reject(t)}}(yr,i.parameters,a)).then(function(t){o.result=t}).otherwise(function(t){t instanceof Error?o.error={name:t.name,message:t.message,stack:t.stack}:o.error=t}).always(function(){I(pr)||(pr=T(self.webkitPostMessage,self.postMessage)),i.canTransferArrayBuffer||(a.length=0);try{pr(o,a)}catch(t){o.result=void 0,o.error="postMessage failed with error: "+(n=(e=t).name,r=e.message,r=I(n)&&I(r)?n+": "+r:e.toString(),I(e=e.stack)&&(r+="\n"+e),r)+"\n    with responseMessage: "+JSON.stringify(o),pr(o)}var e,n,r})}});
